<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
	<link rel="stylesheet" type="text/css" href="static/asset/css/Rosa.css">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.css">
    <script type="text/javascript" src="static/asset/function_js/Rosa.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/p5@1.6.0/lib/p5.js"></script>
    

    <script type="text/javascript" src="https://unpkg.com/@babel/polyfill@7.0.0/dist/polyfill.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/9.4.2/math.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.1.1/socket.io.js"></script>
    <!-- <script type="text/javascript" src="https://unpkg.com/vtk.js"></script> -->
    <script src="https://unpkg.com/vtk.js@27.1.2"></script>
    <title>Rosa</title>
</head>

<body>
  <script type="text/javascript">
    const vtk = window.vtk;

    const vtkFullScreenRenderWindow = vtk.Rendering.Misc.vtkFullScreenRenderWindow;
    const vtkActor = vtk.Rendering.Core.vtkActor;
    const vtkOBJReader = vtk.IO.Misc.vtkOBJReader
    const vtkMapper = vtk.Rendering.Core.vtkMapper;
    const vtkLineSource = vtk.Filters.Sources.vtkLineSource;
    const vtkInteractorStyleManipulator = vtk.Interaction.Style.vtkInteractorStyleManipulator;
    const vtkMouseCameraTrackballPanManipulator = vtk.Interaction.Manipulators.vtkMouseCameraTrackballPanManipulator;
    const vtkMouseCameraTrackballRotateManipulator = vtk.Interaction.Manipulators.vtkMouseCameraTrackballRotateManipulator;
    const vtkMouseCameraTrackballZoomManipulator  = vtk.Interaction.Manipulators.vtkMouseCameraTrackballZoomManipulator ;
    const vtkGestureCameraManipulator = vtk.Interaction.Manipulators.vtkGestureCameraManipulator;
    const vtkAxesActor = vtk.Rendering.Core.vtkAxesActor;
    const vtkCellPicker = vtk.Rendering.Core.vtkCellPicker;
    //const reader = vtk.IO.Misc.vtkOBJReader.newInstance();
    const reader =vtk.IO.Geometry.vtkSTLReader.newInstance();
    // const InteractionPresets = vtkInteractionStyle.Presets;
    //<script type="text/javascript" src="https://unpkg.com/vtk.js">
    // 创建vtk.js渲染器
    //const fullScreenRenderWindow = vtkFullScreenRenderWindow.newInstance({
    //    background: [1.0, 1.0, 1.0],
    // });
    // const renderer = fullScreenRenderWindow.getRenderer();
    // const renderWindow = fullScreenRenderWindow.getRenderWindow();
    // renderWindow.addRenderer(renderer);

    const renderWindowWithControlBar=vtk.Rendering.Misc.vtkRenderWindowWithControlBar.newInstance({
      background: [0.2, 0.3, 0.4]
    });
    




    class Model {
      constructor(name, polydata,actor,scene) {
        this.name = name;
        this.MyScene = scene;
        this.polydata = polydata;
        this.actor = actor;
        this.parent = null;
        this.visibility=1;
      }

      setName(name) {
        this.name = name;
      }
      setParent(parent) {
        this.parent = parent;
      }
      setTransform(trans) {
        //4*4转16*1
        this.actor.setUserMatrix(math.transpose(trans.matrix)._data.flat());
        this.MyScene.updateThreeDView();
      }

      UpdatePosition() {
          //4*4转16*1
          if (this.parent===null){
            var result=math.matrix([
                      [1, 0, 0, 0],
                      [0, 1, 0, 0],
                      [0, 0, 1, 0],
                      [0, 0, 0, 1]
                    ]);
            this.actor.setUserMatrix(math.transpose(result)._data.flat());
            this.MyScene.updateThreeDView();
          }
          else{
          var trans=this.parent.getFullMatrix();
          this.actor.setUserMatrix(math.transpose(trans)._data.flat());
          this.MyScene.updateThreeDView();
        }
        }


      

      setVisibility(vis) {
        this.actor.setVisibility(vis); 
        this.visibility=vis;
        this.MyScene.updateThreeDView();
      }

      setColor(c1, c2, c3) {
        this.actor.getProperty().setColor(c1, c2, c3);
        this.MyScene.updateThreeDView();
      }

      getName() {
        return this.name;
      }

      getPolydata() {
        return this.polydata;
      }

      getActor() {
        return this.actor;
      }
    }


  class Markup {
    constructor(name,scene) {
      this.name = name;
      this.MyScene = scene;
      this.points = [];
      this.parent = null;
      this.actors=[];
      this.sphere=[];
      this.visibility=1;
    }

    setName(name) {
      this.name = name;
    }


    
    getName() {
      return this.name;
    }

    getPoints() {
      return this.points;
    }

    getPointsWorld() {
      if (this.parent === null) {
        return this.points;
      } else {
        var trans=this.parent.getFullMatrix();
        const transformedPoints = this.points.map(point => {
        const transformedPoint = math.multiply(trans, point.concat(1));
        const transformedPointArray = Array.from(transformedPoint); // 将变量转换为数组
        return transformedPointArray.slice(0, 3); // 去掉最后一维，得到三维坐标
      });
      var points=[];
      for (let i = 0; i < this.points.length; i++) {
        points.push([transformedPoints[i][0].value,transformedPoints[i][1].value,transformedPoints[i][2].value]);
      }
      return points;
      }

      return this.points;
    }
    
    AddPoints(point) {
      this.points.push(point);
      const sphereSource = vtk.Filters.Sources.vtkSphereSource.newInstance({
        center: point,
        radius: 2,
      });
      const mapper1 = vtk.Rendering.Core.vtkMapper.newInstance();
      mapper1.setInputConnection(sphereSource.getOutputPort());
      const actor1 = vtk.Rendering.Core.vtkActor.newInstance();
      actor1.setMapper(mapper1);
      actor1.getProperty().setColor([0.95, 0.45, 0.95]);
      actor1.setVisibility(this.visibility);
      this.actors.push(actor1);
      this.sphere.push(sphereSource);
      this.MyScene.AddActor(actor1);
      this.updateSpheraPosition();
    }

    setVisibility(vis) {
      for (let i = 0; i < this.points.length; i++) {
        this.actors[i].setVisibility(vis)
      }
      this.MyScene.updateThreeDView();
      this.visibility=vis;
    }

    updateSpheraPosition(){
      var points_world=this.getPointsWorld();
      for (let i = 0; i < this.points.length; i++) {
        this.sphere[i].setCenter(points_world[i])
        this.sphere[i].update();
      }
      this.MyScene.updateThreeDView();
    }

      //从针尖获取点添加至点列中的功能（添加具体某个工具下的相对坐标）
      AddPointsByStylusInTool(ToolName) {
        var Stylus1=this.MyScene.getTransformByName("StylusTipToStylus");
        var StylusTip=Stylus1.getFullMatrix();
        var StylusTip_array=Array.from(StylusTip.toArray());
        var StylusTip_point=[StylusTip_array[0][3],StylusTip_array[1][3],StylusTip_array[2][3],1]
        var Tool_trans=this.MyScene.getTransformByName(ToolName).matrix;
        var transformedPoint = math.multiply(math.inv(Tool_trans), StylusTip_point);
        var transformedPoint_array=Array.from(transformedPoint.toArray());
        this.points.push([transformedPoint_array[0],transformedPoint_array[1],transformedPoint_array[2]]);
      }


    RemovePointByIndex(index) {
      this.points.splice(index, 1);
      this.actors.splice(index, 1);
      this.sphere.splice(index, 1);
      this.MyScene.RemoveActor(this.actors[index]);
    }

    RemoveAllPoints() {
      for (let i = 0; i < this.points.length; i++) {
        this.MyScene.RemoveActor(this.actors[i]);
      }
      this.points=[];
      this.actors=[];
      this.sphere=[];
      
    }

  }

    class TransformMatrix {
      constructor(name,matrix) {
        this.matrix = math.matrix(matrix);
        this.parent = null;
        this.name = name;
      }
      getName() {
        return this.name;
      }
      // 设置当前矩阵的父级
      setParent(parent) {
        this.parent = parent;
      }

      setMatrix(matrix) {
        this.matrix = math.matrix(matrix);
      }

      //绕轴移动
      TanslationBySelf(x,y,z){
        var trans=math.matrix([
                    [1, 0, 0, x],
                    [0, 1, 0, y],
                    [0, 0, 1, z],
                    [0, 0, 0, 1]
                  ]);
        //this.matrix=math.multiply(this.matrix,math.multiply(trans,math.inv(this.matrix)));
        this.matrix=math.multiply(trans,this.matrix);
      }
      
      //绕轴旋转
      RotationBySelf(x,y,z){
        var angle_x = math.unit(x, 'deg');
        var radians_x = angle_x.toNumber('rad');
        var rotateMatrix_x = math.matrix([
          [1, 0, 0,0],
          [0, math.cos(radians_x), -math.sin(radians_x),0],
          [0, math.sin(radians_x), math.cos(radians_x),0],
          [0,0,0,1]
        ]);

        var angle_y = math.unit(y, 'deg');
        var radians_y = angle_y.toNumber('rad');
        var rotateMatrix_y = math.matrix([
            [math.cos(radians_y), 0, math.sin(radians_y),0],
            [0, 1, 0,0],
            [-math.sin(radians_y), 0, math.cos(radians_y),0],
            [0,0,0,1]]);

        var angle_z = math.unit(z, 'deg');
        var radians_z = angle_z.toNumber('rad');
        var rotateMatrix_z = math.matrix([
                        [math.cos(radians_z), -math.sin(radians_z), 0,0],
                        [math.sin(radians_z), math.cos(radians_z), 0,0],
                        [0, 0, 1,0],
                        [0,0,0,1]]);
        var trans=math.multiply(rotateMatrix_z,math.multiply(rotateMatrix_y,rotateMatrix_x));
        //this.matrix=math.multiply(this.matrix,math.multiply(trans,math.inv(this.matrix)));
        this.matrix=math.multiply(trans,this.matrix);
      }


      // 获取当前矩阵的所有父级连乘
      getAllParents() {
        let parents = []
        let current = this.parent
        while (current) {
          parents.push(current.matrix)
          current = current.parent
        }
        return parents
      }

      // 获取当前矩阵和所有父级的连乘结果
      getFullMatrix() {
        let parents = this.getAllParents()
        var result=math.matrix([
                    [1, 0, 0, 0],
                    [0, 1, 0, 0],
                    [0, 0, 1, 0],
                    [0, 0, 0, 1]
                  ]);
        for(let i=0;i<parents.length;i++){
          result=math.multiply(result,parents[parents.length-i-1]);
        }
        // let result = parents.reduce((prev, current) => {
        //   return math.multiply(prev, current)
        // }, this.matrix)
        result=math.multiply(result,this.matrix);
        return result
      }

          // 获取当前矩阵和所有父级的连乘结果,去掉最后仨
          getFullMatrix_3() {
            let parents = this.getAllParents();
            parents.pop();
            parents.pop();
            parents.pop();
            var result=math.matrix([
                        [1, 0, 0, 0],
                        [0, 1, 0, 0],
                        [0, 0, 1, 0],
                        [0, 0, 0, 1]
                      ]);
            for(let i=0;i<parents.length;i++){
              result=math.multiply(result,parents[parents.length-i-1]);
            }
            // let result = parents.reduce((prev, current) => {
            //   return math.multiply(prev, current)
            // }, this.matrix)
            result=math.multiply(result,this.matrix);
            return result
          }


    }


    class FemurClip {
      constructor(name,scene,LeftOrRight) {
        this.name = name;
        this.MyScene = scene;
        this.points = [];
        this.parent = null;
        this.quxiStatue=0;
        this.LeftOrRight=LeftOrRight
        this.JT=null;
        this.JTName=null;
        //三个面的颜色
        this.NAMED_COLORS = {
        BANANA: [227 / 255, 207 / 255, 87 / 255],
        TOMATO: [255 / 255, 255 / 255, 0],
        SANDY_BROWN: [244 / 255, 164 / 255, 96 / 255],
        };
        //初始化切割器
        this.filter = vtk.Filters.General.vtkClipClosedSurface.newInstance({
          activePlaneId: 0,
          clipColor: this.NAMED_COLORS.BANANA,
          baseColor: this.NAMED_COLORS.TOMATO,
          activePlaneColor: this.NAMED_COLORS.SANDY_BROWN,
          passPointData: false,
        });
        this.planes=[];

        this.plan_2_5=[[28.45129776 ,7.92001438 , 17.97800064],
                      [ -29.6115303,   3.10659409 , 17.97800064],
                      [ -29.93188667, 13.88494968 , 17.97800064],
                      [23.61928749,  - 9.96700096 , 26.61837578],
                      [ -26.58203506,  -13.24556065 , 29.85050964],
                      [ -28.02037621,  - 5.70337629 , 22.41522789],
                      [30.13783073, 23.85534668 , 22.45420647],
                      [ -30.64068985, 20.63753319 , 19.28199005],
                      [ -30.46289253, 24.98927307 , 23.57206535],
                      [30.28362083, 27.57123375 , 33.92355347],
                      [ -27.37488174, 27.6991272  , 41.14916229],
                      [ -30.62027359, 27.56101418 , 33.34654236],
                      [14.21774197,  -17.83368683 , 48.58074188],
                      [ -20.13167191,  -18.51869392 , 55.0057373 ],
                      [ -23.65115166,  -17.42789841 , 44.77423477],];
      }

      setJTSize_first(name){
        this.JTName=name;
        var JTplan=[[[-25.43288231,  10.35145569,  17.9810009 ],
                  [ 25.90548706,  13.1924305 ,  17.9810009 ],
                  [ 25.86165047,   6.80586863,  17.9810009 ],
                  [-20.67867661, -14.27055359,  42.17010117],
                  [ 15.37158966, -14.00376511,  39.66825485],
                  [ 10.88807774, -14.96262741,  48.66152573],
                  [-27.40942955,  25.08310699,  34.57686234],
                  [ 26.33925247,  25.13218307,  37.34769821],
                  [ 27.98187637,  24.98776627,  29.18815231],
                  [-24.63245201,  -5.16226912,  23.07591057],
                  [ 23.93114281,  -2.54548144,  20.49624252],
                  [ 20.90313721,  -9.18884945,  27.0454464 ],
                  [-27.35635948,  22.36370468,  22.19860649],
                  [ 27.92136192,  23.82510567,  23.6392746 ],
                  [ 27.51866531,  19.39278984,  19.26984215]],
                  [[-25.43288231,  10.35145569,  17.9810009 ],
                  [ 25.90548706,  13.1924305 ,  17.9810009 ],
                  [ 25.86165047,   6.80586863,  17.9810009 ],
                  [-22.20831108, -15.45130062,  41.21765137],
                  [ 16.80813599, -15.22468758,  39.09227371],
                  [ 12.42081261, -16.24989128,  48.70821762],
                  [-28.18735313,  26.79473877,  34.9806366 ],
                  [ 27.19948387,  26.85297585,  38.27113342],
                  [ 28.63985825,  26.67611313,  28.28265572],
                  [-25.75562096,  -5.52471781,  22.92839622],
                  [ 24.61536407,  -3.15019274,  20.58752441],
                  [ 22.00040627,  -9.33310032,  26.68278122],
                  [-29.28717422,  22.56632805,  21.89966774],
                  [ 29.116642  ,  23.7640934 ,  23.08046722],
                  [ 29.08619308,  19.80887794,  19.18131638]],
                  [[-25.43288231,  10.35145569,  17.9810009 ],
                  [ 25.90548706,  13.1924305 ,  17.9810009 ],
                  [ 25.86165047,   6.80586863,  17.9810009 ],
                  [-23.7320385 , -16.92790794,  40.08462524],
                  [ 17.89138603, -16.80121803,  38.89649963],
                  [ 13.42932129, -17.91501045,  49.34289932],
                  [-30.27989006,  27.60648918,  35.91855621],
                  [ 27.82698631,  27.66442299,  39.18826675],
                  [ 30.31720734,  27.51375389,  30.67852211],
                  [-27.58467674,  -6.67039776,  23.36853027],
                  [ 26.55533028,  -3.52446437,  20.26720047],
                  [ 23.878479  , -10.67913342,  27.32040405],
                  [-30.32889557,  22.89723587,  21.50967216],
                  [ 30.61587524,  25.37083054,  23.94821739],
                  [ 30.22603607,  20.7218895 ,  19.36515045]],
                  [[-25.43288231,  10.35145569,  17.9810009 ],
                  [ 25.90548706,  13.1924305 ,  17.9810009 ],
                  [ 25.86165047,   6.80586863,  17.9810009 ],
                  [-24.69706917, -18.80425644,  41.33796692],
                  [ 19.02258873, -18.49002647,  38.39073563],
                  [ 14.67716503, -19.62495041,  49.03554916],
                  [-31.70806694,  28.50622749,  34.7026062 ],
                  [ 30.48534966,  28.6146698 ,  40.83024216],
                  [ 31.98212814,  28.42347527,  30.03084946],
                  [-28.66135406,  -7.58698845,  23.37645721],
                  [ 27.33261681,  -4.29321384,  20.12939072],
                  [ 23.22037315, -14.17779636,  29.87380219],
                  [-31.69400024,  24.07479095,  21.76089478],
                  [ 32.12881851,  26.1012764 ,  23.75866508],
                  [ 31.82962227,  21.66384125,  19.38410759]],
                  [[-25.43288231,  10.35145569,  17.9810009 ],
                  [ 25.90548706,  13.1924305 ,  17.9810009 ],
                  [ 25.86165047,   6.80586863,  17.9810009 ],
                  [-27.80512428, -20.89809608,  40.08660507],
                  [ 21.11037827, -20.72684669,  38.4802475 ],
                  [ 15.94490528, -21.95241928,  49.97526169],
                  [-34.23620605,  30.01827049,  34.83029556],
                  [ 32.60666275,  30.14359093,  41.90606308],
                  [ 34.390728  ,  29.92736626,  29.69534492],
                  [-32.35902023,  -7.62661457,  22.91935158],
                  [ 28.74761772,  -6.28984451,  20.9027195 ],
                  [ 25.56018829, -14.04173279,  28.5447216 ],
                  [-34.17203903,  25.23173141,  21.68932152],
                  [ 34.33280563,  27.24329758,  23.67237663],
                  [ 34.42493057,  22.99255943,  19.48188972]],
                  [[-25.43288231,  10.35145569,  17.9810009 ],
                  [ 25.90548706,  13.1924305 ,  17.9810009 ],
                  [ 25.86165047,   6.80586863,  17.9810009 ],
                  [-28.84970474, -21.42905235,  40.76649094],
                  [ 21.13601494, -21.26985359,  39.27313995],
                  [ 15.90210819, -22.490242  ,  50.71960831],
                  [-35.43251801,  32.16860962,  35.07025528],
                  [ 32.48104095,  32.33533859,  44.48608017],
                  [ 35.65620041,  32.13532257,  33.19316864],
                  [-32.32410812,  -8.09705162,  23.38312149],
                  [ 29.58261681,  -6.38940954,  21.69966507],
                  [ 26.44733238, -14.09537601,  29.29641151],
                  [-35.27125931,  25.83995819,  22.9897747 ],
                  [ 35.3423996 ,  28.64115906,  25.75126839],
                  [ 35.68651581,  23.61274719,  20.79416656]]]
        

        var jt_name_r=["femur-R1-5","femur-R2","femur-R2-5","femur-R3","femur-R4","femur-R5"];
        var jt_name_l=["femur-l1-5","femur-l2","femur-l2-5","femur-l3","femur-l4","femur-l5"];
        var index=0;
        if(this.LeftOrRight){
          if(this.JT!==null){
            this.MyScene.RemoveModel(jt_name_r[this.JT]);
          }

          index=jt_name_r.indexOf(name);
          this.loadJTModelByName(jt_name_r[index]);

        }
        else{
          if(this.JT!==null){
            this.MyScene.RemoveModel(jt_name_l[this.JT]);
            }
          index=jt_name_l.indexOf(name);
          this.loadJTModelByName(jt_name_l[index]);
        }
        this.JT=index;
        this.plan_2_5=JTplan[index];
      }


      setJTSize(index){
        var JTplan=[[[-25.43288231,  10.35145569,  17.9810009 ],
                  [ 25.90548706,  13.1924305 ,  17.9810009 ],
                  [ 25.86165047,   6.80586863,  17.9810009 ],
                  [-20.67867661, -14.27055359,  42.17010117],
                  [ 15.37158966, -14.00376511,  39.66825485],
                  [ 10.88807774, -14.96262741,  48.66152573],
                  [-27.40942955,  25.08310699,  34.57686234],
                  [ 26.33925247,  25.13218307,  37.34769821],
                  [ 27.98187637,  24.98776627,  29.18815231],
                  [-24.63245201,  -5.16226912,  23.07591057],
                  [ 23.93114281,  -2.54548144,  20.49624252],
                  [ 20.90313721,  -9.18884945,  27.0454464 ],
                  [-27.35635948,  22.36370468,  22.19860649],
                  [ 27.92136192,  23.82510567,  23.6392746 ],
                  [ 27.51866531,  19.39278984,  19.26984215]],
                  [[-25.43288231,  10.35145569,  17.9810009 ],
                  [ 25.90548706,  13.1924305 ,  17.9810009 ],
                  [ 25.86165047,   6.80586863,  17.9810009 ],
                  [-22.20831108, -15.45130062,  41.21765137],
                  [ 16.80813599, -15.22468758,  39.09227371],
                  [ 12.42081261, -16.24989128,  48.70821762],
                  [-28.18735313,  26.79473877,  34.9806366 ],
                  [ 27.19948387,  26.85297585,  38.27113342],
                  [ 28.63985825,  26.67611313,  28.28265572],
                  [-25.75562096,  -5.52471781,  22.92839622],
                  [ 24.61536407,  -3.15019274,  20.58752441],
                  [ 22.00040627,  -9.33310032,  26.68278122],
                  [-29.28717422,  22.56632805,  21.89966774],
                  [ 29.116642  ,  23.7640934 ,  23.08046722],
                  [ 29.08619308,  19.80887794,  19.18131638]],
                  [[-25.43288231,  10.35145569,  17.9810009 ],
                  [ 25.90548706,  13.1924305 ,  17.9810009 ],
                  [ 25.86165047,   6.80586863,  17.9810009 ],
                  [-23.7320385 , -16.92790794,  40.08462524],
                  [ 17.89138603, -16.80121803,  38.89649963],
                  [ 13.42932129, -17.91501045,  49.34289932],
                  [-30.27989006,  27.60648918,  35.91855621],
                  [ 27.82698631,  27.66442299,  39.18826675],
                  [ 30.31720734,  27.51375389,  30.67852211],
                  [-27.58467674,  -6.67039776,  23.36853027],
                  [ 26.55533028,  -3.52446437,  20.26720047],
                  [ 23.878479  , -10.67913342,  27.32040405],
                  [-30.32889557,  22.89723587,  21.50967216],
                  [ 30.61587524,  25.37083054,  23.94821739],
                  [ 30.22603607,  20.7218895 ,  19.36515045]],
                  [[-25.43288231,  10.35145569,  17.9810009 ],
                  [ 25.90548706,  13.1924305 ,  17.9810009 ],
                  [ 25.86165047,   6.80586863,  17.9810009 ],
                  [-24.69706917, -18.80425644,  41.33796692],
                  [ 19.02258873, -18.49002647,  38.39073563],
                  [ 14.67716503, -19.62495041,  49.03554916],
                  [-31.70806694,  28.50622749,  34.7026062 ],
                  [ 30.48534966,  28.6146698 ,  40.83024216],
                  [ 31.98212814,  28.42347527,  30.03084946],
                  [-28.66135406,  -7.58698845,  23.37645721],
                  [ 27.33261681,  -4.29321384,  20.12939072],
                  [ 23.22037315, -14.17779636,  29.87380219],
                  [-31.69400024,  24.07479095,  21.76089478],
                  [ 32.12881851,  26.1012764 ,  23.75866508],
                  [ 31.82962227,  21.66384125,  19.38410759]],
                  [[-25.43288231,  10.35145569,  17.9810009 ],
                  [ 25.90548706,  13.1924305 ,  17.9810009 ],
                  [ 25.86165047,   6.80586863,  17.9810009 ],
                  [-27.80512428, -20.89809608,  40.08660507],
                  [ 21.11037827, -20.72684669,  38.4802475 ],
                  [ 15.94490528, -21.95241928,  49.97526169],
                  [-34.23620605,  30.01827049,  34.83029556],
                  [ 32.60666275,  30.14359093,  41.90606308],
                  [ 34.390728  ,  29.92736626,  29.69534492],
                  [-32.35902023,  -7.62661457,  22.91935158],
                  [ 28.74761772,  -6.28984451,  20.9027195 ],
                  [ 25.56018829, -14.04173279,  28.5447216 ],
                  [-34.17203903,  25.23173141,  21.68932152],
                  [ 34.33280563,  27.24329758,  23.67237663],
                  [ 34.42493057,  22.99255943,  19.48188972]],
                  [[-25.43288231,  10.35145569,  17.9810009 ],
                  [ 25.90548706,  13.1924305 ,  17.9810009 ],
                  [ 25.86165047,   6.80586863,  17.9810009 ],
                  [-28.84970474, -21.42905235,  40.76649094],
                  [ 21.13601494, -21.26985359,  39.27313995],
                  [ 15.90210819, -22.490242  ,  50.71960831],
                  [-35.43251801,  32.16860962,  35.07025528],
                  [ 32.48104095,  32.33533859,  44.48608017],
                  [ 35.65620041,  32.13532257,  33.19316864],
                  [-32.32410812,  -8.09705162,  23.38312149],
                  [ 29.58261681,  -6.38940954,  21.69966507],
                  [ 26.44733238, -14.09537601,  29.29641151],
                  [-35.27125931,  25.83995819,  22.9897747 ],
                  [ 35.3423996 ,  28.64115906,  25.75126839],
                  [ 35.68651581,  23.61274719,  20.79416656]]]
        

        var jt_name_r=["femur-R1-5","femur-R2","femur-R2-5","femur-R3","femur-R4","femur-R5"];
        var jt_name_l=["femur-l1-5","femur-l2","femur-l2-5","femur-l3","femur-l4","femur-l5"];
        if(this.LeftOrRight){
          if(this.JT!==null){
            this.MyScene.RemoveModel(jt_name_r[this.JT]);
          }
          this.loadJTModelByName(jt_name_r[index]);
          this.JTName=jt_name_r[index];
        }
        else{
          if(this.JT!==null){
            this.MyScene.RemoveModel(jt_name_l[this.JT]);
            }
          this.loadJTModelByName(jt_name_l[index]);
          this.JTName=jt_name_l[index];
        }
        this.JT=index;
        this.plan_2_5=JTplan[index];
        this.update();

      }

      loadJTModelByName(name){
          var jtPath='static/asset/假体库/'+name+'.stl';
          //若处于屈膝状态 加载假体，则等待假体加载完成后，在使假体变化
          self=this;
          var jt=MyScene.AddModel1(name,jtPath).then((femur1) => {
            self.JTName=name;
            if(self.MyScene.operationPlane!==null){
              self.MyScene.operationPlane.ChangeJtStatueToQuxi(self.MyScene.operationPlane.quxiStatue);
            }
          });
        }

      setName(name) {
        this.name = name;
      }
      getName() {
        return this.name;
      }
      computeNormal(points) {
        // 计算向量 AB 和 AC
        const AB = [points[1][0] - points[0][0], points[1][1] - points[0][1], points[1][2] - points[0][2]];
        const AC = [points[2][0] - points[0][0], points[2][1] - points[0][1], points[2][2] - points[0][2]];

        // 计算叉乘得到法向量
        const normal = [AB[1]*AC[2] - AB[2]*AC[1], AB[2]*AC[0] - AB[0]*AC[2], AB[0]*AC[1] - AB[1]*AC[0]];

        // 计算法向量的模长
        const magnitude = math.sqrt(normal[0]*normal[0] + normal[1]*normal[1] + normal[2]*normal[2]);

        // 计算单位法向量
        const unitNormal = [normal[0]/magnitude, normal[1]/magnitude, normal[2]/magnitude];

        var d=points[1][0]*unitNormal[0] + (points[1][1]+7)*unitNormal[1] + (points[1][2]-40)*unitNormal[2];
        if (d > 0) {
          unitNormal[0]=-unitNormal[0];
          unitNormal[1]=-unitNormal[1];
          unitNormal[2]=-unitNormal[2];
        }
        //unitNormal[0]=-unitNormal[0];
        //unitNormal[1]=-unitNormal[1];
        //unitNormal[2]=-unitNormal[2];

        return unitNormal;
      }

      getClipPlans(){
        var ClipPlans=[];
        for (let i = 0; i < 5; i++) {
          ClipPlans.push(this.plan_2_5[i*3]);
          ClipPlans.push(this.computeNormal(this.plan_2_5.slice(i*3,i*3+3)));
        }
        return ClipPlans;
      }

      getClipPlansWorld() {
          var ClipPlans0=this.getClipPlans();
          if (this.parent === null) {
            return ClipPlans0;
          } else {
            if (this.quxiStatue===1){
              var trans=this.parent.getFullMatrix_3();
            }
            else{
            var trans=this.parent.getFullMatrix();
            }
            
            var trans_ni=math.inv(trans);
            const transformedPoints = ClipPlans0.map(point => {
            const transformedPoint = math.multiply(trans_ni, point.concat(1));
            const transformedPointArray = Array.from(transformedPoint); // 将变量转换为数组
            return transformedPointArray.slice(0, 3); // 去掉最后一维，得到三维坐标
          });
          //const translation = math.subset(trans, math.index([0, 1, 2], 3));
          var trans_array=Array.from(trans_ni.toArray());
          //此处transformedPoints内数据为对象，不能与其它数相减，需要获取其value，从发现到解决大概用时1h
          for (let i = 0; i < 5; i++) {
            transformedPoints[i*2+1][0]=transformedPoints[i*2+1][0].value-trans_array[0][3];
            transformedPoints[i*2+1][1]=transformedPoints[i*2+1][1].value-trans_array[1][3];
            transformedPoints[i*2+1][2]=transformedPoints[i*2+1][2].value-trans_array[2][3];
          }
          console.log(transformedPoints);
          return transformedPoints;
          }

        }

        getClipPlansView(){
          if (!this.quxiStatue){
            return this.plan_2_5;
          }
          else{
            var trans=this.MyScene.getTransformByName("jtTo0").getFullMatrix();
            const transformedPoints = this.plan_2_5.map(point => {
            const transformedPoint = math.multiply(trans, point.concat(1));
            const transformedPointArray = Array.from(transformedPoint); // 将变量转换为数组
            return transformedPointArray.slice(0, 3); // 去掉最后一维，得到三维坐标
          });
          var points=[];
          for (let i = 0; i < this.plan_2_5.length; i++) {
            points.push([transformedPoints[i][0].value,transformedPoints[i][1].value,transformedPoints[i][2].value]);
          }
          return points;

          }
        }

      creatPlane(){
        var clipplane=this.getClipPlansWorld();
        console.log(clipplane);
        for (let i = 0; i < 5; i++){
          const plane1 = vtk.Common.DataModel.vtkPlane.newInstance({
                origin: [clipplane[i*2][0].value,clipplane[i*2][1].value,clipplane[i*2][2].value],
                normal: clipplane[i*2+1],
              });

          this.planes.push(plane1);
        }
      }

      updatePlane(){
        var clipplane=this.getClipPlansWorld();
        console.log(clipplane);
        for (let i = 0; i < 5; i++){
          this.planes[i].setOrigin([clipplane[i*2][0].value,clipplane[i*2][1].value,clipplane[i*2][2].value]);
          this.planes[i].setNormal(clipplane[i*2+1]);
          this.planes[i].modified();
        }
      }

      //输入polydata数据进行裁剪
      clip(modelName,jtname) {
        this.setJTSize_first(jtname);
        this.creatPlane();
        var model=this.MyScene.getModelByName(modelName).polydata;
        this.filter.setClippingPlanes([this.planes[0],this.planes[1],this.planes[2],this.planes[3],this.planes[4]]);
        this.filter.setInputData(model);
        this.filter.setScalarModeToColors();
        this.filter.update();
        //var filterData = this.filter.getOutputData();
        this.MyScene.getModelByName(modelName).setVisibility(0);
        var model =this.MyScene.AddModelByFilter("FemurCut",this.filter);
        model.parent=this.parent;
        model.UpdatePosition();
        //return filterData;
      }    
      
      update() {
        this.updatePlane();
        this.filter.update();
        //var filterData = this.filter.getOutputData();
        //this.MyScene.RemoveModel("FemurCut");
        var model =this.MyScene.getModelByName("FemurCut");
        //model.parent=this.parent;
        model.UpdatePosition();
        this.updatePointsViewPosition();
        //return filterData;
      } 
      updatePointsViewPosition(){
        var FemurPoints1 = ['开髓点1', '内侧凹点1', '外侧凸点1', '内侧远端1', '外侧远端1', '内侧后髁1', '外侧后髁1', '外侧皮质高点1', 'A点1', "股骨头球心1",'H点1'];
        for(let i=1;i<FemurPoints1.length;i++){
          this.MyScene.getMarkupsByName(FemurPoints1[i]).updateSpheraPosition();
        }
      }
    }

     
    class TibiaClip {
        constructor(name,scene,LeftOrRight) {
          this.name = name;
          this.MyScene = scene;
          this.points = [];
          this.parent = null;
          this.quxiStatue=0;
          this.LeftOrRight=LeftOrRight
          this.JT=null;
          this.JTName=null;
          //三个面的颜色
          this.NAMED_COLORS = {
          BANANA: [227 / 255, 207 / 255, 87 / 255],
          TOMATO: [255 / 255, 255 / 255, 0],
          SANDY_BROWN: [244 / 255, 164 / 255, 96 / 255],
          };
          this.filter = vtk.Filters.General.vtkClipClosedSurface.newInstance({
            activePlaneId: 0,
            clipColor: this.NAMED_COLORS.BANANA,
            baseColor: this.NAMED_COLORS.TOMATO,
            activePlaneColor: this.NAMED_COLORS.SANDY_BROWN,
            passPointData: false,
          });
          this.planes=[];
          // this.plan_2_5=[[-28.45129776 , -7.92001438 , 17.97800064],
          //               [ 29.6115303,   -3.10659409 , 17.97800064],
          //               [ 29.93188667, -13.88494968 , 17.97800064],
          //               [-23.61928749,   9.96700096 , 26.61837578],
          //               [ 26.58203506,  13.24556065 , 29.85050964],
          //               [ 28.02037621,   5.70337629 , 22.41522789],
          //               [-30.13783073, -23.85534668 , 22.45420647],
          //               [ 30.64068985, -20.63753319 , 19.28199005],
          //               [ 30.46289253, -24.98927307 , 23.57206535],
          //               [-30.28362083, -27.57123375 , 33.92355347],
          //               [ 27.37488174, -27.6991272  , 41.14916229],
          //               [ 30.62027359, -27.56101418 , 33.34654236],
          //               [-14.21774197,  17.83368683 , 48.58074188],
          //               [ 20.13167191,  18.51869392 , 55.0057373 ],
          //               [ 23.65115166,  17.42789841 , 44.77423477],];

          this.plan_2_5=[[0 ,0 , 0],
                        [ 30,   0 , 0],
                        [ 0, 30 ,0]];
        }

        setName(name) {
          this.name = name;
        }
        getName() {
          return this.name;
        }

        setJTSize_first(name){
          var jt_name=["Tibia-1-5","Tibia-2","Tibia-2-5","Tibia-3","Tibia-4","Tibia-5"];
          this.loadJTModelByName(name);
          this.JT=jt_name.indexOf(name);
          this.JTName=name;

        }



        setJTSize(index){
          var jt_name=["Tibia-1-5","Tibia-2","Tibia-2-5","Tibia-3","Tibia-4","Tibia-5"];
          this.MyScene.RemoveModel(jt_name[this.JT]);
          this.MyScene.RemoveModel(jt_name[this.JT].replace("Tibia","Insert"));
          this.loadJTModelByName(jt_name[index]);
          this.JT=index;
          this.JTName=jt_name[index];
          this.update();

        }

        loadJTModelByName(name,){
          var jtPath='static/asset/假体库/'+name+'.stl';
          var jt=MyScene.AddModel(name,jtPath);
          var name1=name.replace("Tibia","Insert");
          var jt1=MyScene.AddModel(name1,jtPath.replace("Tibia","Insert"));
        }



        computeNormal(points) {
          // 计算向量 AB 和 AC
          const AB = [points[1][0] - points[0][0], points[1][1] - points[0][1], points[1][2] - points[0][2]];
          const AC = [points[2][0] - points[0][0], points[2][1] - points[0][1], points[2][2] - points[0][2]];

          // 计算叉乘得到法向量
          const normal = [AB[1]*AC[2] - AB[2]*AC[1], AB[2]*AC[0] - AB[0]*AC[2], AB[0]*AC[1] - AB[1]*AC[0]];

          // 计算法向量的模长
          const magnitude = math.sqrt(normal[0]*normal[0] + normal[1]*normal[1] + normal[2]*normal[2]);

          // 计算单位法向量
          const unitNormal = [normal[0]/magnitude, normal[1]/magnitude, normal[2]/magnitude];

          //var d=points[1][0]*unitNormal[0] + (points[1][1]+7)*unitNormal[1] + (points[1][2]-40)*unitNormal[2];
          if (unitNormal[2] > 0) {
            unitNormal[0]=-unitNormal[0];
            unitNormal[1]=-unitNormal[1];
            unitNormal[2]=-unitNormal[2];
          }
          //unitNormal[0]=-unitNormal[0];
          //unitNormal[1]=-unitNormal[1];
          //unitNormal[2]=-unitNormal[2];

          return unitNormal;
        }

        getClipPlans(){
          var ClipPlans=[];
          ClipPlans.push(this.plan_2_5[0]);
          ClipPlans.push(this.computeNormal(this.plan_2_5.slice(0,3)));
        
          return ClipPlans;
        }

        getClipPlansWorld() {
          var ClipPlans0=this.getClipPlans();
          if (this.parent === null) {
            return ClipPlans0;
          } else {
            var trans=this.parent.getFullMatrix();
            var trans_ni=math.inv(trans);
            const transformedPoints = ClipPlans0.map(point => {
            const transformedPoint = math.multiply(trans_ni, point.concat(1));
            const transformedPointArray = Array.from(transformedPoint); // 将变量转换为数组
            return transformedPointArray.slice(0, 3); // 去掉最后一维，得到三维坐标
          });
          //const translation = math.subset(trans, math.index([0, 1, 2], 3));
          var trans_array=Array.from(trans_ni.toArray());
          //此处transformedPoints内数据为对象，不能与其它数相减，需要获取其value，从发现到解决大概用时1h
          for (let i = 0; i < 1; i++) {
            transformedPoints[i*2+1][0]=transformedPoints[i*2+1][0].value-trans_array[0][3];
            transformedPoints[i*2+1][1]=transformedPoints[i*2+1][1].value-trans_array[1][3];
            transformedPoints[i*2+1][2]=transformedPoints[i*2+1][2].value-trans_array[2][3];
          }
          console.log(transformedPoints);
          return transformedPoints;
          }

        }

        getClipPlansView(){
          if (!this.quxiStatue){
            return this.plan_2_5;
          }
        }

        creatPlane(){
          var clipplane=this.getClipPlansWorld();
          console.log(clipplane);
          for (let i = 0; i < 1; i++){
            const plane1 = vtk.Common.DataModel.vtkPlane.newInstance({
                  origin: [clipplane[i*2][0].value,clipplane[i*2][1].value,clipplane[i*2][2].value],
                  normal: clipplane[i*2+1],
                });

            this.planes.push(plane1);
          }
        }

        updatePlane(){
          var clipplane=this.getClipPlansWorld();
          console.log(clipplane);
          for (let i = 0; i < 1; i++){
            this.planes[i].setOrigin([clipplane[i*2][0].value,clipplane[i*2][1].value,clipplane[i*2][2].value]);
            this.planes[i].setNormal(clipplane[i*2+1]);
            this.planes[i].modified();
          }
        }

        //输入polydata数据进行裁剪
        clip(modelName,jtname) {
          this.setJTSize_first(jtname);
          this.creatPlane();
          var model=this.MyScene.getModelByName(modelName).polydata;
          this.filter.setClippingPlanes(this.planes);
          this.filter.setInputData(model);
          this.filter.setScalarModeToColors();
          this.filter.update();
          this.MyScene.getModelByName(modelName).setVisibility(0);
          var model =this.MyScene.AddModelByFilter("TibiaCut",this.filter);
          model.parent=this.parent;
          model.UpdatePosition();

        }    
        
        update() {
          this.updatePlane();
          this.filter.update();
          var model =this.MyScene.getModelByName("TibiaCut");
          model.parent=this.parent;
          model.UpdatePosition();
          this.updatePointsViewPosition();
        } 


        updatePointsViewPosition(){
          var TibiaPoints = ['胫骨隆凸1', '胫骨结节1', '外侧高点1', '内侧高点1','踝穴中心1'];
          for(let i=1;i<TibiaPoints.length;i++){
            this.MyScene.getMarkupsByName(TibiaPoints[i]).updateSpheraPosition();
          }
        }
      }
      // this.widget.setBackground([0.1803921568627451, 0.2980392156862745, 0.4392156862745098]);
    // class ThreeDView{
    //   constructor(name,parent) {
    //     this.name = name;
    //     this.widget=null;
    //     this.renderWindow=null;
    //     this.renderer=null;
    //     this.parent=parent;
    //     this.camera=null;
    //     this.onInit();


    //   }
    //   onInit(parent){
    //     this.widget=vtk.Rendering.Misc.vtkRenderWindowWithControlBar.newInstance({
    //       background: [1, 1, 1]
    //     });
    //     this.widget.setBackground([0.1803921568627451, 0.2980392156862745, 0.4392156862745098]);
    //     this.widget.setContainer(this.parent);
    //     this.renderWindow=this.widget.getRenderWindow();
    //     this.renderer = this.widget.getRenderer();
    //     this.renderWindow.addRenderer(this.renderer);
    //     this.camera=this.renderer.getActiveCamera();
    //     this.camera.setPosition(-33.05307576224738, -382.0294294605972, 68.0336153852544);
    //     this.camera.setFocalPoint(0,0,0);
    //     this.camera.setViewUp(0.13197123774694897, 0.16271449778664546, 0.9778075396608363);
    //     this.camera.modified();
    //     this.renderWindow.render();
    //   }


    //   resetCamera(){
    //     this.camera.setPosition(-33.05307576224738, -382.0294294605972, 68.0336153852544);
    //     this.camera.setFocalPoint(0,0,0);
    //     this.camera.setViewUp(0.13197123774694897, 0.16271449778664546, 0.9778075396608363);
    //     this.camera.modified();
    //     this.renderWindow.render();
    //   }

    //   setCameraPisitionByIndex(index){
    //     if(index===0){
    //       this.camera.setPosition(-33.05307576224738, -382.0294294605972, 68.0336153852544);
    //       this.camera.setFocalPoint(0,0,0);
    //       this.camera.setViewUp(0.13197123774694897, 0.16271449778664546, 0.9778075396608363);
    //       this.camera.modified();
    //       this.renderWindow.render();
    //     }
    //     else{
    //       this.camera.setPosition(-365.7588411552863, 50.404193134824666, 123.8848297609219);
    //       this.camera.setFocalPoint(0,0,0);
    //       this.camera.setViewUp(0.2655144010325543, -0.12384734450939862, 0.9561192070564706);
    //       this.camera.modified();
    //       this.renderWindow.render();
    //     }
    //   }

    // }
    class ThreeDView{
          constructor(name,parent) {
            this.name = name;
            this.widget=null;
            this.renderWindow=null;
            this.renderer=null;
            this.parent=parent;
            this.camera=null;
            this.onInit();


          }
          onInit(parent){
            this.widget=vtk.Rendering.Misc.vtkRenderWindowWithControlBar.newInstance({
              background: [0, 0, 0]
            });
            this.widget.setContainer(this.parent);
            this.renderWindow=this.widget.getRenderWindow();
            this.renderer = this.widget.getRenderer();
            this.renderer.setBackground(0.1803921568627451, 0.2980392156862745, 0.4392156862745098)
            this.renderer.setBackground2(0.1803921568627451, 0.2980392156862745, 0.4392156862745098)
            this.renderWindow.addRenderer(this.renderer);
            
            this.camera=this.renderer.getActiveCamera();
            this.camera.setPosition(0, -380, 0);
            this.camera.setFocalPoint(0,0,0);
            this.camera.setViewUp(0, 0, 1);
            this.camera.modified();
            this.renderWindow.render();
          }


          resetCamera(){
            this.camera.setPosition(0, -380, 0);
            this.camera.setFocalPoint(0,0,0);
            this.camera.setViewUp(0, 0, 1);
            this.camera.modified();
            this.renderWindow.render();
          }

          setCameraPisitionByIndex(index){
            if(index===0){
              this.camera.setPosition(0, -380, 0);
              this.camera.setFocalPoint(0,0,0);
              this.camera.setViewUp(0, 0, 1);
              this.camera.modified();
              this.renderWindow.render();
            }
            else if(index===1){
              this.camera.setPosition(-380, 0, 0);
              this.camera.setFocalPoint(0,0,0);
              this.camera.setViewUp(0, 0, 1);
              this.camera.modified();
              this.renderWindow.render();
            }
            else{
              this.camera.setPosition(0, 0, 380);
              this.camera.setFocalPoint(0,0,0);
              this.camera.setViewUp(0, 1, 0);
              this.camera.modified();
              this.renderWindow.render();
            }
          }

        }


    class MyVTKScene {
      constructor() {
        this.Models = [];
        this.Markups = [];
        this.TransForms = [];
        this.clips = [];
        this.chats = [];
        this.views = [];
        this.selectes = [];
        this.tracker=null;
        this.onInit();
        this.operationPlane=null;
        this.pinggu=null;
        this.patient={
          name:"",
          age:"",
          ID:"",
          sex:"female",
          birthDate:"",
          creatDate:"",
          shuShi:"surgeryKneeJoint",
          partion:"",
          LorR:"affectedSideLeft",
          shouShuJiShu:"CTMRI",
          shouShuQiXie:"OsteotomyPlate",
          shouShuShunXu:"FemurFirst",
          JianXiPingHeng:"osteotomyBalance"
        };
        this.obbserve={
        updatePinggu:0,
        updateGuihua:0
        };
      }



      onInit(){
      let chat1=this.AddChat("ssm");
      chat1.connect();
      var view_femur=new selectePoints("Femur",this,"Femur");
      var view_tibia=new selectePoints("Tibia",this,"Tibia");
      this.selectes.push(view_femur);
      this.selectes.push(view_tibia);
      var transformMatrix1 = this.AddTransform("DianjiToTracker1",[
      [1, 0, 0, 0], // x 轴正方向平移 10 个单位
      [0, 1, 0, 0],  // y 轴不变
      [0, 0, 1, 0],  // z 轴不变
      [0, 0, 0, 1],  // 不进行透视变换
      ]);
      var transformMatrix2 = this.AddTransform("TibiaToTracker",[
      [1, 0, 0, 0], // x 轴正方向平移 10 个单位
      [0, 1, 0, 0],  // y 轴不变
      [0, 0, 1, 0],  // z 轴不变
      [0, 0, 0, 1],  // 不进行透视变换
      ]);
      var transformMatrix3 = this.AddTransform("KnifeToTracker",[
      [1, 0, 0, 0], // x 轴正方向平移 10 个单位
      [0, 1, 0, 0],  // y 轴不变
      [0, 0, 1, 0],  // z 轴不变
      [0, 0, 0, 1],  // 不进行透视变换
      ]);
      var transformMatrix4 = this.AddTransform("StylusTipToStylus",[[ 3.15081000e-01,  1.63258000e-02, -9.48924000e-01,
                    -2.01498000e+02],
                  [ 9.49051000e-01, -8.67361818e-19,  3.15123000e-01,
                    4.07555000e+01],
                  [ 5.14465000e-03, -9.99867000e-01, -1.54941000e-02,
                    -1.77120000e+01],
                  [ 0.00000000e+00,  0.00000000e+00,  0.00000000e+00,
                    1.00000000e+00]]);
      transformMatrix4.parent=transformMatrix3;
      //this.StartChatWithTracker();
    }

      AddThreeDView(name,parent){
        var view=new ThreeDView(name,parent);
        this.views.push(view);
      }

      
      AddActor(actor){
        for(var i=0;i<this.views.length;i++){
          this.views[i].renderer.addActor(actor);
          this.views[i].renderWindow.render();
        }
      }

      RemoveActor(actor){
        for(var i=0;i<this.views.length;i++){
          this.views[i].renderer.removeActor(actor);
          this.views[i].renderWindow.render();
        }

      }


      updateThreeDView(){
        for(var i=0;i<this.views.length;i++){
          this.views[i].renderWindow.render();
        }
      }


      AddModel1(name, path) {
        // 返回一个Promise对象
        return new Promise((resolve, reject) => {
            console.log("开始加载1");
            reader.setUrl(path).then(() => {
                console.log("开始加载2");
                const polydata = reader.getOutputData();

                const mapper = vtk.Rendering.Core.vtkMapper.newInstance();
                mapper.setInputData(polydata);
                const actor = vtk.Rendering.Core.vtkActor.newInstance();
                actor.setMapper(mapper);
                actor.getProperty().setColor(1, 1, 0);

                this.AddActor(actor);

                console.log("开始加载3");
                let model1 = new Model(name, polydata, actor,this);
                this.Models.push(model1);
                console.log("开始加载4");
                
                // 异步操作完成后调用resolve方法返回结果
                resolve(model1);
            }).catch((error) => {
                // 异步操作出现错误时调用reject方法返回错误信息
                reject(error);
            });
        });
      }




      AddModel(name,path) {
        console.log("开始加载1");
        reader.setUrl(path).then(() => {
        console.log("开始加载2");
        const polydata = reader.getOutputData();


        //onst glwindow = renderWindow.getInteractor().getRenderWindow();
        // glwindow.setViewport(0, 0, width, height);

        // 创建vtk.js映射器和演员
        const mapper = vtk.Rendering.Core.vtkMapper.newInstance();
        mapper.setInputData(polydata);
        const actor = vtk.Rendering.Core.vtkActor.newInstance();
        actor.setMapper(mapper);
        actor.getProperty().setColor(1, 1, 0); // 黄色

        // 将演员添加到渲染器中
        this.AddActor(actor);

        console.log("开始加载3");
        let model1= new Model(name,polydata,actor,this);
        this.Models.push(model1);
        console.log("开始加载4");
        console.log("开始加载5");
        return model1;
        //return this.getModelByName(name);
        });

      }




      AddModelByPolydata(name,Polydata) {
        // 创建vtk.js映射器和演员
        const mapper = vtk.Rendering.Core.vtkMapper.newInstance();
        mapper.setInputData(Polydata);
        const actor = vtk.Rendering.Core.vtkActor.newInstance();
        actor.setMapper(mapper);
        actor.getProperty().setColor(1, 1, 0); // 黄色

        // 将演员添加到渲染器中
        this.AddActor(actor);

        
        let model1= new Model(name,Polydata,actor,this);
        this.Models.push(model1);
        return model1;
      }

      AddModelByFilter(name,Filter) {
          // 创建vtk.js映射器和演员
          const mapper = vtk.Rendering.Core.vtkMapper.newInstance();
          mapper.setInputConnection(Filter.getOutputPort());
          const actor = vtk.Rendering.Core.vtkActor.newInstance();
          actor.setMapper(mapper);
          actor.getProperty().setColor(1, 1, 0); // 黄色

          // 将演员添加到渲染器中
          this.AddActor(actor);

          
          let model1= new Model(name,"Polydata",actor,this);
          this.Models.push(model1);
          return model1;
        }



      RemoveModel(name){
        var model= this.Models.filter(model => model.getName() === name)[0];
        this.RemoveActor(model.actor);
        var index = this.Models.indexOf(model); // 获取元素的索引
        if (index > -1) {
          this.Models.splice(index, 1); // 移除元素
        }
      }

      getModelByName(name) {
        return this.Models.find(model => model.getName() === name);
      }

      AddMarkups(name) {
        let Markups= new Markup(name,this);
        this.Markups.push(Markups);
        return Markups;
      }

      RemoveMarkups(name){
        var point = this.Markups.filter(model => model.getName() === name)[0];
        var index = this.Markups.indexOf(point); // 获取元素的索引
        if (index > -1) {
          this.Markups.splice(index, 1); // 移除元素
        }
        point.RemoveAllPoints();
      }

      getMarkupsByName(name) {
        return this.Markups.find(model => model.getName() === name);
      }



      AddTransform(name,trans) {
        let Trans= new TransformMatrix(name,trans);
        this.TransForms.push(Trans);
        return Trans;
      }

      RemoveTransform(name){
        this.TransForms = this.TransForms.filter(model => model.getName() !== name);
      }

      getTransformByName(name) {
        return this.TransForms.find(model => model.getName() === name);
      }

      AddClip(name) {
        if (name==="Femur"){
        let clip= new FemurClip(name,this,1);
        this.clips.push(clip);
        return clip;
      }
      else{
        let clip= new TibiaClip(name,this,1);
        this.clips.push(clip);
        return clip;
      }
      }

      RemoveClip(name){
        this.clips = this.clips.filter(model => model.getName() === name);
      }

      getClipByName(name) {
        return this.clips.find(model => model.getName() === name);
      }

      AddChat(name) {
        let chat= new Chat(name,this);
        this.chats.push(chat);
        return chat;

      }

      RemoveChat(name){
        this.chats = this.chats.filter(model => model.getName() === name);
      }

      getClipByName(name) {
        return this.chats.find(model => model.getName() === name);
      }
      
      AddOperationPlane(){
          this.operationPlane=new OperationPlane("plane",this,this.clips[0],this.clips[1]);
        }

      AddPingGu(){
        this.pinggu=new Pinggu("pinggu",this);
      }



    }

    //通讯类，实现通讯及数据加载
    class Chat {
      constructor(name,scene) {
        this.name=name;
        this.MyScene = scene;
        this.socket=null;
        this.myMatrices=null;
        this.myPoints=null;
        this.myPoints1=null;
        this.jtName_Femur=null;
        this.jtName_Tibia=null;
      }

      connect(){
        this.socket = io.connect('http://localhost:5006');

        this.socket.on('connect', function() {
            console.log('connected');
        });

        this.socket.on('matrices_femur', function(matrices) {
        // 将Python的list转换为JavaScript的array
        this.myMatrices = JSON.parse(JSON.stringify(matrices));
        console.log(this.myMatrices);
        
        
        });

        this.socket.on('points_femur', function(matrices) {
        // 将Python的list转换为JavaScript的array
        this.myPoints = JSON.parse(JSON.stringify(matrices));
        console.log(this.myPoints);
        
        });

        this.socket.on('points1_femur', function(matrices) {
        // 将Python的list转换为JavaScript的array
        this.myPoints1 = JSON.parse(JSON.stringify(matrices));
        console.log(this.myPoints1);
        
        });
        var self = this;
        this.socket.on('jtPath_femur', function(matrices) {
          console.log(matrices);
          self.jtName_Femur=matrices;
          self.LoadFemur(this.myMatrices,this.myPoints,this.myPoints1);
        
        });

        //胫骨部分
        this.socket.on('matrices_tibia', function(matrices) {
        // 将Python的list转换为JavaScript的array
        this.myMatrices = JSON.parse(JSON.stringify(matrices));
        console.log(this.myMatrices);
        
        
        });

        this.socket.on('points_tibia', function(matrices) {
        // 将Python的list转换为JavaScript的array
        this.myPoints = JSON.parse(JSON.stringify(matrices));
        console.log(this.myPoints);
        
        });

        this.socket.on('points1_tibia', function(matrices) {
        // 将Python的list转换为JavaScript的array
        this.myPoints1 = JSON.parse(JSON.stringify(matrices));
        console.log(this.myPoints1);
        
        });

        this.socket.on('jtPath_tibia', function(matrices) {
          console.log(matrices);
          self.jtName_Tibia=matrices;
          self.LoadTibia(this.myMatrices,this.myPoints,this.myPoints1);
        
        });


        this.socket.on('sphereFit', function(matrices) {
          // 将Python的list转换为JavaScript的array
          var point= JSON.parse(JSON.stringify(matrices));
          self.MyScene.selectes[0].myPoints.points.splice(9, 0,point);
          
          });



      }

      sendFemur(){
        var points_tosend = [[ 227.52632141,  369.46679688, 2246.38745117],
                      [ 206.02246094,  370.70166016, 2291.43554688],
                      [ 277.71136475,  365.21481323, 2248.02856445],
                      [ 207.4495697 ,  352.50402832, 2265.76660156],
                      [ 242.89430237,  351.21032715, 2242.83862305],
                      [ 225.67062378,  345.6630249 , 2291.02612305],
                      [ 264.90753174,  341.65307617, 2260.88623047],
                      [ 255.04772949,  396.706604  , 2249.20019531],
                      [ 231.29222107,  382.63983154, 2245.92553711],
                      [ 713.        ,  933.        , 2643.        ],
                      [ 713.        ,  933.        , 2643.        ],
                      [ 210.6875    ,  352.18490601, 2263.52880859],
                      [ 210.35490417,  350.13375854, 2266.75244141],
                      [ 207.52487183,  350.47967529, 2269.70751953],
                      [ 203.6516571 ,  354.58966064, 2269.20947266],
                      [ 202.887146  ,  358.40322876, 2266.18505859],
                      [ 205.10565186,  361.38659668, 2259.61010742],
                      [ 208.42286682,  360.16226196, 2257.09741211],
                      [ 212.33003235,  354.42202759, 2260.29223633],
                      [ 213.6799469 ,  349.90460205, 2265.48974609],
                      [ 216.02165222,  345.60140991, 2273.8112793 ],
                      [ 211.43008423,  347.03396606, 2273.35498047],
                      [ 207.45703125,  348.22680664, 2275.18237305],
                      [ 238.07624817,  359.3729248 , 2237.81176758],
                      [ 241.65228271,  358.51086426, 2234.54663086],
                      [ 244.15953064,  353.87905884, 2237.46240234],
                      [ 247.340271  ,  350.85095215, 2238.94287109],
                      [ 249.09942627,  347.19638062, 2242.8503418 ],
                      [ 247.56245422,  345.42498779, 2247.35888672],
                      [ 243.79954529,  346.60137939, 2250.13305664],
                      [ 238.90013123,  350.87011719, 2248.6328125 ],
                      [ 234.57199097,  356.10043335, 2247.70410156],
                      [ 236.59127808,  355.5479126 , 2244.74023438],
                      [ 238.81384277,  355.56689453, 2241.3996582 ],
                      [ 238.58630371,  356.92861938, 2239.94189453],
                      [ 238.99925232,  352.31253052, 2245.96484375],
                      [ 241.69519043,  349.59356689, 2246.57714844],
                      [ 243.17947388,  348.6579895 , 2246.39282227],
                      [ 246.64756775,  349.96844482, 2240.85766602],
                      [ 251.13375854,  347.82723999, 2240.5847168 ],
                      [ 222.37188721,  344.40411377, 2288.22753906],
                      [ 228.6607666 ,  345.64431763, 2289.73339844],
                      [ 229.88613892,  347.29074097, 2292.19287109],
                      [ 228.39692688,  349.4317627 , 2295.25170898],
                      [ 226.09159851,  350.48007202, 2297.06738281],
                      [ 223.74203491,  349.91574097, 2297.34521484],
                      [ 220.11247253,  347.06164551, 2294.77563477],
                      [ 218.01347351,  345.28274536, 2291.02856445],
                      [ 216.07287598,  344.7326355 , 2288.00341797],
                      [ 219.33396912,  343.89093018, 2284.86230469],
                      [ 224.99055481,  343.88754272, 2283.74487305],
                      [ 230.3747406 ,  344.87963867, 2285.30883789],
                      [ 233.0770874 ,  346.57925415, 2288.57958984],
                      [ 233.91340637,  349.13015747, 2291.71240234],
                      [ 234.82514954,  353.69400024, 2294.79418945],
                      [ 231.19848633,  356.43881226, 2298.44750977],
                      [ 227.97064209,  355.61303711, 2299.64331055],
                      [ 262.74679565,  341.08349609, 2259.7331543 ],
                      [ 265.24533081,  341.02496338, 2259.51196289],
                      [ 267.28192139,  341.73858643, 2260.83935547],
                      [ 265.80853271,  343.17034912, 2263.70751953],
                      [ 262.7510376 ,  343.38146973, 2263.59228516],
                      [ 259.91094971,  342.99755859, 2262.66210938],
                      [ 257.66571045,  341.80661011, 2259.26879883],
                      [ 259.12127686,  340.91183472, 2256.98681641],
                      [ 263.01086426,  340.25076294, 2255.9675293 ],
                      [ 266.28967285,  340.24551392, 2256.2175293 ],
                      [ 269.2567749 ,  341.09024048, 2258.53100586],
                      [ 271.34210205,  342.12216187, 2260.18237305],
                      [ 270.72875977,  343.53231812, 2263.20166016],
                      [ 268.27612305,  347.27587891, 2268.06640625],
                      [ 264.64523315,  349.6111145 , 2270.44799805],
                      [ 262.69793701,  349.34628296, 2270.27929688],
                      [ 258.84078979,  347.79821777, 2268.25537109],
                      [ 253.44760132,  345.92260742, 2264.5859375 ],
                      [ 252.4881897 ,  344.30880737, 2261.41894531],
                      [ 253.02655029,  342.77172852, 2258.31811523],
                      [ 256.60827637,  341.09472656, 2253.85229492],
                      [ 260.39425659,  340.57925415, 2251.41210938],
                      [ 265.06515503,  340.17123413, 2251.81933594],
                      [ 269.20797729,  340.3644104 , 2254.63964844],
                      [ 271.80932617,  341.71661377, 2258.48852539],
                      [ 272.80233765,  342.85473633, 2260.77416992],
                      [ 272.61520386,  345.12866211, 2264.45678711],
                      [ 263.11459351,  345.70318604, 2266.76635742],
                      [ 257.86108398,  397.11849976, 2249.27563477],
                      [ 257.55743408,  398.94195557, 2250.80053711],
                      [ 254.23884583,  399.07977295, 2253.27001953],
                      [ 251.42858887,  398.2855835 , 2255.28759766],
                      [ 250.1769104 ,  397.89810181, 2256.21875   ],
                      [ 252.17980957,  396.14407349, 2251.09863281],
                      [ 255.32313538,  395.34616089, 2246.94116211],
                      [ 257.72183228,  393.72067261, 2245.37109375],
                      [ 261.85354614,  389.97549438, 2246.39477539],
                      [ 262.0446167 ,  392.86590576, 2248.8359375 ],
                      [ 260.89224243,  395.83053589, 2249.78564453],
                      [ 260.75363159,  398.32635498, 2251.35986328],
                      [ 260.12234497,  400.20870972, 2252.62207031],
                      [ 254.89524841,  402.65933228, 2256.45532227]];
        this.socket.emit('Points_Femur', points_tosend);
        console.log("已发送");
      }

      sendTibia(){
        var points_tosend_tibia=[[ 9.17872009e+01, -6.74888229e+00, -4.83451263e+02],
                                [ 2.99031677e+01, -1.23004465e+01, -7.98364685e+02],
                                [ 8.47819748e+01, -3.37282944e+01, -8.15066895e+02],
                                [ 6.81886368e+01,  4.75990832e-01, -4.91216675e+02],
                                [ 1.09931099e+02, -3.47301602e+00, -4.91283447e+02],
                                [ 9.88171463e+01,  2.92601719e+01, -5.31324463e+02],
                                [ 6.74996109e+01,  3.28542972e+00, -4.90962646e+02],
                                [ 6.49955902e+01,  6.79571569e-01, -4.91312988e+02],
                                [ 6.58530197e+01, -1.96447682e+00, -4.91439362e+02],
                                [ 6.79965515e+01, -2.60135794e+00, -4.91442688e+02],
                                [ 7.07400589e+01, -1.21314275e+00, -4.91163757e+02],
                                [ 7.08418655e+01,  1.64768124e+00, -4.90919922e+02],
                                [ 6.90981369e+01,  4.08411503e+00, -4.90714539e+02],
                                [ 6.40193863e+01,  4.71827126e+00, -4.90381409e+02],
                                [ 6.24954681e+01,  8.10277641e-01, -4.91189545e+02],
                                [ 6.30751419e+01, -2.40670848e+00, -4.91438782e+02],
                                [ 6.54662781e+01, -4.63798618e+00, -4.91476196e+02],
                                [ 6.82040024e+01, -4.72091150e+00, -4.91473053e+02],
                                [ 7.20493240e+01, -3.78528476e+00, -4.91084045e+02],
                                [ 7.32477570e+01,  1.03136933e+00, -4.90158752e+02],
                                [ 7.13067932e+01,  3.50222969e+00, -4.90493073e+02],
                                [ 6.72050629e+01,  5.69238424e+00, -4.90292969e+02],
                                [ 7.00186844e+01, -5.34239912e+00, -4.91382721e+02],
                                [ 1.11618629e+02, -5.47758007e+00, -4.91517456e+02],
                                [ 1.12143845e+02, -1.79224253e+00, -4.91225769e+02],
                                [ 1.08232750e+02, -1.24491620e+00, -4.90573914e+02],
                                [ 1.06990074e+02, -5.63098240e+00, -4.90818878e+02],
                                [ 1.09326141e+02, -7.28858280e+00, -4.91540771e+02],
                                [ 1.12276764e+02, -8.49720478e+00, -4.91952454e+02],
                                [ 1.14607155e+02, -4.45204496e+00, -4.91278656e+02],
                                [ 1.14331932e+02, -1.07792366e+00, -4.90701782e+02],
                                [ 1.09929504e+02,  9.34930265e-01, -4.90224945e+02],
                                [ 1.06649139e+02, -3.52308042e-02, -4.89614594e+02],
                                [ 1.05333244e+02, -5.46385241e+00, -4.89962830e+02],
                                [ 1.05631195e+02, -9.65916920e+00, -4.90216125e+02],
                                [ 9.90910263e+01,  3.02778473e+01, -5.26209167e+02],
                                [ 1.01395187e+02,  2.98826866e+01, -5.23195068e+02],
                                [ 1.03378700e+02,  2.95359650e+01, -5.24111694e+02],
                                [ 1.02603462e+02,  2.91087437e+01, -5.29810730e+02],
                                [ 1.01617310e+02,  2.81311932e+01, -5.34946228e+02],
                                [ 9.92253571e+01,  2.73534298e+01, -5.37414368e+02],
                                [ 9.45803833e+01,  2.76280651e+01, -5.35837097e+02],
                                [ 9.30810547e+01,  2.79969997e+01, -5.31619934e+02],
                                [ 9.35769730e+01,  2.92135944e+01, -5.26666809e+02],
                                [ 9.43448563e+01,  2.95133686e+01, -5.23799500e+02],
                                [ 9.62670517e+01,  3.01020927e+01, -5.21176208e+02],
                                [ 9.90321198e+01,  3.00250740e+01, -5.19095642e+02],
                                [ 1.02085320e+02,  2.94339066e+01, -5.19106262e+02],
                                [ 1.05464096e+02,  2.85969505e+01, -5.22557007e+02],
                                [ 1.05808128e+02,  2.81505814e+01, -5.26594910e+02],
                                [ 1.00253693e+02,  3.00826187e+01, -5.25665466e+02],
                                [ 9.50857086e+01,  2.88112679e+01, -5.32093628e+02],
                                [ 9.55979843e+01,  2.99128113e+01, -5.27006531e+02]];
        this.socket.emit('Points_Tibia', points_tosend_tibia);
        console.log("已发送");
      }


      LoadFemur(trans_list,point_list,point_list1){
        console.log("加载股骨");

        //添加矩阵
        // const transformMatrix1 = MyScene.AddTransform("rasToWorld",[
        //   [-1, 0, 0, 0], // x 轴正方向平移 10 个单位
        //   [0, -1, 0, 0],  // y 轴不变
        //   [0, 0, 1, 0],  // z 轴不变
        //   [0, 0, 0, 1],  // 不进行透视变换
        // ]);
        console.log("开始加载");
        var Ftransform1 = this.MyScene.AddTransform('变换_股骨临时', trans_list[0]);
        var Ftransform11 = this.MyScene.AddTransform('变换_股骨约束', trans_list[1]);
        var Ftransform12 = this.MyScene.AddTransform('变换_股骨调整', trans_list[2]);
        var Ftransform13 = this.MyScene.AddTransform('变换_股骨假体调整',trans_list[3]);
        var Ftransform18 = this.MyScene.AddTransform('变换_1',trans_list[4]);
        var Ftransform14 = this.MyScene.AddTransform('jtTo0_ni',trans_list[5]);
        var Ftransform15 = this.MyScene.AddTransform('trans_quxi',trans_list[6]);
        var Ftransform16 = this.MyScene.AddTransform('jtTo0',trans_list[7]);
        Ftransform12.parent = Ftransform11;
        Ftransform11.parent = Ftransform13;
        Ftransform15.parent=Ftransform14;
        Ftransform16.parent=Ftransform15;
        //Ftransform13.parent = transformMatrix1;
        //添加模型
        console.log("开始加载0");
        MyScene.AddModel1("Femurasd", 'static/asset/Femur.stl').then((femur1) => {
        //var femur1=MyScene.AddModel("Femurasd",'static/asset/Femur.stl').then(() => {

        console.log("开始加载——end");
        //console.log("femur1",femur1);
        //var jt=MyScene.AddModel("Femur_jt",jtPath);
        var femur2=MyScene.getModelByName("Femurasd");
        console.log(femur2);
        femur2.setParent(Ftransform12);
        femur2.UpdatePosition();
        //添加实时跟随骨骼的点
        var FemurPoints = ['开髓点', '内侧凹点', '外侧凸点', '内侧远端', '外侧远端', '内侧后髁', '外侧后髁', '外侧皮质高点', 'A点', "股骨头球心",'H点'];
        for (let i = 0; i < 11; i++) {
          var point = this.MyScene.AddMarkups(FemurPoints[i]);
          point.AddPoints([point_list[i][0],point_list[i][1],point_list[i][2]]);
          point.setVisibility(0);
        }
        //添加用于规划的点
        var FemurPoints1 = ['开髓点1', '内侧凹点1', '外侧凸点1', '内侧远端1', '外侧远端1', '内侧后髁1', '外侧后髁1', '外侧皮质高点1', 'A点1', "股骨头球心1",'H点1'];
        for (let i = 0; i < 11; i++) {
          var point = this.MyScene.AddMarkups(FemurPoints1[i]);
          point.parent = Ftransform12;
          point.AddPoints([-point_list1[i][0],-point_list1[i][1],point_list1[i][2]]);
          
          //point.updateSpheraPosition();
          
        }});



      }

      LoadTibia(trans_list,point_list,point_list1){

        //添加矩阵
        // const transformMatrix1 = MyScene.AddTransform("rasToWorld",[
        //   [-1, 0, 0, 0], // x 轴正方向平移 10 个单位
        //   [0, -1, 0, 0],  // y 轴不变
        //   [0, 0, 1, 0],  // z 轴不变
        //   [0, 0, 0, 1],  // 不进行透视变换
        // ]);
        console.log("开始加载");
        var Ftransform1 = this.MyScene.AddTransform('变换_胫骨临时', trans_list[0]);
        var Ftransform11 = this.MyScene.AddTransform('变换_胫骨约束', trans_list[1]);
        var Ftransform12 = this.MyScene.AddTransform('变换_胫骨调整', trans_list[2]);
        var Ftransform13 = this.MyScene.AddTransform('变换_4',trans_list[3]);
        Ftransform12.parent = Ftransform11;
        //Ftransform13.parent = transformMatrix1;
        //添加模型
        console.log("开始加载0");
        this.MyScene.AddModel1("Tibiaasd", 'static/asset/Tibia.stl').then((femur1) => {
        //var femur1=MyScene.AddModel("Femurasd",'static/asset/Femur.stl').then(() => {

        console.log("开始加载——end");
        //console.log("femur1",femur1);
        //var jt=MyScene.AddModel("Tibia_jt",jtPath);
        var femur2=MyScene.getModelByName("Tibiaasd");
        console.log(femur2);
        femur2.setParent(Ftransform12);
        femur2.UpdatePosition();
        //添加实时跟随骨骼的点
        var TibiaPoints = ['胫骨隆凸','胫骨结节','外侧高点','内侧高点','踝穴中心']
        for (let i = 0; i < 5; i++) {
          var point = this.MyScene.AddMarkups(TibiaPoints[i]);
          point.AddPoints([point_list[i][0],point_list[i][1],point_list[i][2]]);
          point.setVisibility(0);
        }
        //添加用于规划的点
        var TibiaPoints1 =['胫骨隆凸1','胫骨结节1','外侧高点1','内侧高点1','踝穴中心1']
        for (let i = 0; i < 5; i++) {
          var point = this.MyScene.AddMarkups(TibiaPoints1[i]);
          point.parent = Ftransform12;
          point.AddPoints([point_list1[i][0],point_list1[i][1],point_list1[i][2]]);
          
          //point.updateSpheraPosition();
          
        }

        let clip1=MyScene.AddClip("Femur");
        clip1.parent=MyScene.getTransformByName("变换_股骨调整");
        var poly1=clip1.clip("Femurasd",MyScene.chats[0].jtName_Femur);
        let clip2=MyScene.AddClip("Tibia");
        clip2.parent=MyScene.getTransformByName("变换_胫骨调整");
        var poly1=clip2.clip("Tibiaasd",MyScene.chats[0].jtName_Tibia);
    
        this.MyScene.AddPingGu();
        this.MyScene.AddOperationPlane();
        document.getElementById('guguSize').innerText = MyScene.chats[0].jtName_Femur.replace(/-/g,'');
        let tbianame = MyScene.chats[0].jtName_Tibia.replace(/-/g,'');
        // console.log("================",MyScene.chats[0].jtName_Tibia)
        document.getElementById('jingguSize').innerText = tbianame;
        document.getElementById('houduSize').innerText = tbianame.replace("Tibia","Insert");

        MyScene.operationPlane.caculateInformation();
      });
        }
    }
    
      
    //选点类，确定股骨还是胫骨，仅需要调用onSelect1就可以了，
    //最终选完的点会存在this.myPoints点列里
    class selectePoints {
      constructor(name,scene,FemurOrTibia) {
        this.name = name;
        this.MyScene = scene;
        this.currentPointsNum=0;
        this.myPoints=null;
        this.FemurOrTibia=FemurOrTibia;
        this.MeshPointsNum=0;//记录面上点的个数
        this.onInit();
      }

      //股骨选点初始化

      onInit(){
        this.myPoints=this.MyScene.AddMarkups(this.name+"To");
        if (this.FemurOrTibia==="Femur"){
          this.myPoints.parent=this.MyScene.getTransformByName("DianjiToTracker1");
          this.gugutou=this.MyScene.AddMarkups("股骨头拟合");
        }
        else{
          this.myPoints.parent=this.MyScene.getTransformByName("TibiaToTracker");
        }
      }






      onSelect1(){
        if (this.FemurOrTibia==="Femur"){
          if (this.currentPointsNum< 10) {
              this.SelectSinglePoint();
              onSelectPoint(this.name,this.currentPointsNum);//选中
              this.currentPointsNum+=1;
              onChangePointsImage(this.currentPointsNum)//切换图片
              onPraperSelectPoint(this.name,this.currentPointsNum);//预选
            } else if (this.currentPointsNum === 10) {
              // 股骨头球心的点
              this.onGuGuTou();
              //从股骨头开始多选计数，将当前多选的点的个数存入this.MeshPointsNum中
              if (this.MeshPointsNum===0){
                var num1=0;
                this.MeshPointsNum+=1;
              }
              else{
              this.MeshPointsNum+=1;
              morePoints(this.name,this.MeshPointsNum,this.currentPointsNum);
            }

            } else {
              this.SelectSinglePoint();
              if (!this.JudgePointInRightPosition()){
                this.myPoints.RemovePointByIndex(this.myPoints.length-1);
              }
              else{
                this.MeshPointsNum+=1;
                morePoints(this.name,this.MeshPointsNum,this.currentPointsNum);
              }
            }
          }
          else{
            if (this.currentPointsNum< 6) {
              onSelectPoint(this.name,this.currentPointsNum);
              this.SelectSinglePoint();
              this.currentPointsNum+=1;
              onChangePointsImage(this.currentPointsNum)
              onPraperSelectPoint(this.name,this.currentPointsNum);
            } 
            else {
              this.SelectSinglePoint();
              if (!this.JudgePointInRightPosition()){
                this.myPoints.RemovePointByIndex(this.myPoints.length-1);
              }
              else{
                this.MeshPointsNum+=1;
                morePoints(this.name,this.MeshPointsNum,this.currentPointsNum);
              }
            }
          }
      }
      //选取下一区域的点
      OnNextArea(){
        //首先拟合股骨头上的点，并添加至To内
        
        if (this.currentPointsNum=== 10) {
          if (this.FemurOrTibia==="Femur"){
            this.onGuGuTouConFirm();
          }
        }
        onSelectPoint(this.name,this.currentPointsNum);
        this.currentPointsNum+=1;
        onPraperSelectPoint(this.name,this.currentPointsNum);
        var num1=0;
        this.MeshPointsNum=0;
        if (this.FemurOrTibia==="Femur"){
          if (this.currentPointsNum=== 16) {
          this.MyScene.chats[0].sendFemur();
          document.getElementById('menu-btn4').click();
        }

        }
        else{
          if (this.currentPointsNum=== 9) {
          this.MyScene.chats[0].sendTibia();
          document.getElementById('menu-btn5').click();
          }
        }

      }
      
      SelectSinglePoint(){
        if (this.FemurOrTibia==="Femur"){
          this.myPoints.AddPointsByStylusInTool("DianjiToTracker1");
        }
        else{
          this.myPoints.AddPointsByStylusInTool("TibiaToTracker");
        }
        
      }

      onGuGuTou(){
        this.gugutou.AddPointsByStylusInTool("DianjiToTracker1");
      }


      onGuGuTouConFirm(){
          var points=this.gugutou.points;
          this.MyScene.chats[0].socket.emit('sphereFit',points);

      }
        
      
      JudgePointInRightPosition(){
        if (this.FemurOrTibia==="Femur"){
          //股骨当前面所对应点为当前点数减去单选点数+股骨头球心，再加上3
          var p1=this.myPoints.points[this.currentPointsNum-10+3];
        }
        else{
          var p1=this.myPoints.points[this.currentPointsNum-6];
        }
        var p2=this.myPoints.points[this.myPoints.points.length-1];
        if(this.distance(p1,p2)<20){
          return 1;

        }
        else{
          return 0
        }

      }

      distance(A, B) {
        var dx = A[0] - B[0];
        var dy = A[1] - B[1];
        var dz = A[2] - B[2];
        return math.sqrt(dx*dx + dy*dy + dz*dz);
      }
      //重置

      onReset(){
        onResetPoints(this.name);
        this.currentPointsNum=0;
        this.MeshPointsNum=0;
        this.myPoints.RemoveAllPoints();
        this.gugutou.RemoveAllPoints();
      }
    
    }



    //角度计算类
    class Pinggu {
      constructor(name,scene) {
        this.name = name;
        this.MyScene = scene;
        this.currentY=0;
        this.currentX=0;
        this.onInit();
      }

      onInit(){
        var trans_1=this.MyScene.getTransformByName("变换_1");
        trans_1.parent=this.MyScene.getTransformByName("DianjiToTracker1");
        var trans_4=this.MyScene.getTransformByName("变换_4");
        trans_4.parent=this.MyScene.getTransformByName("TibiaToTracker");
        var o = [0, 0, 0];
        var z = [0, 0, 1];
        var y = [0, 1, 0];
        var x = [1, 0, 0];

        var point = this.MyScene.AddMarkups('Femur_ZAxis');
        point.AddPoints(o);
        point.AddPoints(z);
        point.parent=trans_1;
        point.setVisibility(0);

        var point = this.MyScene.AddMarkups('Femur_XAxis');
        point.AddPoints(o);
        point.AddPoints(x);
        point.parent=trans_1;
        point.setVisibility(0);

        var point = this.MyScene.AddMarkups('Tibia_ZAxis');
        point.AddPoints(o);
        point.AddPoints(z);
        point.parent=trans_4;
        point.setVisibility(0);

        var point = this.MyScene.AddMarkups('Tibia_XAxis');
        point.AddPoints(o);
        point.AddPoints(x);
        point.parent=trans_4;
        point.setVisibility(0);

        var point = this.MyScene.AddMarkups('Tibia_YAxis');
        point.AddPoints(o);
        point.AddPoints(y);
        point.parent=trans_4;
        point.setVisibility(0);

        var point = this.MyScene.AddMarkups('Tibia_XYPlane');
        point.AddPoints(o);
        point.AddPoints(x);
        point.AddPoints(y);
        point.parent=trans_4;
        point.setVisibility(0);

        var point = this.MyScene.AddMarkups('Tibia_YZPlane');
        point.AddPoints(o);
        point.AddPoints(y);
        point.AddPoints(z);
        point.parent=trans_4;
        point.setVisibility(0);

      }

      TouYing(planePoints,p) {
        // 计算平面法向量
        let v1 = [planePoints[1][0]-planePoints[0][0], planePoints[1][1]-planePoints[0][1], planePoints[1][2]-planePoints[0][2]];
        let v2 = [planePoints[2][0]-planePoints[0][0], planePoints[2][1]-planePoints[0][1], planePoints[2][2]-planePoints[0][2]];
        let normal = [v1[1]*v2[2]-v1[2]*v2[1], v1[2]*v2[0]-v1[0]*v2[2], v1[0]*v2[1]-v1[1]*v2[0]];
        
        // 计算平面上一点
        let planePoint = planePoints[0];
        
        // 计算点到平面的距离
        let distance = (p[0]-planePoint[0])*normal[0] + (p[1]-planePoint[1])*normal[1] + (p[2]-planePoint[2])*normal[2];
        
        // 计算点在平面上的投影点
        let projection = [p[0]-normal[0]*distance, p[1]-normal[1]*distance, p[2]-normal[2]*distance];
        
        return projection;
      }
      
      
      Angle(norm1, norm2) {
        let dotProduct = norm1[0]*norm2[0] + norm1[1]*norm2[1] + norm1[2]*norm2[2];
        let norm1Magnitude = math.sqrt(norm1[0]*norm1[0] + norm1[1]*norm1[1] + norm1[2]*norm1[2]);
        let norm2Magnitude = math.sqrt(norm2[0]*norm2[0] + norm2[1]*norm2[1] + norm2[2]*norm2[2]);
        let cosine = dotProduct / (norm1Magnitude * norm2Magnitude);
        let angleInRadians = math.acos(cosine);
        let angleInDegrees = angleInRadians * 180 / math.PI;
        return angleInDegrees;
      }



      sub(listA,listB){
        return [listA[0]-listB[0],listA[1]-listB[1],listA[2]-listB[2]];
      }

      add(listA,listB){
        return [listA[0]+listB[0],listA[1]+listB[1],listA[2]+listB[2]];
      }

      dot(listA,listB){
        return listA[0]*listB[0]+listA[1]*listB[1]+listA[2]*listB[2];
      }

      GetNorlm(NodeName){
        let ras1=this.MyScene.getMarkupsByName(NodeName).getPointsWorld()[0];
        let ras2=this.MyScene.getMarkupsByName(NodeName).getPointsWorld()[1];
        return this.sub(ras2,ras1);
      }

      caculateTouYingNorml(NName, PlaneName){
        let PlaneNode=this.MyScene.getMarkupsByName(PlaneName).getPointsWorld();
        let ras1=this.MyScene.getMarkupsByName(NName).getPointsWorld()[0];
        let ras2=this.MyScene.getMarkupsByName(NName).getPointsWorld()[1];
        return this.sub(this.TouYing(PlaneNode,ras2),this.TouYing(PlaneNode,ras1));
      }



      caculateLowPoint() {

      var ras1=this.MyScene.getMarkupsByName('内侧高点').getPointsWorld()[0];
      var ras2=this.MyScene.getMarkupsByName('外侧高点').getPointsWorld()[0];
      var ras3=this.MyScene.getMarkupsByName('内侧远端').getPointsWorld()[0];
      var ras4=this.MyScene.getMarkupsByName('外侧远端').getPointsWorld()[0];
      var ras5=this.MyScene.getMarkupsByName('内侧后髁').getPointsWorld()[0];
      var ras6=this.MyScene.getMarkupsByName('外侧后髁').getPointsWorld()[0];

      var Femur_ZAxis_Z = this.caculateTouYingNorml('Femur_ZAxis', 'Tibia_YZPlane');
      var Tibia_ZAxis = this.GetNorlm('Tibia_ZAxis');
      var quxiAngle = this.Angle(Femur_ZAxis_Z, Tibia_ZAxis);

      var Tibia_XAxis = this.GetNorlm('Tibia_XAxis');
      var Tibia_YAxis = this.GetNorlm('Tibia_YAxis');
      var Femur_XAxis = this.GetNorlm('Femur_XAxis');
      var Femur_ZAxis = this.GetNorlm('Femur_ZAxis');
      var ifzf1 = this.dot(Tibia_YAxis, Femur_ZAxis);


      if (ifzf1 < 0) {
        quxiAngle = -quxiAngle;
      }

      let Femur_XAxis_Z = this.caculateTouYingNorml('Femur_XAxis', 'Tibia_XYPlane');
      let waifanAngle = this.Angle(Femur_XAxis_Z, Femur_XAxis);

      if (this.dot(Tibia_ZAxis, Femur_XAxis) > 0) {
        waifanAngle = -waifanAngle;
      }

      if (waifanAngle < -14) {
        waifanAngle = -14;
      }

      if (waifanAngle > 14) {
        waifanAngle = 14;
      }

      if (quxiAngle < -14) {
        quxiAngle = -14;
      }

      if (quxiAngle > 130) {
        quxiAngle = 130;
      }

      this.currentY = parseFloat(waifanAngle).toFixed(1);
      this.currentX = parseFloat(quxiAngle).toFixed(1);
      console.log("quxiAngle", quxiAngle);
      console.log("waifanAngle", waifanAngle);



      if(-1 < this.currentX && this.currentX < 1) { //伸直时计算伸直间隙
        var shenzhi_neicejianxi = math.norm(this.sub(ras1 , ras3));
        var shenzhi_waicejianxi = math.norm(this.sub(ras2 , ras4));
        var shenzhi_neicejianxi = math.round(shenzhi_neicejianxi * 10) / 10;
        var shenzhi_waicejianxi = math.round(shenzhi_waicejianxi * 10) / 10;
        //膝关节评估0°内外翻距离UI
        //伸直内侧
        this.B1 = shenzhi_neicejianxi;
        this.A1 = shenzhi_waicejianxi;
      }


      if(89 < this.currentX && this.currentX < 91) { //#屈膝时计算屈膝间隙
        var quxi_neicejianxi = math.norm(this.sub(ras1 , ras5));
        var quxi_waicejianxi = math.norm(this.sub(ras2 , ras6));
        var quxi_neicejianxi = math.round(quxi_neicejianxi * 10) / 10;
        var quxi_waicejianxi = math.round(quxi_waicejianxi * 10) / 10;
        //膝关节评估0°内外翻距离UI
        //伸直内侧
        this.D1 = quxi_neicejianxi;
        this.C1 = quxi_waicejianxi;
      }

      quxiAngle = round(quxiAngle,1);
      //屈膝角、外翻角、伸直屈膝间隙
      document.getElementById('legrectangle').style.transform = `rotate(${quxiAngle}deg)`;
      document.getElementById("shenzhi_waice").innerText = round(this.A1,1) + 'mm';
      document.getElementById("shenzhi_neice").innerText = round(this.B1,1) + 'mm';
      document.getElementById("quxi_neice").innerText = round(this.D1,1) + 'mm';
      document.getElementById("quxi_waice").innerText = round(this.C1,1) + 'mm';
    }

    }



    // class OperationPlane {
    //   constructor(name,scene,myclip_femur,myclip_tibia) {
    //     this.name = name;
    //     this.MyScene = scene;
    //     this.myclip_femur=myclip_femur;
    //     this.myclip_tibia=myclip_tibia;
    //     this.onInit();

    //   }

    //   onInit(){
    //     var trans_1=this.MyScene.getTransformByName("变换_股骨调整");
  
    //     var trans_4=this.MyScene.getTransformByName("变换_胫骨调整");
    
    //     var o = [0, 0, 0];
    //     var z = [0, 0, 1];
    //     var y = [0, 1, 0];
    //     var x = [1, 0, 0];

    //     var point = this.MyScene.AddMarkups('Femur_ZAxis1');
    //     point.AddPoints(o);
    //     point.AddPoints(z);
    //     point.parent=trans_1;
    //     point.setVisibility(0);

    //     var point = this.MyScene.AddMarkups('Femur_XAxis1');
    //     point.AddPoints(o);
    //     point.AddPoints(x);
    //     point.parent=trans_1;
    //     point.setVisibility(0);

    //     var point = this.MyScene.AddMarkups('Tibia_ZAxis1');
    //     point.AddPoints(o);
    //     point.AddPoints(z);
    //     point.parent=trans_4;
    //     point.setVisibility(0);

    //     var point = this.MyScene.AddMarkups('Tibia_XAxis1');
    //     point.AddPoints(o);
    //     point.AddPoints(x);
    //     point.parent=trans_4;
    //     point.setVisibility(0);

    //     var point = this.MyScene.AddMarkups('Tibia_YAxis1');
    //     point.AddPoints(o);
    //     point.AddPoints(y);
    //     point.parent=trans_4;
    //     point.setVisibility(0);

    //     var point = this.MyScene.AddMarkups('Tibia_XYPlane1');
    //     point.AddPoints(o);
    //     point.AddPoints(x);
    //     point.AddPoints(y);
    //     point.parent=trans_4;
    //     point.setVisibility(0);

    //     var point = this.MyScene.AddMarkups('Tibia_YZPlane1');
    //     point.AddPoints(o);
    //     point.AddPoints(y);
    //     point.AddPoints(z);
    //     point.parent=trans_4;
    //     point.setVisibility(0);

    //   }

    //   TouYing(planePoints,p) {
    //     // 计算平面法向量
    //     let v1 = [planePoints[1][0]-planePoints[0][0], planePoints[1][1]-planePoints[0][1], planePoints[1][2]-planePoints[0][2]];
    //     let v2 = [planePoints[2][0]-planePoints[0][0], planePoints[2][1]-planePoints[0][1], planePoints[2][2]-planePoints[0][2]];
    //     let normal = [v1[1]*v2[2]-v1[2]*v2[1], v1[2]*v2[0]-v1[0]*v2[2], v1[0]*v2[1]-v1[1]*v2[0]];
        
    //     // 计算平面上一点
    //     let planePoint = planePoints[0];
        
    //     // 计算点到平面的距离
    //     let distance = (p[0]-planePoint[0])*normal[0] + (p[1]-planePoint[1])*normal[1] + (p[2]-planePoint[2])*normal[2];
        
    //     // 计算点在平面上的投影点
    //     let projection = [p[0]-normal[0]*distance, p[1]-normal[1]*distance, p[2]-normal[2]*distance];
        
    //     return projection;
    //   }
  
      
    //   point2area_distance(planePoints,p) {
    //     // 计算平面法向量
    //     let v1 = [planePoints[1][0]-planePoints[0][0], planePoints[1][1]-planePoints[0][1], planePoints[1][2]-planePoints[0][2]];
    //     let v2 = [planePoints[2][0]-planePoints[0][0], planePoints[2][1]-planePoints[0][1], planePoints[2][2]-planePoints[0][2]];
    //     let normal = [v1[1]*v2[2]-v1[2]*v2[1], v1[2]*v2[0]-v1[0]*v2[2], v1[0]*v2[1]-v1[1]*v2[0]];
        
    //     // 计算平面上一点
    //     let planePoint = planePoints[0];
        
    //     // 计算点到平面的距离
    //     let distance = (p[0]-planePoint[0])*normal[0] + (p[1]-planePoint[1])*normal[1] + (p[2]-planePoint[2])*normal[2];
    //     return distance;
    //   }
      
    //   Angle(norm1, norm2) {
    //     let dotProduct = norm1[0]*norm2[0] + norm1[1]*norm2[1] + norm1[2]*norm2[2];
    //     let norm1Magnitude = math.sqrt(norm1[0]*norm1[0] + norm1[1]*norm1[1] + norm1[2]*norm1[2]);
    //     let norm2Magnitude = math.sqrt(norm2[0]*norm2[0] + norm2[1]*norm2[1] + norm2[2]*norm2[2]);
    //     let cosine = dotProduct / (norm1Magnitude * norm2Magnitude);
    //     let angleInRadians = math.acos(cosine);
    //     let angleInDegrees = angleInRadians * 180 / math.PI;
    //     return angleInDegrees;
    //   }



    //   sub(listA,listB){
    //     return [listA[0]-listB[0],listA[1]-listB[1],listA[2]-listB[2]];
    //   }

    //   add(listA,listB){
    //     return [listA[0]+listB[0],listA[1]+listB[1],listA[2]+listB[2]];
    //   }

    //   dot(listA,listB){
    //     return listA[0]*listB[0]+listA[1]*listB[1]+listA[2]*listB[2];
    //   }

    //   define_area(points) {
    //     let vector1 = [points[1][0] - points[0][0], points[1][1] - points[0][1], points[1][2] - points[0][2]];
    //     let vector2 = [points[2][0] - points[0][0], points[2][1] - points[0][1], points[2][2] - points[0][2]];

    //     let normalVector = math.cross(vector1, vector2);
    //     let A = normalVector[0];
    //     let B = normalVector[1];
    //     let C = normalVector[2];
    //     let D = -1 * (A * points[0][0] + B * points[0][1] + C * points[0][2]);

    //     return [A, B, C, D];
    //   }
    //   GetNorlm(NodeName){
    //     let ras1=this.MyScene.getMarkupsByName(NodeName).getPointsWorld()[0];
    //     let ras2=this.MyScene.getMarkupsByName(NodeName).getPointsWorld()[1];
    //     return this.sub(ras2,ras1);
    //   }

    //   caculateTouYingNorml(NName, PlaneName){
    //     let PlaneNode=this.MyScene.getMarkupsByName(PlaneName).getPointsWorld();
    //     let ras1=this.MyScene.getMarkupsByName(NName).getPointsWorld()[0];
    //     let ras2=this.MyScene.getMarkupsByName(NName).getPointsWorld()[1];
    //     return this.sub(this.TouYing(PlaneNode,ras2),this.TouYing(PlaneNode,ras1));
    //   }



    //   caculateInformation() {

    //   var ras1=this.MyScene.getMarkupsByName('内侧高点1').getPointsWorld()[0];
    //   var ras2=this.MyScene.getMarkupsByName('外侧高点1').getPointsWorld()[0];
    //   var ras3=this.MyScene.getMarkupsByName('内侧远端1').getPointsWorld()[0];
    //   var ras4=this.MyScene.getMarkupsByName('外侧远端1').getPointsWorld()[0];
    //   var ras5=this.MyScene.getMarkupsByName('内侧后髁1').getPointsWorld()[0];
    //   var ras6=this.MyScene.getMarkupsByName('外侧后髁1').getPointsWorld()[0];
    //   var ras9=this.MyScene.getMarkupsByName('股骨头球心1').getPointsWorld()[0];
    //   var ras10=this.MyScene.getMarkupsByName('开髓点1').getPointsWorld()[0];
    //   var Femur_ZAxis_Z = this.caculateTouYingNorml('Femur_ZAxis1', 'Tibia_YZPlane1');
    //   var Tibia_ZAxis = this.GetNorlm('Tibia_ZAxis1');
    //   var quxiAngle = this.Angle(Femur_ZAxis_Z, Tibia_ZAxis);
    //   var FemurJGM =this.myclip_femur.getClipPlansView()[0,1,2];
    //   var Femur3JGM=this.myclip_femur.getClipPlansView()[6,7,8];
    //   var TibiaJGM =this.myclip_femur.getClipPlansView()[0,1,2];

    //   // B2:伸直时股骨内侧远端截骨距离
    //   let B2 = this.point2area_distance(FemurJGM, ras3);
    //   // A2:伸直时股骨外侧远端截骨距离
    //   let A2 = this.point2area_distance(FemurJGM, ras4);
    //   //判断截骨正负，正数为假体初始化与对应点的距离-未截骨，负为截骨量
    //   var a = [ras3[0],ras3[1],ras3[2]];
    //   var c = [ras4[0],ras4[1],ras4[2]];
    //   //得到世界坐标系下股骨截骨面上的点
    //   let b = FemurJGM;
      
    //   //判断点与面上的点的z坐标的大小
    //   if (a[2] < b[2]) {
    //     this.B2 = B2;
    //   } else {
    //     this.B2 = -B2;
    //   }

    //   if (c[2] < b[2]) {
    //     this.A2 = A2;
    //   } else {
    //     this.A2 = -A2;
    //   }

    //   // D1:屈膝时股骨内侧后踝截骨距离
    //   let C3 = this.point2area_distance(Femur3JGM, ras3);
    //   // C2:屈膝时股骨外侧后截骨距离
    //   let C2 = this.point2area_distance(Femur3JGM, ras4);
    //   //判断截骨正负，正数为假体初始化与对应点的距离-未截骨，负为截骨量
    //   a = [ras3[0],ras3[1],ras3[2]];
    //   c = [ras4[0],ras4[1],ras4[2]];
    //   //得到世界坐标系下股骨截骨面上的点
    //   b = Femur3JGM;
      
    //   //判断点与面上的点的z坐标的大小
    //   if (a[2] < b[2]) {
    //     this.C3 = C3;
    //   } else {
    //     this.C3 = -C3;
    //   }

    //   if (c[2] < b[2]) {
    //     this.C2 = C2;
    //   } else {
    //     this.C2 = -C2;
    //   }

    //   //股骨内旋
    //   var Femur_XAxis = this.GetNorlm('Femur_XAxis1');
    //   let xl1 = [ras1[0] - ras2[0], ras1[1] - ras2[1], ras1[2] - ras2[2]];

    //   let angle_neixuan = this.Angle(Femur_XAxis, xl1);
    //   if (angle_neixuan > 90) {
    //     angle_neixuan = 180 - angle_neixuan;
    //   }

    //   // 屈曲角   前倾/后倾角

    //   xl1 = [ras9[0] - ras10[0], ras9[1] - ras10[1], ras9[2] - ras10[2]];
    //   let [Ax, By, Cz, D] = this.define_area(FemurJGM);
    //   let xl2 = [Ax, By, Cz];
    //   let angle1 = this.Angle(xl1, xl2);
    //   //计算角度正负
    //   let d = [xl1[0] - xl2[0], xl1[1] - xl2[1], xl1[2] - xl2[2]];
    //   c = math.dot(d, b);
    //   if (c >= 0) {
    //     this.QuQuJiao_gugu = angle1 - 180;
    //   } else {
    //     this.QuQuJiao_gugu = -(angle1 - 180);
    //   }
    //   //
      
    //   var ras1=this.MyScene.getMarkupsByName('胫骨隆凸1').getPointsWorld()[0];
    //   var ras2=this.MyScene.getMarkupsByName('内侧高点1').getPointsWorld()[0];
    //   var ras3=this.MyScene.getMarkupsByName('外侧高点1').getPointsWorld()[0];
    //   var ras4=this.MyScene.getMarkupsByName('踝穴中心1').getPointsWorld()[0];


    //   // B3:伸直时胫骨内侧截骨距离
    //   let B3 = this.point2area_distance(TibiaJGM, ras2);
    //   // A3:伸直时胫骨外侧截骨距离
    //   let A3 = this.point2area_distance(TibiaJGM, ras3);
    //   // 判断截骨正负，正数为假体初始化与对应点的距离-未截骨，负为截骨量

    //   a = [ras3[0],ras3[1],ras3[2]];
    //   c = [ras2[0],ras2[1],ras2[2]];

    //   b = TibiaJGM[0];
    //   if (a[2] < b[2]) {
    //     this.A3 = -A3;
    //   } else {
    //     this.A3 = A3;
    //   }

    //   if (c[2] < b[2]) {
    //     this.B3 = -B3;
    //   } else {
    //     this.B3 = B3;
    //   }

    //   //胫骨内旋
    //   let Tibia_XAxis1 = this.GetNorlm('Tibia_XAxis1');
    //   xl1 = [ras2[0] - ras3[0], ras2[1] - ras3[1], ras2[2] - ras3[2]];

    //   let tibia_neixuan = this.Angle(Tibia_XAxis1, xl1);
    //   if (tibia_neixuan > 90) {
    //     tibia_neixuan = 180 - tibia_neixuan;
    //   }

    //   // 胫骨后倾角
    //   let NGTY = this.TouYing(TibiaJGM, ras2);
    //   let WGTY = this.TouYing(TibiaJGM, ras3);
    //   xl1 = [NGTY[0] - WGTY[0], NGTY[1] - WGTY[1], NGTY[2] - WGTY[2]];
    //   xl2 = [ras4[0] - ras1[0], ras4[1] - ras1[1], ras4[2] - ras1[2]];
    //   let houqingjiao = this.Angle(xl1, xl2);
    //   if (houqingjiao > 90) {
    //     houqingjiao = houqingjiao - 90;
    //   } else {
    //     houqingjiao = 90 - houqingjiao;
    //   }
    //   //计算角度正负
    //   a = [xl1[0] - xl2[0], xl1[1] - xl2[1], xl1[2] - xl2[2]];
    //   b = [TibiaJGM[1][0] - TibiaJGM[2][0], TibiaJGM[1][1] - TibiaJGM[2][1], TibiaJGM[1][2] - TibiaJGM[2][2]];
    //   c = math.dot(a, b);
    //   if (c > 0) {
    //     this.TibiaHouQingJiao = houqingjiao;
    //   } else {
    //     this.TibiaHouQingJiao = -houqingjiao;
    //   }

    //   //内外翻角


    //   var Femur_ZAxis_Z = this.caculateTouYingNorml('Femur_ZAxis1', 'Tibia_YZPlane1');
    //   var Tibia_ZAxis = this.GetNorlm('Tibia_ZAxis1');
    //   var quxiAngle=this.Angle(Femur_ZAxis_Z, Tibia_ZAxis);



    //   var Tibia_XAxis = this.GetNorlm('Tibia_XAxis1');
    //   var Tibia_YAxis = this.GetNorlm('Tibia_YAxis1');
    //   var Femur_XAxis = this.GetNorlm('Femur_XAxis1');
    //   var Femur_ZAxis = this.GetNorlm('Femur_ZAxis1');
    //   var ifzf1 = this.dot(Tibia_YAxis, Femur_ZAxis);
    //   console.log("ifzf1", ifzf1);

    //   if (ifzf1 < 0) {
    //     quxiAngle = -quxiAngle;
    //   }

    //   let Femur_XAxis_Z = this.caculateTouYingNorml('Femur_XAxis1', 'Tibia_XYPlane1');
    //   let waifanAngle = this.Angle(Femur_XAxis_Z, Femur_XAxis);

    //   if (this.dot(Tibia_ZAxis, Femur_XAxis) > 0) {
    //     waifanAngle = -waifanAngle;
    //   }

    //   if (waifanAngle < -14) {
    //     waifanAngle = -14;
    //   }

    //   if (waifanAngle > 14) {
    //     waifanAngle = 14;
    //   }

    //   if (quxiAngle < -14) {
    //     quxiAngle = -14;
    //   }

    //   if (quxiAngle > 130) {
    //     quxiAngle = 130;
    //   }

    //   this.currentY = parseFloat(waifanAngle).toFixed(1);
    //   this.currentX = parseFloat(quxiAngle).toFixed(1);
    //   console.log("quxiAngle", quxiAngle);
    //   console.log("waifanAngle", waifanAngle);



    //   if(-1 < this.currentX && this.currentX < 1) { //伸直时计算伸直间隙
    //     var shenzhi_neicejianxi = math.norm(this.sub(ras1 , ras3));
    //     var shenzhi_waicejianxi = math.norm(this.sub(ras2 , ras4));
    //     var shenzhi_neicejianxi = math.round(shenzhi_neicejianxi * 10) / 10;
    //     var shenzhi_waicejianxi = math.round(shenzhi_waicejianxi * 10) / 10;
    //     //膝关节评估0°内外翻距离UI
    //     //伸直内侧
    //     this.B1 = shenzhi_neicejianxi;
    //     this.A1 = shenzhi_waicejianxi;
    //   }


    //   if(89 < this.currentX && this.currentX < 91) { //#屈膝时计算屈膝间隙
    //     var quxi_neicejianxi = math.norm(this.sub(ras1 , ras5));
    //     var quxi_waicejianxi = math.norm(this.sub(ras2 , ras6));
    //     var quxi_neicejianxi = math.round(quxi_neicejianxi * 10) / 10;
    //     var quxi_waicejianxi = math.round(quxi_waicejianxi * 10) / 10;
    //     //膝关节评估0°内外翻距离UI
    //     //伸直内侧
    //     this.D1 = quxi_neicejianxi;
    //     this.C1 = quxi_waicejianxi;
    //   }
      
    //   //更新UI
    //   document.getElementById("gugu_neiwaifan").innerText = waifanAngle + '°';
    //   // document.getElementById("jinggu_neiwaifan").innerText = waifanAngle + '°';
    //   document.getElementById("gugu_waice_yuanduan").innerText = this.A2 + 'mm';
    //   document.getElementById("gugu_neice_yuanduan").innerText = this.B2 + 'mm';
    //   document.getElementById("waice_houke").innerText = this.C2 + 'mm';
    //   document.getElementById("neice_houke").innerText = this.C3 + 'mm';
    //   document.getElementById("jinggu_waice_yuanduan").innerText = this.A3 + 'mm';
    //   document.getElementById("jinggu_neice_yuanduan").innerText = this.B3 + 'mm';

    //   document.getElementById("gugu_qingjiao").innerText = this.QuQuJiao_gugu + '°';
    //   document.getElementById("jinggu_houqingjiao").innerText = this.TibiaHouQingJiao + '°';







    // }

    //   YueShu() {



    //     let ras=this.MyScene.getMarkupsByName('内侧远端1').getPointsWorld()[0];
    //     const Femur1JGM = this.myclip_femur.getClipPlansView()[0,1,2];
    //     const position = this.point2area_distance(Femur1JGM, ras);
    //     const distance = position - 8;
    //     const transformR = this.MyScene.getTransformByName('变换_股骨约束');
    //     const a =transformR.matrix;
    //     const FtransTmp = math.matrix([[1, 0, 0, 0],
    //                         [0, 1, 0, 0],
    //                         [0, 0, 1, distance],
    //                         [0, 0, 0, 1]]);
    //     const trans = math.multiply(a, FtransTmp);
    //     transformR.matrix=trans;
    //     console.log('distance 赋值完成');
    //     const Femur2JGM = this.myclip_femur.getClipPlansView()[3,4,5];
    //     let ras1=this.MyScene.getMarkupsByName('外侧皮质高点1').getPointsWorld()[0];
    //     ras=this.MyScene.getMarkupsByName('内侧远端1').getPointsWorld()[0];

    //     //根据外侧皮质高点在第二刀切面的位置来判断调整正负
    //     const n1 = [0, 1, 0];
    //     const n2 = this.sub(ras1, this.TouYing(Femur2JGM, ras1));
    //     let direction;
    //     if (math.dot(n1, n2) < 0) {
    //         direction = 1;
    //     } else {
    //         direction = -1;
    //     }
    //     const d = this.point2area_distance(Femur2JGM, ras1);
    //     let x = d/math.cos(math.radians(6));
    //     //direction = slicer.modules.PopupWidget.direction;
    //     x = direction * x;
    //     const FtransTmp2 = math.matrix([[1, 0, 0, 0],
    //                         [0, 1, 0, -x],
    //                         [0, 0, 1, 0],
    //                         [0, 0, 0, 1]]);
    //     var trans2 = math.multiply(a, FtransTmp2);
    //     transformR.matrix=trans2;
    //     console.log('所有矩阵赋值完成');
    //     //this.loaddisan();
    //   }


    //   ChangeJtStatueToQuxi(ifQuxi){
    //       var femur=this.MyScene.getModelByName("FemurCut")
    //       var trans_femur=this.MyScene.getTransformByName("变换_股骨假体调整");
    //       var jt_femur=this.MyScene.getModelByName(this.MyScene.clips[0].JTName);
    //       if(ifQuxi===1){
    //         var jtTo0 = this.MyScene.getTransformByName("jtTo0");
    //         trans_femur.parent=jtTo0;
    //         jt_femur.parent=jtTo0;
    //       }
    //       else{
    //         trans_femur.parent=null;
    //         jt_femur.parent=null;
    //       }
    //       jt_femur.UpdatePosition();
    //       femur.UpdatePosition();

    //     }

    //   SetPointVisible(){
    //       var FemurPoints1 = ['开髓点1', '内侧凹点1', '外侧凸点1', '内侧远端1', '外侧远端1', '内侧后髁1', '外侧后髁1', '外侧皮质高点1', 'A点1', "股骨头球心1",'H点1','胫骨隆凸1', '胫骨结节1', '外侧高点1', '内侧高点1','踝穴中心1'];
    //       for(var i=0;i<FemurPoints1.length;i++){
    //         this.MyScene.getMarkupsByName(FemurPoints1[i]).setVisibility(!this.MyScene.getMarkupsByName(FemurPoints1[i]).visibility);
    //       }
    //     }

    //   SetJTVisible(){
    //       var jt_femur=this.MyScene.getModelByName(this.MyScene.clips[0].JTName);
    //       var jt_tibia=this.MyScene.getModelByName(this.MyScene.clips[1].JTName);
    //       var jt_insert=this.MyScene.getModelByName(this.MyScene.clips[1].JTName.replace("Tibia","Insert"))
    //       jt_femur.setVisibility(!jt_femur.visibility);
    //       jt_tibia.setVisibility(!jt_tibia.visibility);
    //       jt_insert.setVisibility(!jt_insert.visibility);
      
    //     }

    //   SetCutVisible(){
    //       var femur=this.MyScene.getModelByName("Femurasd");
    //       var tibia=this.MyScene.getModelByName("Tibiaasd");
    //       femur.setVisibility(!femur.visibility);
    //       tibia.setVisibility(!tibia.visibility);
    //     }

    // }
    class OperationPlane {
        constructor(name,scene,myclip_femur,myclip_tibia) {
          this.name = name;
          this.MyScene = scene;
          this.myclip_femur=myclip_femur;
          this.myclip_tibia=myclip_tibia;
          this.quxiStatue=0;
          this.onInit();
        }

        onInit(){
          var trans_1=this.MyScene.getTransformByName("变换_股骨调整");
    
          var trans_4=this.MyScene.getTransformByName("变换_胫骨调整");
      
          var o = [0, 0, 0];
          var z = [0, 0, 1];
          var y = [0, 1, 0];
          var x = [1, 0, 0];

          var point = this.MyScene.AddMarkups('Femur_ZAxis1');
          point.AddPoints(o);
          point.AddPoints(z);
          point.parent=trans_1;
          point.setVisibility(0);

          var point = this.MyScene.AddMarkups('Femur_XAxis1');
          point.AddPoints(o);
          point.AddPoints(x);
          point.parent=trans_1;
          point.setVisibility(0);

          var point = this.MyScene.AddMarkups('Tibia_ZAxis1');
          point.AddPoints(o);
          point.AddPoints(z);
          point.parent=trans_4;
          point.setVisibility(0);

          var point = this.MyScene.AddMarkups('Tibia_XAxis1');
          point.AddPoints(o);
          point.AddPoints(x);
          point.parent=trans_4;
          point.setVisibility(0);

          var point = this.MyScene.AddMarkups('Tibia_YAxis1');
          point.AddPoints(o);
          point.AddPoints(y);
          point.parent=trans_4;
          point.setVisibility(0);

          var point = this.MyScene.AddMarkups('Tibia_XYPlane1');
          point.AddPoints(o);
          point.AddPoints(x);
          point.AddPoints(y);
          point.parent=trans_4;
          point.setVisibility(0);

          var point = this.MyScene.AddMarkups('Tibia_YZPlane1');
          point.AddPoints(o);
          point.AddPoints(y);
          point.AddPoints(z);
          point.parent=trans_4;
          point.setVisibility(0);

        }

        TouYing(planePoints,p) {
          // 计算平面法向量
          let v1 = [planePoints[1][0]-planePoints[0][0], planePoints[1][1]-planePoints[0][1], planePoints[1][2]-planePoints[0][2]];
          let v2 = [planePoints[2][0]-planePoints[0][0], planePoints[2][1]-planePoints[0][1], planePoints[2][2]-planePoints[0][2]];
          let normal = [v1[1]*v2[2]-v1[2]*v2[1], v1[2]*v2[0]-v1[0]*v2[2], v1[0]*v2[1]-v1[1]*v2[0]];
          
          // 计算平面上一点
          let planePoint = planePoints[0];
          
          // 计算点到平面的距离
          let distance = (p[0]-planePoint[0])*normal[0] + (p[1]-planePoint[1])*normal[1] + (p[2]-planePoint[2])*normal[2];
          
          // 计算点在平面上的投影点
          let projection = [p[0]-normal[0]*distance, p[1]-normal[1]*distance, p[2]-normal[2]*distance];
          
          return projection;
        }
     
        
        point2area_distance(planePoints,ras) {
          // 计算平面法向量
          var plane=this.define_area(planePoints);
          var distance=math.abs(plane[0] * ras[0] + plane[1] * ras[1] + plane[2] * ras[2] + plane[3]) / math.sqrt(plane[0] * plane[0] + plane[1] * plane[1] + plane[2] * plane[2]);
          return distance;
        }
        
        Angle(norm1, norm2) {
          let dotProduct = norm1[0]*norm2[0] + norm1[1]*norm2[1] + norm1[2]*norm2[2];
          let norm1Magnitude = math.sqrt(norm1[0]*norm1[0] + norm1[1]*norm1[1] + norm1[2]*norm1[2]);
          let norm2Magnitude = math.sqrt(norm2[0]*norm2[0] + norm2[1]*norm2[1] + norm2[2]*norm2[2]);
          let cosine = dotProduct / (norm1Magnitude * norm2Magnitude);
          let angleInRadians = math.acos(cosine);
          let angleInDegrees = angleInRadians * 180 / math.PI;
          return angleInDegrees;
        }



        sub(listA,listB){
          return [listA[0]-listB[0],listA[1]-listB[1],listA[2]-listB[2]];
        }

        add(listA,listB){
          return [listA[0]+listB[0],listA[1]+listB[1],listA[2]+listB[2]];
        }

        dot(listA,listB){
          return listA[0]*listB[0]+listA[1]*listB[1]+listA[2]*listB[2];
        }

        define_area(points) {
          let vector1 = [points[1][0] - points[0][0], points[1][1] - points[0][1], points[1][2] - points[0][2]];
          let vector2 = [points[2][0] - points[0][0], points[2][1] - points[0][1], points[2][2] - points[0][2]];

          let normalVector = math.cross(vector1, vector2);
          let A = normalVector[0];
          let B = normalVector[1];
          let C = normalVector[2];
          let D = -1 * (A * points[0][0] + B * points[0][1] + C * points[0][2]);

          return [A, B, C, D];
        }
        GetNorlm(NodeName){
          let ras1=this.MyScene.getMarkupsByName(NodeName).getPointsWorld()[0];
          let ras2=this.MyScene.getMarkupsByName(NodeName).getPointsWorld()[1];
          return this.sub(ras2,ras1);
        }

        caculateTouYingNorml(NName, PlaneName){
          let PlaneNode=this.MyScene.getMarkupsByName(PlaneName).getPointsWorld();
          let ras1=this.MyScene.getMarkupsByName(NName).getPointsWorld()[0];
          let ras2=this.MyScene.getMarkupsByName(NName).getPointsWorld()[1];
          return this.sub(this.TouYing(PlaneNode,ras2),this.TouYing(PlaneNode,ras1));
        }



        caculateInformation() {
        var ras1=this.MyScene.getMarkupsByName('内侧高点1').getPointsWorld()[0];
        var ras2=this.MyScene.getMarkupsByName('外侧高点1').getPointsWorld()[0];
        var ras3=this.MyScene.getMarkupsByName('内侧远端1').getPointsWorld()[0];
        var ras4=this.MyScene.getMarkupsByName('外侧远端1').getPointsWorld()[0];
        var ras5=this.MyScene.getMarkupsByName('内侧后髁1').getPointsWorld()[0];
        var ras6=this.MyScene.getMarkupsByName('外侧后髁1').getPointsWorld()[0];
        var ras9=this.MyScene.getMarkupsByName('股骨头球心1').getPointsWorld()[0];
        var ras10=this.MyScene.getMarkupsByName('开髓点1').getPointsWorld()[0];
        var Femur_ZAxis_Z = this.caculateTouYingNorml('Femur_ZAxis1', 'Tibia_YZPlane1');
        var Tibia_ZAxis = this.GetNorlm('Tibia_ZAxis1');
        var quxiAngle = this.Angle(Femur_ZAxis_Z, Tibia_ZAxis);
        var FemurJGM =this.myclip_femur.getClipPlansView().slice(0,3);
        var Femur3JGM=this.myclip_femur.getClipPlansView().slice(6,9);
        var TibiaJGM =this.myclip_tibia.getClipPlansView().slice(0,3);

        // B2:伸直时股骨内侧远端截骨距离
        let B2 = this.point2area_distance(FemurJGM, ras3);
        // A2:伸直时股骨外侧远端截骨距离
        let A2 = this.point2area_distance(FemurJGM, ras4);
        //判断截骨正负，正数为假体初始化与对应点的距离-未截骨，负为截骨量
        var a = [ras3[0],ras3[1],ras3[2]];
        var c = [ras4[0],ras4[1],ras4[2]];
        //得到世界坐标系下股骨截骨面上的点
        let b = FemurJGM;
        
        //判断点与面上的点的z坐标的大小
        if (a[2] < b[2]) {
          this.B2 = B2;
        } else {
          this.B2 = -B2;
        }

        if (c[2] < b[2]) {
          this.A2 = A2;
        } else {
          this.A2 = -A2;
        }

        // D1:屈膝时股骨内侧后踝截骨距离
        let C3 = this.point2area_distance(Femur3JGM, ras3);
        // C2:屈膝时股骨外侧后截骨距离
        let C2 = this.point2area_distance(Femur3JGM, ras4);
        //判断截骨正负，正数为假体初始化与对应点的距离-未截骨，负为截骨量
        a = [ras3[0],ras3[1],ras3[2]];
        c = [ras4[0],ras4[1],ras4[2]];
        //得到世界坐标系下股骨截骨面上的点
        b = Femur3JGM[0];
        
        //判断点与面上的点的z坐标的大小
        if (a[2] < b[2]) {
          this.C3 = C3;
        } else {
          this.C3 = -C3;
        }

        if (c[2] < b[2]) {
          this.C2 = C2;
        } else {
          this.C2 = -C2;
        }

        //股骨内旋
        var Femur_XAxis = this.GetNorlm('Femur_XAxis1');
        let xl1 = [ras1[0] - ras2[0], ras1[1] - ras2[1], ras1[2] - ras2[2]];

        let angle_neixuan = this.Angle(Femur_XAxis, xl1);
        if (angle_neixuan > 90) {
          angle_neixuan = 180 - angle_neixuan;
        }

        // 屈曲角   前倾/后倾角

        xl1 = [ras9[0] - ras10[0], ras9[1] - ras10[1], ras9[2] - ras10[2]];
        let [Ax, By, Cz, D] = this.define_area(FemurJGM);
        let xl2 = [Ax, By, Cz];
        let angle1 = this.Angle(xl1, xl2);
        //计算角度正负
        let d = [xl1[0] - xl2[0], xl1[1] - xl2[1], xl1[2] - xl2[2]];
        c = math.dot(d, b);
        if (c >= 0) {
          this.QuQuJiao_gugu = angle1 - 180;
        } else {
          this.QuQuJiao_gugu = -(angle1 - 180);
        }
        //
        
        var ras1=this.MyScene.getMarkupsByName('胫骨隆凸1').getPointsWorld()[0];
        var ras2=this.MyScene.getMarkupsByName('内侧高点1').getPointsWorld()[0];
        var ras3=this.MyScene.getMarkupsByName('外侧高点1').getPointsWorld()[0];
        var ras4=this.MyScene.getMarkupsByName('踝穴中心1').getPointsWorld()[0];

  
        // B3:伸直时胫骨内侧截骨距离
        let B3 = this.point2area_distance(TibiaJGM, ras2);
        // A3:伸直时胫骨外侧截骨距离
        let A3 = this.point2area_distance(TibiaJGM, ras3);
        // 判断截骨正负，正数为假体初始化与对应点的距离-未截骨，负为截骨量

        a = [ras3[0],ras3[1],ras3[2]];
        c = [ras2[0],ras2[1],ras2[2]];

        b = TibiaJGM[0];
        if (a[2] < b[2]) {
          this.A3 = -A3;
        } else {
          this.A3 = A3;
        }

        if (c[2] < b[2]) {
          this.B3 = -B3;
        } else {
          this.B3 = B3;
        }

        //胫骨内旋
        let Tibia_XAxis1 = this.GetNorlm('Tibia_XAxis1');
        xl1 = [ras2[0] - ras3[0], ras2[1] - ras3[1], ras2[2] - ras3[2]];

        let tibia_neixuan = this.Angle(Tibia_XAxis1, xl1);
        if (tibia_neixuan > 90) {
          tibia_neixuan = 180 - tibia_neixuan;
        }

        // 胫骨后倾角
        let NGTY = this.TouYing(TibiaJGM, ras2);
        let WGTY = this.TouYing(TibiaJGM, ras3);
        xl1 = [NGTY[0] - WGTY[0], NGTY[1] - WGTY[1], NGTY[2] - WGTY[2]];
        xl2 = [ras4[0] - ras1[0], ras4[1] - ras1[1], ras4[2] - ras1[2]];
        let houqingjiao = this.Angle(xl1, xl2);
        if (houqingjiao > 90) {
          houqingjiao = houqingjiao - 90;
        } else {
          houqingjiao = 90 - houqingjiao;
        }
        //计算角度正负
        a = [xl1[0] - xl2[0], xl1[1] - xl2[1], xl1[2] - xl2[2]];
        b = [TibiaJGM[1][0] - TibiaJGM[2][0], TibiaJGM[1][1] - TibiaJGM[2][1], TibiaJGM[1][2] - TibiaJGM[2][2]];
        c = math.dot(a, b);
        if (c > 0) {
          this.TibiaHouQingJiao = houqingjiao;
        } else {
          this.TibiaHouQingJiao = -houqingjiao;
        }

        //内外翻角


        var Femur_ZAxis_Z = this.caculateTouYingNorml('Femur_ZAxis1', 'Tibia_YZPlane1');
        var Tibia_ZAxis = this.GetNorlm('Tibia_ZAxis1');
        var quxiAngle=this.Angle(Femur_ZAxis_Z, Tibia_ZAxis);



        var Tibia_XAxis = this.GetNorlm('Tibia_XAxis1');
        var Tibia_YAxis = this.GetNorlm('Tibia_YAxis1');
        var Femur_XAxis = this.GetNorlm('Femur_XAxis1');
        var Femur_ZAxis = this.GetNorlm('Femur_ZAxis1');
        var ifzf1 = this.dot(Tibia_YAxis, Femur_ZAxis);
        console.log("ifzf1", ifzf1);

        if (ifzf1 < 0) {
          quxiAngle = -quxiAngle;
        }

        let Femur_XAxis_Z = this.caculateTouYingNorml('Femur_XAxis1', 'Tibia_XYPlane1');
        let waifanAngle = this.Angle(Femur_XAxis_Z, Femur_XAxis);

        if (this.dot(Tibia_ZAxis, Femur_XAxis) > 0) {
          waifanAngle = -waifanAngle;
        }

        if (waifanAngle < -14) {
          waifanAngle = -14;
        }

        if (waifanAngle > 14) {
          waifanAngle = 14;
        }

        if (quxiAngle < -14) {
          quxiAngle = -14;
        }

        if (quxiAngle > 130) {
          quxiAngle = 130;
        }

        this.currentY = parseFloat(waifanAngle).toFixed(1);
        this.currentX = parseFloat(quxiAngle).toFixed(1);
        console.log("quxiAngle", quxiAngle);
        console.log("waifanAngle", waifanAngle);



        if(-1 < this.currentX && this.currentX < 1) { //伸直时计算伸直间隙
          var shenzhi_neicejianxi = math.norm(this.sub(ras1 , ras3));
          var shenzhi_waicejianxi = math.norm(this.sub(ras2 , ras4));
          var shenzhi_neicejianxi = math.round(shenzhi_neicejianxi * 10) / 10;
          var shenzhi_waicejianxi = math.round(shenzhi_waicejianxi * 10) / 10;
          //膝关节评估0°内外翻距离UI
          //伸直内侧
          this.B1 = shenzhi_neicejianxi;
          this.A1 = shenzhi_waicejianxi;

          document.getElementById('pinggu_ui_shenzhi_quxi').innerText = '伸直';
          document.getElementById('pinggu_ui_shenzhi_quxi_angle').innerText = '0°';
          document.getElementById('pinggu_ui_waice_jianxi').innerText =  round(this.A1,1) + 'mm';
          document.getElementById('pinggu_ui_neice_jianxi').innerText =  round(this.B1,1) + 'mm';
          document.getElementById('pinggu_ui_waice_jiegu').innerText =  round(this.A2+this.A3,1) + 'mm';
          document.getElementById('pinggu_ui_neice_jiegu').innerText =  round(this.B2+this.B3,1) + 'mm';
          document.getElementById('pinggu_ui_waice_jiegu_lilun').innerText =  round(this.A1+this.A2+this.A3,1) + 'mm';
          document.getElementById('pinggu_ui_neice_jiegu_lilun').innerText =  round(this.B1+this.B2+this.B3,1) + 'mm';

        }


        if(89 < this.currentX && this.currentX < 91) { //#屈膝时计算屈膝间隙
          var quxi_neicejianxi = math.norm(this.sub(ras1 , ras5));
          var quxi_waicejianxi = math.norm(this.sub(ras2 , ras6));
          var quxi_neicejianxi = math.round(quxi_neicejianxi * 10) / 10;
          var quxi_waicejianxi = math.round(quxi_waicejianxi * 10) / 10;
          //膝关节评估0°内外翻距离UI
          //伸直内侧
          this.D1 = quxi_neicejianxi;
          this.C1 = quxi_waicejianxi;
          document.getElementById('pinggu_ui_shenzhi_quxi').innerText = '屈膝';
          document.getElementById('pinggu_ui_shenzhi_quxi_angle').innerText = '90°';
          document.getElementById('pinggu_ui_waice_jianxi').innerText =  round(this.C1,1) + 'mm';
          document.getElementById('pinggu_ui_neice_jianxi').innerText =  round(this.D1,1) + 'mm';
          document.getElementById('pinggu_ui_waice_jiegu').innerText =  round(this.A2+this.A3,1) + 'mm';
          document.getElementById('pinggu_ui_neice_jiegu').innerText =  round(this.B2+this.B3,1) + 'mm';
          document.getElementById('pinggu_ui_waice_jiegu_lilun').innerText =  round(this.C1+this.A2+this.A3,1) + 'mm';
          document.getElementById('pinggu_ui_neice_jiegu_lilun').innerText =  round(this.D1+this.B2+this.B3,1) + 'mm';

        }
        

        document.getElementById('gugu_neiwaifan').innerText = round(waifanAngle,1) + '°';
        document.getElementById('gugu_waice_yuanduan').innerText = round(this.A2,1) + 'mm';
        document.getElementById('gugu_neice_yuanduan').innerText = round(this.B2,1) + 'mm';
        document.getElementById('neice_houke').innerText = round(this.C3,1) + 'mm';
        document.getElementById('waice_houke').innerText = round(this.C2,1) + 'mm';
        // document.getElementById('jinggu_neiwaifan').innerText = Tibia_ZAxis + '°';
        document.getElementById('jinggu_neice_yuanduan').innerText = round(this.B3,1) + 'mm';
        document.getElementById('jinggu_waice_yuanduan').innerText = round(this.A3,1) + 'mm';

        document.getElementById('gugu_qingjiao').innerText = round(this.QuQuJiao_gugu,1) + '°';
        document.getElementById('jinggu_houqingjiao').innerText = round(this.TibiaHouQingJiao,1) + '°';
      }

      YueShu_Tibia(){
        let point = this.MyScene.getMarkupsByName('内侧高点1').getPointsWorld()[0];
        let TibiaJGM =this.myclip_tibia.getClipPlansView().slice(0,3);
        let pointTouYing = this.TouYing(TibiaJGM, point);

        let xiangliang = this.sub(point,pointTouYing);
        let z = [0,0,1];
        let x = math.dot(xiangliang, z);

        console.log('x', x);
        let d = this.point2area_distance(TibiaJGM, point);
        console.log('d:', d);
        if (x > 0) {
            d = -d;
        }
        let distance = 6 + d;
        let TransformTmp = this.MyScene.getTransformByName('变换_胫骨约束');
        let TtransTmp = math.matrix([[1, 0, 0, 0],
                            [0, 1, 0, 0],
                            [0, 0, 1, distance],
                            [0, 0, 0, 1]]);

        let trans = math.multiply(TransformTmp.matrix, TtransTmp);
        TransformTmp.matrix = trans;
      }


        YueShu() {


          let ras=this.MyScene.getMarkupsByName('内侧远端1').getPointsWorld()[0];
          const Femur1JGM = this.myclip_femur.getClipPlansView().slice(0,3);
          const position = this.point2area_distance(Femur1JGM, ras);
          const distance = position - 8;
          const transformR = this.MyScene.getTransformByName('变换_股骨约束');
          const a =transformR.matrix;
          const FtransTmp = math.matrix([[1, 0, 0, 0],
                              [0, 1, 0, 0],
                              [0, 0, 1, distance],
                              [0, 0, 0, 1]]);
          const trans = math.multiply(a, FtransTmp);
          transformR.matrix=trans;
          console.log('distance 赋值完成');
          const Femur2JGM = this.myclip_femur.getClipPlansView().slice(3,6);
          let ras1=this.MyScene.getMarkupsByName('外侧皮质高点1').getPointsWorld()[0];
          ras=this.MyScene.getMarkupsByName('内侧远端1').getPointsWorld()[0];

          //根据外侧皮质高点在第二刀切面的位置来判断调整正负
          const n1 = [0, 1, 0];
          const n2 = this.sub(ras1, this.TouYing(Femur2JGM, ras1));
          let direction;
          if (math.dot(n1, n2) < 0) {
              direction = 1;
          } else {
              direction = -1;
          }
          const d = this.point2area_distance(Femur2JGM, ras1);
          let x = d/math.cos(0.104719755119659);
          //direction = slicer.modules.PopupWidget.direction;
          x = direction * x;
          const FtransTmp2 = math.matrix([[1, 0, 0, 0],
                              [0, 1, 0, x],
                              [0, 0, 1, 0],
                              [0, 0, 0, 1]]);
          var trans2 = math.multiply(trans, FtransTmp2);
          transformR.matrix=trans2;
          console.log('所有矩阵赋值完成');
          //this.loaddisan();
        }


        ChangeJtStatueToQuxi(ifQuxi){
          this.quxiStatue=ifQuxi;
          this.myclip_femur.quxiStatue=ifQuxi;
          var femur=this.MyScene.getModelByName("FemurCut");
          var femurasd=this.MyScene.getModelByName("Femurasd");
          var trans_femur=this.MyScene.getTransformByName("变换_股骨假体调整");
          var jt_femur=this.MyScene.getModelByName(this.MyScene.clips[0].JTName);
          if(ifQuxi===1){
            var jtTo0 = this.MyScene.getTransformByName("jtTo0");
            trans_femur.parent=jtTo0;
            jt_femur.parent=jtTo0;
          }
          else{
            trans_femur.parent=null;
            jt_femur.parent=null;
          }
          jt_femur.UpdatePosition();
          femur.UpdatePosition();
          femurasd.UpdatePosition();
          this.myclip_femur.updatePointsViewPosition();

        }


        SetPointVisible(){
          var FemurPoints1 = ['开髓点1', '内侧凹点1', '外侧凸点1', '内侧远端1', '外侧远端1', '内侧后髁1', '外侧后髁1', '外侧皮质高点1', 'A点1', "股骨头球心1",'H点1','胫骨隆凸1', '胫骨结节1', '外侧高点1', '内侧高点1','踝穴中心1'];
          for(var i=0;i<FemurPoints1.length;i++){
            this.MyScene.getMarkupsByName(FemurPoints1[i]).setVisibility(!this.MyScene.getMarkupsByName(FemurPoints1[i]).visibility);
          }
        }

        SetJTVisible(){
          var jt_femur=this.MyScene.getModelByName(this.MyScene.clips[0].JTName);
          var jt_tibia=this.MyScene.getModelByName(this.MyScene.clips[1].JTName);
          var jt_insert=this.MyScene.getModelByName(this.MyScene.clips[1].JTName.replace("Tibia","Insert"))
          jt_femur.setVisibility(!jt_femur.visibility);
          jt_tibia.setVisibility(!jt_tibia.visibility);
          jt_insert.setVisibility(!jt_insert.visibility);
      
        }

        SetCutVisible(){
          var femur=this.MyScene.getModelByName("Femurasd");
          var tibia=this.MyScene.getModelByName("Tibiaasd");
          femur.setVisibility(!femur.visibility);
          tibia.setVisibility(!tibia.visibility);
        }

        ChangeTibiaAxis(axis){
          if (axis===1){
          this.MyScene.getModelByName(this.MyScene.clips[0].JTName).setVisibility(1);
          //this.MyScene.getModelByName("Femurasd").setVisibility(1);
          this.MyScene.getModelByName("FemurCut").setVisibility(1);
          this.MyScene.getModelByName(this.MyScene.clips[1].JTName.replace("Tibia","Insert")).setVisibility(1);
        }
        else{
          this.MyScene.views[2].setCameraPisitionByIndex(2)
          this.MyScene.getModelByName(this.MyScene.clips[0].JTName).setVisibility(0);
          //this.MyScene.getModelByName("Femurasd").setVisibility(0);
          this.MyScene.getModelByName("FemurCut").setVisibility(0);
          this.MyScene.getModelByName(this.MyScene.clips[1].JTName.replace("Tibia","Insert")).setVisibility(0);
        }

        }
      }

    let MyScene =new MyVTKScene();
    function threedViewInit(){
      const container1 = document.getElementById('left-container');
      const container2 = document.getElementById('right-container');
      const container3 = document.getElementById('JGZX-container');
      MyScene.AddThreeDView("threeD1",container1);
      MyScene.AddThreeDView("threeD2",container2);
      MyScene.AddThreeDView("threeD3",container3);
      MyScene.views[1].setCameraPisitionByIndex(1);
      MyScene.views[2].setCameraPisitionByIndex(2);
    }

    
    

  </script> 


  <div id="mainContent">
    <header>
        <div class="menu">
            <button id="menu-btn1" class="menu-btn active" onclick="TobBtnsChangePage(this)"><img src="static/asset/img/1.png" draggable="false"></button>
            <button id="menu-btn2" class="menu-btn" onclick="TobBtnsChangePage(this)"><img src="static/asset/img/2.png"></button>
            <button id="menu-btn3" class="menu-btn" onclick="TobBtnsChangePage(this)"><img src="static/asset/img/3.png"></button>
            <button id="menu-btn4" class="menu-btn" onclick="TobBtnsChangePage(this)"><img src="static/asset/img/4.png"></button>
            <button id="menu-btn5" class="menu-btn" onclick="TobBtnsChangePage(this)"><img src="static/asset/img/5.png"></button>
            <button id="menu-btn6" class="menu-btn" onclick="TobBtnsChangePage(this)"><img src="static/asset/img/6.png"></button>
            <button id="menu-btn7" class="menu-btn" onclick="TobBtnsChangePage(this)"><img src="static/asset/img/7.png"></button>
        </div>
        <div class="information">
            <div class="inform">
              <div class="inform-title"><b>姓名</b></div>
              <div class="inform-title" style="color: #ffffff50;">----</div>
              <div id="showPName" class="inform-text">张三</div>
            </div>
            <div class="inform">
              <div class="inform-title"><b>I D</b></div>
              <div class="inform-title" style="color: #ffffff50;">----</div>
              <div id="showPID" class="inform-text">105776863</div>
            </div>
            <div class="inform">
              <div class="inform-title"><b>术式</b></div>
              <div class="inform-title" style="color: #ffffff50;">----</div>
              <div id="showPSurgery" class="inform-text">膝关节置换</div>
            </div>
            <div class="inform">
              <div class="inform-title"><b>患侧</b></div>
              <div class="inform-title" style="color: #ffffff50;">----</div>
              <div id="showPAffectedSide" class="inform-text">左侧</div>
            </div>
          </div>
          
        <div class="prosthesisBtn">
            <div class="prosthesisbox">
                <div class="row" style="height: 35%;">
                    <p style="text-align: center;font-size: 25px;"><b>股骨尺寸</b></p>
                </div>
                <div class="row" style="height: 60%;">
                    <div class="prosthesisborder">
                        <button class="decreasebtn-left decreasebtn gugu_decreasebtn" onclick="changeGuGuJiaTi('left')"><i class="bi bi-arrow-left-circle"></i></button>
                        <p ><b id="guguSize" clss="sizetext">9</b></p>
                        <button class="decreasebtn-right decreasebtn gugu_decreasebtn" onclick="changeGuGuJiaTi('right')"><i class="bi bi-arrow-right-circle"></i></button>
                    </div>
                </div>
              </div>
              <div class="prosthesisbox">
                <div class="row" style="height: 35%;">
                    <p style="text-align: center;font-size: 25px;"><b>厚度</b></p>
                </div>
                <div class="row" style="height: 60%;">
                    <div class="prosthesisborder">
                        <button class="decreasebtn-left decreasebtn"><i class="bi bi-arrow-left-circle"></i></button>
                        <p><b id="houduSize" clss="sizetext">9</b></p>
                        <button class="decreasebtn-right decreasebtn"><i class="bi bi-arrow-right-circle"></i></button>
                    </div>
                </div>
              </div>
              <div class="prosthesisbox">
                <div class="row" style="height: 35%;">
                    <p style="text-align: center;font-size: 25px;"><b>胫骨尺寸</b></p>
                </div>
                <div class="row" style="height: 60%;">
                    <div class="prosthesisborder">
                        <button class="decreasebtn-left decreasebtn" onclick="changeJingGuJiaTi('left')"><i class="bi bi-arrow-left-circle"></i></button>
                        <p><b id="jingguSize" clss="sizetext">9</b></p>
                        <button class="decreasebtn-right decreasebtn" onclick="changeJingGuJiaTi('right')"><i class="bi bi-arrow-right-circle"></i></button>
                    </div>
                </div>
              </div>
        </div>
    </header>


    <div class="footer">
      <div class="bottomBtnBox">
        <button id="bottomBtn1" class="bottomBtns" onclick="bottomBtnsCheck(this)"></button>
        <button id="bottomBtn2" class="bottomBtns" onclick="bottomBtnsCheck(this)"></button>
        <button id="bottomBtn3" class="bottomBtns" onclick="bottomBtnsCheck(this)"></button>
        <button id="bottomBtn4" class="bottomBtns" onclick="bottomBtnsCheck(this)"></button>
        <button id="bottomBtn5" class="bottomBtns" onclick="bottomBtnsCheck(this)"></button>
        <div class="bottomSpacer"></div>
      </div>

      <div class="toolsLight">
        <div id="tool-needle" class="toolLight unactive"></div>
        <div id="tool-femur" class="toolLight unactive"></div>
        <div id="tool-tibia" class="toolLight unactive"></div>
      </div>

      <div class="companyInfo">
        <div class="bottomSpacer"></div>
        <div id="companyIcon"></div>
        <div id="companyName"></div>
      </div>

    </div>   
    
    
    <main>
        <div id="page-1" class="page-1 page" style="display: none;">
            <div class="page-1-1">
                <div class="surgicalTechnique">
                    <div clas="row" style="display: flex;align-items: center;padding-left: 30px;">
                        <h2>手术技术</h2>
                        <hr color="#fff" size="5" width="80%">
                    </div>
                    <div clas="row" style="display:flex; justify-content: center; align-items: center;">
                        <label style="flex-basis: 50%; margin-left: 250px;font-size: 20px;">
                          <input type="radio" name="Technique" id="CTMRI" value="CTMRI" checked onclick="uncheckOther(this)"> CT/MRI
                        </label>
                        <label style="flex-basis: 50%;font-size: 20px;">
                          <input type="radio" name="Technique" value="骨变形" id="boneDeformation" onclick="uncheckOther(this)"> 骨变形
                        </label>
                    </div>
                    <div clas="row" style="height: 730px;margin-top: 20px;">
                        <img id="Technique_img" class="initimg" src="static/asset/init_img/CTMRI.png" alt="图">
                    </div>
                </div>
                <div class="surgicalInstruments">
                    <div clas="row" style="display: flex;align-items: center;padding-left: 30px;">
                        <h2>手术器械</h2>
                        <hr color="#fff" size="5" width="80%">
                    </div>
                    <div clas="row" style="display:flex; justify-content: center; align-items: center;">
                        <label style="flex-basis: 25%; margin-left: 100px;font-size: 20px;">
                            <input type="radio" name="Instruments" id="OsteotomyPlate" value="四合一截骨板" checked onclick="uncheckOther(this)"> 四合一截骨板
                          </label>
                        <label style="flex-basis: 25%;font-size: 20px;">
                            <input type="radio" name="Instruments" id="PSIGuides" value="PSI导板" onclick="uncheckOther(this)"> PSI导板
                        </label>
                        <label style="flex-basis: 25%;font-size: 20px;">
                            <input type="radio" name="Instruments" id="ZhiWei" value="智唯机器人" onclick="uncheckOther(this)"> 智唯机器人
                        </label>
                        <label style="flex-basis: 25%;font-size: 20px;">
                            <input type="radio" name="Instruments" id="ZhiXiang" value="智想机器人" onclick="uncheckOther(this)"> 智想机器人
                        </label>
                    </div>
                    <div clas="row" style="height: 730px; margin-top: 20px;position: relative;">
                        <img id="Instruments_img" class="initimg" src="static/asset/init_img/四合一截骨板.png" alt="图">
                        <button id="page-1-1-btn" class="bottons" style="top: 600px; right:20px; z-index: 1;" onclick="page1ChangeBtn(this)">确  认</button>
                    </div>
                </div>
            </div>

            <div class="page-1-2" style="display: none;">
                <div class="Sequenceofsurgery">
                    <div clas="row" style="display: flex;align-items: center;padding-left: 30px;">
                        <h2>手术顺序</h2>
                        <hr color="#fff" size="5" width="80%">
                    </div>
                    <div clas="row" style="display:flex; justify-content: center; align-items: center;">
                        <label style="flex-basis: 50%; margin-left: 250px;font-size: 20px;">
                            <input type="radio" name="Bone" id="FemurFirst" value="股骨优先" checked onclick="uncheckOther(this)"> 股骨优先
                          </label>
                          <label style="flex-basis: 50%;font-size: 20px;">
                            <input type="radio" name="Bone" id="TibiaFirst" value="胫骨优先" onclick="uncheckOther(this)"> 胫骨优先
                          </label>
                    </div>
                    <div clas="row" style="height: 730px; margin-top: 20px;">
                        <img id="Bone_img" class="initimg" src="static/asset/init_img/股骨优先.png" alt="图">
                    </div>
                </div>
                <div class="gapBalance">
                    <div clas="row" style="display: flex;align-items: center;padding-left: 30px;">
                        <h2>间隙平衡</h2>
                        <hr color="#fff" size="5" width="80%">
                    </div>
                    <div clas="row" style="display:flex; justify-content: center; align-items: center;">
                        <label style="flex-basis: 50%; margin-left: 250px;font-size: 20px;">
                            <input type="radio" name="Balance" id="osteotomyBalance" value="截骨平衡" checked onclick="uncheckOther(this)"> 截骨平衡
                          </label>
                        <label style="flex-basis: 50%;font-size: 20px;">
                            <input type="radio" name="Balance" id="softTissueBalance" value="软组织平衡" onclick="uncheckOther(this)"> 软组织平衡
                        </label>
                    </div>
                    <div clas="row" style="height: 730px; margin-top: 20px;position: relative;">
                        <img id="Balance_img" class="initimg" src="static/asset/init_img/截骨平衡.png" alt="图">
                        <button id="page-1-2-btn" class="bottons" style="top: 600px; right:20px; z-index: 1;" onclick="page1ChangeBtn(this)">确  认</button>
                    </div>
                </div>
            </div>
        </div>

        <div id="page-2" class="page-2 page" style="display: none;">
          <div class="flowChartbox">
            <div style="flex: 1;"></div>
            <div class="flowChart">
              <button id="arrowButton1" class="arrow-button active" onclick="page2ChangeTopBtn(1)" style="top: 10px;left: 30px;"></button>
              <button id="arrowButton2" class="arrow-button2" onclick="page2ChangeTopBtn(2)" style="top: 10px;left: 320px;"></button>
              <button id="arrowButton3" class="arrow-button2" onclick="page2ChangeTopBtn(3)" style="top: 10px;left: 610px;"></button>
              <button id="arrowButton4" class="arrow-button2" onclick="page2ChangeTopBtn(4)" style="top: 10px;left: 900px;"></button>
              <button id="arrowButton5" class="arrow-button2" onclick="page2ChangeTopBtn(5)" style="top: 10px;left: 1190px;"></button>
              <button id="arrowButton6" class="arrow-button2" onclick="page2ChangeTopBtn(6)" style="top: 10px;left: 1480px;"></button>
            </div>
            <div style="flex: 1;"></div>
          </div>
            <div id="page-2-1" class="row-page2" style="display: block;">
              <img class="page-2-img" src="static/asset/praper_img/1.png" alt="图">
              <button class="bottons" onclick="page2ChangeBtn(2)">确  认</button>
              <p class="page-2-text">请将双目台车<br>放置在合适位置</p>
            </div>
            <div id="page-2-2" class="row-page2">
              <img class="page-2-img" src="static/asset/praper_img/2.png" alt="图">
              <button class="bottons" onclick="page2ChangeBtn(3)">确  认</button>
              <p class="page-2-text">锁定台车轮子</p>
            </div>
            <div id="page-2-3" class="row-page2">
              <img class="page-2-img" src="static/asset/praper_img/3.png" alt="图">
              <button class="bottons" onclick="page2ChangeBtn(4)">确  认</button>
              <p class="page-2-text">·准备机械臂台车<br>·安防机械臂<br>·撤离台车</p>
            </div>
            <div id="page-2-4" class="row-page2">
              <img class="page-2-img" src="static/asset/praper_img/4.png" alt="图">
              <button class="bottons" onclick="page2ChangeBtn(5)">确  认</button>
              <p class="page-2-text" style="right: 5%;">检查器械摆放位置</p>
            </div>
            <div id="page-2-5" class="row-page2">
              <img class="page-2-img" src="static/asset/praper_img/5.png" alt="图">
              <button class="bottons" onclick="page2ChangeBtn(6)">确  认</button>
              <p class="page-2-text" style="right: 20%;">将双目对准机械臂末端</p>
              <div class="countDownSvg">
                <!-- <svg viewBox="0 0 100 100" style="border: 1px solid #fff;">
                    <circle class="ring" id="ring1" cx="50" cy="50" r="40" transform="rotate(-90, 50, 50)" />
                    <circle class="ring" id="ring2" cx="50" cy="50" r="40" transform="rotate(-30, 50, 50)" />
                    <circle class="ring" id="ring3" cx="50" cy="50" r="40" transform="rotate(30, 50, 50)" />
                    <circle class="ring" id="ring4" cx="50" cy="50" r="40" transform="rotate(90, 50, 50)" />
                    <circle class="ring" id="ring5" cx="50" cy="50" r="40" transform="rotate(150, 50, 50)" />
                    <circle class="ring" id="ring6" cx="50" cy="50" r="40" transform="rotate(210, 50, 50)" />
                </svg> -->
                <!-- <div><img class="coundownimg" src="/static/asset/countDown_img/1.png"></div>
                <div><img class="coundownimg" src="/static/asset/countDown_img/2.png"></div>
                <div><img class="coundownimg" src="/static/asset/countDown_img/3.png"></div>
                <div><img class="coundownimg" src="/static/asset/countDown_img/4.png"></div>
                <div><img class="coundownimg" src="/static/asset/countDown_img/5.png"></div>
                <div><img class="coundownimg" src="/static/asset/countDown_img/6.png"></div> -->
            </div>

            </div>
            <div id="page-2-6" class="row-page2">
              <img class="page-2-img" src="static/asset/praper_img/6.png" alt="图">
              <button class="bottons" onclick="page2ChangeBtn(7)">确  认</button>
              <p class="page-2-text">安装定位工具</p>
            </div>
  
        </div>
        
        <div id="page-3" class="page-3 page" style="display: none;">
            <div class="checkPointarea">
                <div id="gugu1" class="peizhun-item">
                    <button class="peizhun-Btns" style="color: aqua;"><i class="bi bi-circle"></i></button>
                    <p class="peizhun-text" style="color: aqua;">开髓点</p>
                    <div class="points-count" style="border-color: aqua;color: aqua;"><p class="count-text"><b>1</b></p></div>
                </div>
                <div id="gugu2" class="peizhun-item">
                    <button class="peizhun-Btns"><i class="bi bi-circle"></i></button>
                    <p class="peizhun-text">内侧凹点</p>
                    <div class="points-count"><p class="count-text"><b>1</b></p></div>
                </div>
                <div id="gugu3" class="peizhun-item">
                    <button class="peizhun-Btns"><i class="bi bi-circle"></i></button>
                    <p class="peizhun-text">外侧凸点</p>
                    <div class="points-count"><p class="count-text"><b>1</b></p></div>
                </div>
                <div id="gugu4" class="peizhun-item">
                    <button class="peizhun-Btns"><i class="bi bi-circle"></i></button>
                    <p class="peizhun-text">内侧远端</p>
                    <div class="points-count"><p class="count-text"><b>1</b></p></div>
                </div>
                <div id="gugu5" class="peizhun-item">
                    <button class="peizhun-Btns"><i class="bi bi-circle"></i></button>
                    <p class="peizhun-text">外侧远端</p>
                    <div class="points-count"><p class="count-text"><b>1</b></p></div>
                </div>
                <div id="gugu6" class="peizhun-item">
                    <button class="peizhun-Btns"><i class="bi bi-circle"></i></button>
                    <p class="peizhun-text">内侧后髁</p>
                    <div class="points-count"><p class="count-text"><b>1</b></p></div>
                </div>
                <div id="gugu7" class="peizhun-item">
                    <button class="peizhun-Btns"><i class="bi bi-circle"></i></button>
                    <p class="peizhun-text">外侧后髁</p>
                    <div class="points-count"><p class="count-text"><b>1</b></p></div>
                </div>
                <div id="gugu8" class="peizhun-item">
                    <button class="peizhun-Btns"><i class="bi bi-circle"></i></button>
                    <p class="peizhun-text">外侧皮质高点</p>
                    <div class="points-count"><p class="count-text"><b>1</b></p></div>
                </div>
                <div id="gugu9" class="peizhun-item">
                    <button class="peizhun-Btns"><i class="bi bi-circle"></i></button>
                    <p class="peizhun-text">A点</p>
                    <div class="points-count"><p class="count-text"><b>1</b></p></div>
                </div>
                <div id="gugu10" class="peizhun-item">
                  <button class="peizhun-Btns"><i class="bi bi-circle"></i></button>
                  <p class="peizhun-text">H点</p>
                  <div class="points-count"><p class="count-text"><b>1</b></p></div>
              </div>
                <div id="gugu11" class="peizhun-item">
                  <button class="peizhun-Btns"><i class="bi bi-circle"></i></button>
                  <p class="peizhun-text">股骨头球心</p>
                  <div class="points-count"><p class="count-text"><b>1</b></p></div>
              </div>
                <div id="gugu12" class="peizhun-item">
                    <button class="peizhun-Btns"><i class="bi bi-circle"></i></button>
                    <p class="peizhun-text">内侧远端区域</p>
                    <div class="points-count"><p class="count-text"><b>1</b></p></div>
                </div>
                <div id="gugu13" class="peizhun-item">
                    <button class="peizhun-Btns"><i class="bi bi-circle"></i></button>
                    <p class="peizhun-text">外侧远端区域</p>
                    <div class="points-count"><p class="count-text"><b>1</b></p></div>
                </div>
                <div id="gugu14" class="peizhun-item">
                    <button class="peizhun-Btns"><i class="bi bi-circle"></i></button>
                    <p class="peizhun-text">内侧后髁区域</p>
                    <div class="points-count"><p class="count-text"><b>1</b></p></div>
                </div>
                <div id="gugu15" class="peizhun-item">
                    <button class="peizhun-Btns"><i class="bi bi-circle"></i></button>
                    <p class="peizhun-text">外侧后髁区域</p>
                    <div class="points-count"><p class="count-text"><b>1</b></p></div>
                </div>
                <div id="gugu16" class="peizhun-item">
                    <button class="peizhun-Btns"><i class="bi bi-circle"></i></button>
                    <p class="peizhun-text">外侧皮质高点</p>
                    <div class="points-count"><p class="count-text"><b>1</b></p></div>
                </div>
                <div class="row" style="display: flex; position: relative; height: 100px;margin-top: 20px;gap: 10px;padding-left: 10px;padding-right: 10px;">
                    <!-- <img src="static/asset/img/01.png" alt="图" style="height: 100%;width: 100%;"> -->
                    <button id="gugu_ok" class="peizhun-okbtn" style="flex: 1;right:30px; z-index: 1;" onclick="MyScene.selectes[0].onSelect1()">确 认</button>
                    <button class="peizhun-okbtn" style="flex: 1;right:190px; z-index: 1;" onclick="MyScene.selectes[0].onReset()">重 置</button>
                    <button id="next_area" class="peizhun-okbtn" disabled style="pointer-events: none; flex: 1;right:350px; z-index: 1;" onclick="MyScene.selectes[0].OnNextArea()">下一区域</button>
                </div>
                
                
            </div>
            <div class="showImgarea">
                <img id="pointImg_gugu" src="static/asset/points/femur0_1.png" alt="图" style="height: 100%;">
            </div>
        </div>

        <div id="page-4" class="page-4 page" style="display: none;">
            <div class="checkPointarea">
                <div id="jinggu1" class="peizhun-item">
                    <button class="peizhun-Btns" style="color: aqua;"><i class="bi bi-circle"></i></button>
                    <p class="peizhun-text" style="color: aqua;">胫骨隆凸</p>
                    <div class="points-count" style="border-color: aqua;color: aqua;"><p class="count-text"><b>1</b></p></div>
                </div>
                <div id="jinggu2" class="peizhun-item">
                    <button class="peizhun-Btns"><i class="bi bi-circle"></i></button>
                    <p class="peizhun-text">内踝点</p>
                    <div class="points-count"><p class="count-text"><b>1</b></p></div>
                </div>
                <div id="jinggu3" class="peizhun-item">
                    <button class="peizhun-Btns"><i class="bi bi-circle"></i></button>
                    <p class="peizhun-text">外踝点</p>
                    <div class="points-count"><p class="count-text"><b>1</b></p></div>
                </div>
                <div id="jinggu4" class="peizhun-item">
                    <button class="peizhun-Btns"><i class="bi bi-circle"></i></button>
                    <p class="peizhun-text">内侧高点</p>
                    <div class="points-count"><p class="count-text"><b>1</b></p></div>
                </div>
                <div id="jinggu5" class="peizhun-item">
                    <button class="peizhun-Btns"><i class="bi bi-circle"></i></button>
                    <p class="peizhun-text">外侧高点</p>
                    <div class="points-count"><p class="count-text"><b>1</b></p></div>
                </div>
                <div id="jinggu6" class="peizhun-item">
                    <button class="peizhun-Btns"><i class="bi bi-circle"></i></button>
                    <p class="peizhun-text">胫骨结节</p>
                    <div class="points-count"><p class="count-text"><b>1</b></p></div>
                </div>
                <div id="jinggu7" class="peizhun-item">
                    <button class="peizhun-Btns"><i class="bi bi-circle"></i></button>
                    <p class="peizhun-text">内侧平台区域</p>
                    <div class="points-count"><p class="count-text"><b>1</b></p></div>
                </div>
                <div id="jinggu8" class="peizhun-item">
                    <button class="peizhun-Btns"><i class="bi bi-circle"></i></button>
                    <p class="peizhun-text">外侧平台区域</p>
                    <div class="points-count"><p class="count-text"><b>1</b></p></div>
                </div>
                <div id="jinggu9" class="peizhun-item">
                    <button class="peizhun-Btns"><i class="bi bi-circle"></i></button>
                    <p class="peizhun-text">胫骨前侧区域</p>
                    <div class="points-count"><p class="count-text"><b>1</b></p></div>
                </div>  
                <div class="row" style="display: flex; position: relative; height: 100px;margin-top: 20px;gap: 10px;padding-left: 10px;padding-right: 10px;">
                    <!-- <img src="static/asset/img/01.png" alt="图" style="height: 100%;width: 100%;"> -->
                    <button id="jinggu_ok" class="peizhun-okbtn" style="flex: 1;z-index: 1;" onclick="MyScene.selectes[1].onSelect1()">确 认</button>
                    <button class="peizhun-okbtn" style="flex: 1; right:190px; z-index: 1;" onclick="MyScene.selectes[1].onReset()">重 置</button>
                    <button id="next_area2" disabled class="peizhun-okbtn" style="pointer-events:none;flex: 1;z-index: 1;" onclick="MyScene.selectes[1].OnNextArea()">下一区域</button>
                </div>     
                
            </div>
            <div class="showImgarea">
              <img id="pointImg_jinggu" src="static/asset/points/tibia1_1.png" alt="图" style="height: 100%;">
            </div>
        </div>

        <div id="page-5" class="page-5 page" style="display: none;">
            <div class="top-tab">
                <div style="flex: 1;border-bottom: 1px solid #fff;"></div>
                <button class="tab-btn active">术前</button>
                <button class="tab-btn">术中</button>
                <button class="tab-btn">术后</button>
                <div style="flex: 1;border-bottom: 1px solid #fff;"></div>
            </div>
            <div class="planning-moving-ui">
                <!-- <label for="rect-angle-input">Rectangle Angle:</label>
                <input id="rect-angle-input" type="range" min="0" max="360" step="1" value="0"> -->
                <div id="legRotate">
                    <div id="legbackground"></div>
                    <div id="legrectangle"></div>
                </div>

                <div class="spacer">
                </div>

                <div id="Valgus">
                    <div style="width: 100%; height: 70px;">
                        <hr color="#fff" size="3" width="80%" style="position: absolute;top:20px;left: 60px;">
                        <p style="position: absolute;top:10px;right: 150px;font-size: 25px;">内翻°</p>
                        <p style="position: absolute;top:10px;left: 150px;font-size: 25px;">外翻°</p>
                    </div>
                    <div id="Valgus-ui" style="width: 632px; flex: 1;">
                        <p class="Valgus-ui-y-text" style="top:85px;left: 35px;">0°</p>
                        <p class="Valgus-ui-y-text" style="top:220px;left: 25px;">45°</p>
                        <p class="Valgus-ui-y-text" style="top:360px;left: 25px;">90°</p>

                        <div id="shu-handle">
                        </div>

                        <div id="heng-handle">
                        </div>

                        <div id="mark0" class="mark" style="top:120px;">
                        </div>
                        <div id="mark45" class="mark" style="top:255px;">
                        </div>
                        <div id="mark90" class="mark" style="top:390px;">
                        </div>

                        <button class="clearmark" style="top:120px;" onclick="clearMark0(0)"><i class="bi bi-shield-x"></i></button>
                        <button class="clearmark" style="top:257px;" onclick="clearMark0(45)"><i class="bi bi-shield-x"></i></button>
                        <button class="clearmark" style="top:392px;" onclick="clearMark0(90)"><i class="bi bi-shield-x"></i></button>


                        <button class="bottons" style="bottom:-5px;" onclick="clearMark0(1)">清除所有</button>

                    </div>
                </div>

                <div class="spacer">
                </div>

                <div id="Valgus0_90">
                    <hr color="#fff" size="3" width="40%" style="position: absolute;top:20px;right: 20px;">
                    <p style="position: absolute;top:-20px;right: 285px;font-size: 30px;">间隙</p>
                    <hr color="#fff" size="3" width="40%" style="position: absolute;top:20px;left: 20px;">
                    <p style="position: absolute;top:10px;right: 80px;font-size: 25px;">屈膝90°</p>
                    <p style="position: absolute;top:10px;left: 100px;font-size: 25px;">伸直0°</p>
                    <div id="shenzhi-gugu"></div>
                    <div id="shenzhi-jinggu"></div>
                    <div id="quxi-gugu"></div>
                    <div id="quxi-jinggu"></div>
                    <p><b id="shenzhi_waice" class="jianxi-text" style="left: 5px;">0.0mm</b></p>
                    <p><b id="shenzhi_neice" class="jianxi-text" style="left: 170px;">0.0mm</b></p>
                    <p><b id="quxi_neice" class="jianxi-text" style="right: 200px;">0.0mm</b></p>
                    <p><b id="quxi_waice" class="jianxi-text" style="right: 25px;">0.0mm</b></p>
                    <p class="LM-text" style="left: 20px;"><b>L</b></p>
                    <p class="LM-text" style="left: 250px;"><b>M</b></p>
                    <p class="LM-text" style="right: 250px;"><b>L</b></p>
                    <p class="LM-text" style="right: 5px;"><b>M</b></p>

                    <button class="bottons" style="bottom:0px;" onclick="page5ChangeBtn()">确认</button>
                </div>

            </div>
        </div>

        <div id="page-6" class="page-6 page">
          <div id="jingguzhouxiang">
            <div style="flex: 1;"></div>
              <div id="jingguzhouxiangBox">
                <div class="text-row1">
                  <div style="padding-top: 5px;">胫骨轴向</div>
                  <div><b id="gugu_neiwaifan" class="text-value">0.0°</b></div>
                </div>
                <div id="JGZX-container" class="text-col2" style="position: relative;">
                  <div style="z-index: 3; font-size: 100px;position: absolute;top:40%;"><b>L</b></div>
                  <div style="z-index: 3; font-size: 100px;position: absolute;top:40%;right: 0px;"><b>M</b></div>
                  <div class="ring_border" style="left: 375px;top:240px;">
                    <button class="ring_btn" style="left: 100px;" onclick="onLeftTop_upbtn()"><i class="bi bi-caret-up-fill"></i></button>
                    <button class="ring_btn" style="bottom: 0px; left: 100px;" onclick="onLeftTop_downbtn()"><i class="bi bi-caret-down-fill"></i></button>
                    <button class="ring_btn" style="right: 0px; top: 100px;" onclick="onLeftTop_rightbtn()"><i class="bi bi-caret-right-fill"></i></button>
                    <button class="ring_btn" style="top: 100px;" onclick="onLeftTop_leftbtn()"><i class="bi bi-caret-left-fill"></i></button>
                    <button class="ring_btn" style="right: 24px; top: 34px;transform: rotate(50deg);" onclick="onLeftTop_up_rightbtn()"><i class="bi bi-caret-up-fill"></i></button>
                    <button class="ring_btn" style="left: 24px; top: 34px;transform: rotate(-50deg);" onclick="onLeftTop_up_leftbtn()"><i class="bi bi-caret-up-fill"></i></button>
                    <button class="ring_btn" style="width: 180px;height: 180px; top: 33px; left: 35px;border: 10px solid #fff;border-radius: 100px;"></button>
                    <button id="jingguzhouxiang_ring" class="ring_btn" style="width: 150px;height: 150px; top: 48px; left: 50px;border-radius: 100px;" onclick="showHideRing(this)"></button>
                  </div> 
                </div>
              </div>
            <div style="flex: 1;"></div>
          </div>

          <div id="pingguPage">
            <div class="page-6-left">
                <div class="text-row1">
                    <div style="padding-top: 5px;">股骨 内翻/外翻</div>
                    <div><b id="gugu_neiwaifan" class="text-value">0.0°</b></div>
                </div>
                <div class="text-row2">
                    <div class="text-col1">
                        <div class="col-text">
                            <div>远端截骨量</div>
                            <div><b id="gugu_waice_yuanduan" class="text-value">0.0mm</b></div>
                        </div>
                        <div class="col-text">
                            <div>后髁截骨量</div>
                            <div><b id="waice_houke" class="text-value">0.0mm</b></div>
                        </div>
                        <div class="col-text">
                            <div style="font-size: 100px;"><b>L</b></div>
                        </div>
                        <div class="col-text">
                            <div>远端截骨量</div>
                            <div><b id="jinggu_waice_yuanduan" class="text-value">0.0mm</b></div>
                        </div>
                    </div>
                    <div style="flex: 1;"></div>
                    <div id="left-container" class="text-col2" style="position: relative;min-width: 650px;">
                      <div class="ring_border" style="left: 200px;top:100px;">
                        <button class="ring_btn" style="left: 100px;" onclick="onLeftTop_upbtn()"><i class="bi bi-caret-up-fill"></i></button>
                        <button class="ring_btn" style="bottom: 0px; left: 100px;" onclick="onLeftTop_downbtn()"><i class="bi bi-caret-down-fill"></i></button>
                        <button class="ring_btn" style="right: 0px; top: 100px;" onclick="onLeftTop_rightbtn()"><i class="bi bi-caret-right-fill"></i></button>
                        <button class="ring_btn" style="top: 100px;" onclick="onLeftTop_leftbtn()"><i class="bi bi-caret-left-fill"></i></button>
                        <button class="ring_btn" style="right: 24px; top: 34px;transform: rotate(50deg);" onclick="onLeftTop_up_rightbtn()"><i class="bi bi-caret-up-fill"></i></button>
                        <button class="ring_btn" style="left: 24px; top: 34px;transform: rotate(-50deg);" onclick="onLeftTop_up_leftbtn()"><i class="bi bi-caret-up-fill"></i></button>
                        <button class="ring_btn" style="width: 180px;height: 180px; top: 33px; left: 35px;border: 10px solid #fff;border-radius: 100px;"></button>
                        <button id="left_up_ring" class="ring_btn" style="width: 150px;height: 150px; top: 48px; left: 50px;border-radius: 100px;" onclick="showHideRing(this)"></button>
                      </div> 
                      <div class="ring_border" style="left: 200px;bottom:100px;">
                        <button class="ring_btn" style="left: 100px;" onclick="onLeftBottom_upbtn()"><i class="bi bi-caret-up-fill"></i></button>
                        <button class="ring_btn" style="bottom: 0px; left: 100px;" onclick="onLeftBottom_downbtn()"><i class="bi bi-caret-down-fill"></i></button>
                        <button class="ring_btn" style="right: 0px; top: 100px;" onclick="onLeftBottom_rightbtn()"><i class="bi bi-caret-right-fill"></i></button>
                        <button class="ring_btn" style="top: 100px;" onclick="onLeftBottom_leftbtn()"><i class="bi bi-caret-left-fill"></i></button>
                        <button class="ring_btn" style="right: 24px; top: 34px;transform: rotate(50deg);" onclick="onLeftBottom_up_rightbtn()"><i class="bi bi-caret-up-fill"></i></button>
                        <button class="ring_btn" style="left: 24px; top: 34px;transform: rotate(-50deg);" onclick="onLeftBottom_up_leftbtn()"><i class="bi bi-caret-up-fill"></i></button>
                        <button class="ring_btn" style="width: 180px;height: 180px; top: 33px; left: 35px;border: 10px solid #fff;border-radius: 100px;"></button>
                        <button id="left_down_ring" class="ring_btn" style="width: 150px;height: 150px; top: 48px; left: 50px;border-radius: 100px;" onclick="showHideRing(this)"></button>
                      </div>
                    </div>
                    <div style="flex: 1;"></div>
                    <div class="text-col3">
                        <div class="col-text">
                            <div>远端截骨量</div>
                            <div><b id="gugu_neice_yuanduan" class="text-value">0.0mm</b></div>
                        </div>
                        <div class="col-text">
                            <div>后髁截骨量</div>
                            <div><b id="neice_houke" class="text-value">0.0mm</b></div>
                        </div>
                        <div class="col-text">
                            <div style="font-size: 100px;"><b>M</b></div>
                        </div>
                        <div class="col-text">
                            <div>远端截骨量</div>
                            <div><b id="jinggu_neice_yuanduan" class="text-value">0.0mm</b></div>
                        </div>
                    </div>
                </div>
                <div class="text-row3">
                    <div>胫骨 内翻/外翻</div>
                    <div><b id="jinggu_neiwaifan" class="text-value">0.0°</b></div>
                </div>
            </div>
            <div class="page-6-right">
                <div class="left-viewarea">
                    <div style="display: flex;text-align: center;">
                        <div style="flex: 1;"></div>
                        <div>
                            <div class="text-row1" style="margin-right: 30px;">
                                <div style="padding-top: 5px;">笔针厚度</div>
                                <div><b class="text-value">0.0mm</b></div>
                            </div>
                        </div>
                        <div id="guGuQingJiao">
                            <div class="text-row1">
                                <div style="padding-top: 5px;">股骨倾角</div>
                                <div><b id="gugu_qingjiao" class="text-value">0.0°</b></div>
                            </div>
                        </div>
                        <div style="flex: 1;"></div>
                    </div>
                    <div style="display: flex; position: relative;flex: 1;">
                      <div style="flex: 1;"></div>
                      <div id="3dview2" style="min-width: 700px;height: 100%;">
                          <div id="right-container" class="threedView2" style="height: 100%;width: 100%;">
                            <button class="changeStateBtn1" onclick="onJiaoHu(this)"></button>
                            <button class="changeStateBtn2 active" onclick="showRing(this)"></button>
                            <div id="show_ring_2" class="ring_border" style="left: 225px;top:100px;">
                              <button class="ring_btn" style="left: 100px;" onclick="onRightTop_upbtn()"><i class="bi bi-caret-up-fill"></i></button>
                              <button class="ring_btn" style="bottom: 0px; left: 100px;" onclick="onRightTop_downbtn()"><i class="bi bi-caret-down-fill"></i></button>
                              <button class="ring_btn" style="right: 0px; top: 100px;" onclick="onRightTop_rightbtn()"><i class="bi bi-caret-right-fill"></i></button>
                              <button class="ring_btn" style="top: 100px;" onclick="onRightTop_leftbtn()"><i class="bi bi-caret-left-fill"></i></button>
                              <button class="ring_btn" style="right: 24px; top: 34px;transform: rotate(50deg);" onclick="onRightTop_up_rightbtn()"><i class="bi bi-caret-up-fill"></i></button>
                              <button class="ring_btn" style="left: 24px; top: 34px;transform: rotate(-50deg);" onclick="onRightTop_up_leftbtn()"><i class="bi bi-caret-up-fill"></i></button>
                              <button class="ring_btn" style="width: 180px;height: 180px; top: 33px; left: 35px;border: 10px solid #fff;border-radius: 100px;"></button>
                              <button id="right_up_ring" class="ring_btn" style="width: 150px;height: 150px; top: 48px; left: 50px;border-radius: 100px;" onclick="showHideRing(this)"></button>
                            </div> 
                            <div id="show_ring_3" class="ring_border" style="left: 225px;bottom:100px;">
                              <button class="ring_btn" style="left: 100px;" onclick="onRightBottom_upbtn()"><i class="bi bi-caret-up-fill"></i></button>
                              <button class="ring_btn" style="bottom: 0px; left: 100px;" onclick="onRightBottom_downbtn()"><i class="bi bi-caret-down-fill"></i></button>
                              <button class="ring_btn" style="right: 0px; top: 100px;" onclick="onRightBottom_rightbtn()"><i class="bi bi-caret-right-fill"></i></button>
                              <button class="ring_btn" style="top: 100px;" onclick="onRightBottom_leftbtn()"><i class="bi bi-caret-left-fill"></i></button>
                              <button class="ring_btn" style="right: 24px; top: 34px;transform: rotate(50deg);" onclick="onRightBottom_up_rightbtn()"><i class="bi bi-caret-up-fill"></i></button>
                              <button class="ring_btn" style="left: 24px; top: 34px;transform: rotate(-50deg);" onclick="onRightBottom_up_leftbtn()"><i class="bi bi-caret-up-fill"></i></button>
                              <button class="ring_btn" style="width: 180px;height: 180px; top: 33px; left: 35px;border: 10px solid #fff;border-radius: 100px;"></button>
                              <button id="right_down_ring" class="ring_btn" style="width: 150px;height: 150px; top: 48px; left: 50px;border-radius: 100px;" onclick="showHideRing(this)"></button>
                            </div>
                            <script>
                              function hide_ring_border(index){
                                let ring_border = document.getElementsByClassName('ring_border')[index];
                                ring_border.style.opacity = 0.1;
                                let btns = ring_border.children;
                                for(let i=0;i<btns.length-1;i++){
                                  btns[i].disabled = true;
                                  btns[i].style.pointerEvents = 'none';
                                }
                              }
                              hide_ring_border(1);
                              hide_ring_border(3);
                            </script>
                          </div>
                      </div>
                      <div style="flex: 1;"></div>
                    </div>
                    <div id="houQingJiao" class="text-row1">
                        <div class="text-row1">
                            <div>胫骨后倾角</div>
                            <div><b id="jinggu_houqingjiao" class="text-value">0.0°</b></div>
                        </div>
                    </div>


                    <div id="pinggu_ui" style="display: flex;height: 100%;display: none;">
                        <div style="flex: 1;"></div>
                        <div style="width: 800px;position: relative;">
                            <div class="text-row1" style="position: absolute;padding-top: 300px;padding-left: 50px;">
                                <div style="padding-top: 5px;">间隙</div>
                                <div class="text-value"><b id="pinggu_ui_waice_jianxi">4.5mm</b></div>
                            </div>
                            <div class="text-row1" style="position: absolute;padding-top: 430px;padding-left: 50px;">
                                <div style="padding-top: 5px;">截骨</div>
                                <div class="text-value"><b id="pinggu_ui_waice_jiegu">18.5mm</b></div>
                            </div>
                            <div class="text-row1" style="position: absolute;padding-top: 510px;padding-left: 50px;">
                                <div class="text-value"><b id="pinggu_ui_waice_jiegu_lilun">23.0mm</b></div>
                                <!-- <div id="pinggu_ui_waice_jiegu_lilun2" style="padding-top: 5px;">屈膝.24.5</div> -->
                            </div>

                            <div class="text-row1" style="position: absolute;padding-top: 300px;padding-left: 590px;">
                                <div style="padding-top: 5px;">间隙</div>
                                <div class="text-value"><b id="pinggu_ui_neice_jianxi">0.5mm</b></div>
                            </div>
                            <div class="text-row1" style="position: absolute;padding-top: 430px;padding-left: 570px;">
                                <div style="padding-top: 5px;">截骨</div>
                                <div class="text-value"><b id="pinggu_ui_neice_jiegu">18.0mm</b></div>
                            </div>
                            <div class="text-row1" style="position: absolute;padding-top: 510px;padding-left: 570px;">
                                <div class="text-value"><b id="pinggu_ui_neice_jiegu_lilun">18.5mm</b></div>
                                <!-- <div id="pinggu_ui_neice_jiegu_lilun2" style="padding-top: 5px;">屈膝.17.5</div> -->
                            </div>

                            <div class="text-row1" style="position: absolute;padding-top: 400px;padding-left: 310px;">
                                <div style="padding-top: 5px;">胫股间距</div>
                                <div class="text-value"><b id="pinggu_ui_jing_gu_jianju">19.0mm</b></div>
                            </div>
                            <div style="position: absolute;padding-top: 280px;padding-left: 350px;display: flex;">
                                <div id="pinggu_ui_shenzhi_quxi" style="padding-top: 13px;margin-right: 20px;">伸直</div>
                                <div class="text-value"><b id="pinggu_ui_shenzhi_quxi_angle">0°</b></div>
                            </div>

                            <hr color="#fff" size="3" width="26%" style="position: absolute;top:495px;left: 40px;">
                            <hr color="#fff" size="3" width="26%" style="position: absolute;top:495px;left: 532px;">

                            <div id="guihua-jinggu-top">
                            </div>
                            

                            <div id="guihua-jinggu">
                                <p style="font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;position: absolute;font-size: 60px;padding-top: 50px;"><b>L</b></p>
                                <p style="font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;position: absolute;font-size: 60px;padding-left: 250px;padding-top: 50px;"><b>M</b></p> 
                            </div>
                            
                        </div>
                        <div style="flex: 1;"></div>
                    </div>

                </div>
            </div>
          </div>
          <div class="right-btns">
            <div class="viewbtns">
                <p style="margin: 0;margin-top: 50px;">视图</p>
                <button id="shenzhi_btn" class="viewbtn active" onclick="onShenzhi(this)">伸直</button>
                <button  id="quxi_btn" class="viewbtn" onclick="onQuxi(this)">屈膝</button>
                <button class="viewbtn" style="margin-bottom: 50px;" onclick="onTibiazhouxiang(this)">胫骨轴向</button>
            </div>
            <div class="viewbtns">
                <p style="margin: 0;margin-top: 50px;">显示</p>
                <button class="viewbtn active" onclick="onJiati(this)">假体</button>
                <button class="viewbtn active" onclick="onJiegu(this)">截骨</button>
                <button class="viewbtn" onclick="onZhouxiang()">轴向</button>
                <button class="viewbtn active" style="margin-bottom: 150px;" onclick="onBiaozhidian(this)">标志点</button>
            </div>
            <div class="viewbtns">
                <button class="viewbtn" onclick="renDaiPingHeng(this)">韧带平衡</button>
                <button class="viewbtn" onclick="onPingguReset()">重置</button>
            </div>
        </div>
        </div>

        <div id="page-7" class="page-7 page" style="display: none;">
          <div class="flowChartbox">
            <div style="flex: 1;"></div>
            <div class="flowChart2">
              <button id="cutTopButton1" class="cutTopButton active" onclick="page2ChangeTopBtn(1)"></button>
              <button id="cutTopButton2" class="cutTopButton" onclick="page2ChangeTopBtn(2)"></button>
              <button id="cutTopButton3" class="cutTopButton" onclick="page2ChangeTopBtn(3)"></button>
              <button id="cutTopButton4" class="cutTopButton" onclick="page2ChangeTopBtn(4)" style="border-right: none;"></button>
            </div>
            <div style="flex: 1;"></div>
          </div>

          <div id="cut_gugu_pages">
            <div id="cut_gugu_pages_1" class="cutPages" style="display: flex;">
              <div style="width: 1100px;"><img src="static/asset/cut_img/robot.png" style="height: 100%;width: 100%;"></div>
              <div style="flex: 1;display: flex; justify-content: center;align-items: center;">
                <p class="cutTexts"><img src="static/asset/cut_img/踏板.png" alt="">踩下踏板使机械臂<br>移动至切割平面</p>
                <button id="guguBtn_1" class="bottons guguBtn" onclick="Page7ChangePage(this)">确认</button>
              </div>
            </div>

            <div id="cut_gugu_pages_2" class="cutPages">
              <div style="width: 1100px;"><img src="static/asset/cut_img/robot.png" style="height: 100%;width: 100%;"></div>
              <div style="flex: 1;display: flex; justify-content: center;align-items: center;">
                <p class="cutTexts" >机械臂移动中，请按取消键<br>或再次点击脚踏板停止</p>
                <button id="guguBtn_2" class="bottons guguBtn" onclick="Page7ChangePage(this)">确认</button>
              </div>
            </div>
           
            <div id="cut_gugu_pages_3" class="cutPages">
              <div style="width: 1100px;"><img src="static/asset/cut_img/move2bone.png" style="height: 100%;width: 100%;"></div>
              <div style="flex: 1;display: flex; justify-content: center;align-items: center;">
                <p class="cutTexts" >请拖动刀槽至截骨位置</p>
                <button id="guguBtn_3" class="bottons guguBtn" onclick="Page7ChangePage(this)">确认</button>
              </div>
            </div>

            <div id="cut_gugu_pages_4" class="cutPages">
              <div style="width: 1100px;position: relative;">
                <img src="static/asset/cut_img/bone1.png" style="height: 100%;width: 100%;">

                <div class="verify" style="top:300px;left: 200px;">
                  <div class="verifyCheckImg"></div>
                  <div class="verifyText">
                    <div class="verifyText1">股骨内外翻</div>
                    <div><b class="verifyText2">2.0°</b></div>
                    <div class="verifyText3">股骨内外翻</div>
                    <div><b class="verifyText4">2.0°</b></div>
                  </div>
                </div>

                <div class="verify" style="top:300px;left: 650px;">
                  <div class="verifyCheckImg"></div>
                  <div class="verifyText">
                    <div class="verifyText1">屈曲角</div>
                    <div><b class="verifyText2">2.0°</b></div>
                    <div class="verifyText3">屈曲角</div>
                    <div><b class="verifyText4">2.0°</b></div>
                  </div>
                </div>

                <div class="verify" style="top:550px;left: 20px;">
                  <div class="verifyCheckImg"></div>
                  <div class="verifyText">
                    <div class="verifyText1">切除</div>
                    <div><b class="verifyText2">7.5mm</b></div>
                    <div class="verifyText3">切除</div>
                    <div><b class="verifyText4">7.5mm</b></div>
                  </div>
                </div>

                <div class="verify" style="top:550px;left: 300px;">
                  <div class="verifyCheckImg"></div>
                  <div class="verifyText">
                    <div class="verifyText1">切除</div>
                    <div><b class="verifyText2">2.0mm</b></div>
                    <div class="verifyText3">切除</div>
                    <div><b class="verifyText4">7.5mm</b></div>
                  </div>
                </div>

              </div>
              <div style="flex: 1;display: flex; justify-content: center;align-items: center;">
                <p class="cutTexts" >·是否已打入第一颗限位钉？<br>·切割值是否可接受？</p>
                <button id="guguBtn_4" class="bottons guguBtn" onclick="Page7ChangePage(this)">确认</button>
              </div>
            </div>

            <div id="cut_gugu_pages_5" class="cutPages">
              <div style="width: 1100px;">
                <img src="static/asset/cut_img/bone1.png" style="height: 100%;width: 100%;">
                <div class="verify" style="top:300px;left: 200px;">
                  <div class="verifyCheckImg"></div>
                  <div class="verifyText">
                    <div class="verifyText1">股骨内外翻</div>
                    <div><b class="verifyText2">2.0°</b></div>
                    <div class="verifyText3">股骨内外翻</div>
                    <div><b class="verifyText4">2.0°</b></div>
                  </div>
                </div>

                <div class="verify" style="top:300px;left: 650px;">
                  <div class="verifyCheckImg"></div>
                  <div class="verifyText">
                    <div class="verifyText1">屈曲角</div>
                    <div><b class="verifyText2">2.0°</b></div>
                    <div class="verifyText3">屈曲角</div>
                    <div><b class="verifyText4">2.0°</b></div>
                  </div>
                </div>

                <div class="verify" style="top:550px;left: 20px;">
                  <div class="verifyCheckImg"></div>
                  <div class="verifyText">
                    <div class="verifyText1">切除</div>
                    <div><b class="verifyText2">7.5mm</b></div>
                    <div class="verifyText3">切除</div>
                    <div><b class="verifyText4">7.5mm</b></div>
                  </div>
                </div>

                <div class="verify" style="top:550px;left: 300px;">
                  <div class="verifyCheckImg"></div>
                  <div class="verifyText">
                    <div class="verifyText1">切除</div>
                    <div><b class="verifyText2">2.0mm</b></div>
                    <div class="verifyText3">切除</div>
                    <div><b class="verifyText4">7.5mm</b></div>
                  </div>
                </div>
              </div>
              <div style="flex: 1;display: flex; justify-content: center;align-items: center;">
                <p class="cutTexts" >·是否已打入第二颗限位钉？<br>·是否已完成切割？<br>·是否已移除限位钉？</p>
                <button id="guguBtn_5" class="bottons guguBtn" onclick="Page7ChangePage(this)">针已移除</button>
              </div>
            </div>

            <div id="cut_gugu_pages_6" class="cutPages">
              <div style="width: 1100px;"><img src="static/asset/cut_img/bone2move.png" style="height: 100%;width: 100%;"></div>
              <div style="flex: 1;display: flex; justify-content: center;align-items: center;">
                <p class="cutTexts" >移出刀槽<br>踩下踏板使机械臂返回</p>
                <button id="guguBtn_6" class="bottons guguBtn" onclick="Page7ChangePage(this)">确认</button>
              </div>
            </div>

            <div id="cut_gugu_pages_7" class="cutPages">
              <div style="width: 1100px;">
                <img src="static/asset/cut_img/bone3.png" style="height: 100%;width: 100%;">
                <div class="verify" style="top:0px;left: 200px;">
                  <div class="verifyCheckImg"></div>
                  <div class="verifyText">
                    <div class="verifyText1">股骨内外翻</div>
                    <div><b class="verifyText2">2.0°</b></div>
                    <div class="verifyText3">股骨内外翻</div>
                    <div><b class="verifyText4">2.0°</b></div>
                  </div>
                </div>

                <div class="verify" style="top:0px;left: 650px;">
                  <div class="verifyCheckImg"></div>
                  <div class="verifyText">
                    <div class="verifyText1">屈曲角</div>
                    <div><b class="verifyText2">2.0°</b></div>
                    <div class="verifyText3">屈曲角</div>
                    <div><b class="verifyText4">2.0°</b></div>
                  </div>
                </div>

                <div class="verify" style="top:200px;left: 20px;">
                  <div class="verifyCheckImg"></div>
                  <div class="verifyText">
                    <div class="verifyText1">切除</div>
                    <div><b class="verifyText2">7.5mm</b></div>
                    <div class="verifyText3">切除</div>
                    <div><b class="verifyText4">7.5mm</b></div>
                  </div>
                </div>

                <div class="verify" style="top:200px;left: 300px;">
                  <div class="verifyCheckImg"></div>
                  <div class="verifyText">
                    <div class="verifyText1">切除</div>
                    <div><b class="verifyText2">2.0mm</b></div>
                    <div class="verifyText3">切除</div>
                    <div><b class="verifyText4">7.5mm</b></div>
                  </div>
                </div>
              </div>
              <div style="flex: 1;display: flex; justify-content: center;align-items: center;">
                <p class="cutTexts" >将验证工具安装至截骨平面<br>验证股骨近端切除术</p>
                <button id="guguBtn_7" class="bottons guguBtn" onclick="Page7ChangePage(this)">确认</button>
              </div>
            </div>
          </div>

         

          <div id="cut_jinggu_pages" style="display: none;">
            <div id="cut_jinggu_pages_1" class="cutPages" style="display: flex;">
              <div style="width: 1100px;"><img src="static/asset/cut_img/robot.png" style="height: 100%;width: 100%;"></div>
              <div style="flex: 1;display: flex; justify-content: center;align-items: center;">
                <p class="cutTexts" ><img src="static/asset/cut_img/踏板.png" alt="">踩下踏板使机械臂<br>移动至切割平面</p>
                <button id="jingguBtn_1" class="bottons guguBtn" onclick="Page7ChangePage(this)">确认</button>
              </div>
            </div>

            <div id="cut_jinggu_pages_2" class="cutPages">
              <div style="width: 1100px;"><img src="static/asset/cut_img/robot.png" style="height: 100%;width: 100%;"></div>
              <div style="flex: 1;display: flex; justify-content: center;align-items: center;">
                <p class="cutTexts" >机械臂移动中，请按取消键<br>或再次点击脚踏板停止</p>
                <button id="jingguBtn_2" class="bottons guguBtn" onclick="Page7ChangePage(this)">确认</button>
              </div>
            </div>
           
            <div id="cut_jinggu_pages_3" class="cutPages">
              <div style="width: 1100px;"><img src="static/asset/cut_img/move2bone2.png" style="height: 100%;width: 100%;"></div>
              <div style="flex: 1;display: flex; justify-content: center;align-items: center;">
                <p class="cutTexts" >请拖动刀槽至截骨位置</p>
                <button id="jingguBtn_3" class="bottons guguBtn" onclick="Page7ChangePage(this)">确认</button>
              </div>
            </div>

            <div id="cut_jinggu_pages_4" class="cutPages">
              <div style="width: 1100px;">
                <img src="static/asset/cut_img/bone2.png" style="height: 100%;width: 100%;">
                <div class="verify" style="top:150px;left: 20px;">
                  <div class="verifyCheckImg"></div>
                  <div class="verifyText">
                    <div class="verifyText1">切除</div>
                    <div><b class="verifyText2">7.5mm</b></div>
                    <div class="verifyText3">切除</div>
                    <div><b class="verifyText4">7.5mm</b></div>
                  </div>
                </div>

                <div class="verify" style="top:150px;left: 350px;">
                  <div class="verifyCheckImg"></div>
                  <div class="verifyText">
                    <div class="verifyText1">切除</div>
                    <div><b class="verifyText2">2.0mm</b></div>
                    <div class="verifyText3">切除</div>
                    <div><b class="verifyText4">7.5mm</b></div>
                  </div>
                </div>

                <div class="verify" style="top:200px;left: 700px;">
                  <div class="verifyCheckImg"></div>
                  <div class="verifyText">
                    <div class="verifyText1">后倾角</div>
                    <div><b class="verifyText2">2.0°</b></div>
                    <div class="verifyText3">后倾角</div>
                    <div><b class="verifyText4">2.0°</b></div>
                  </div>
                </div>

                <div class="verify" style="top:350px;left: 170px;">
                  <div class="verifyCheckImg"></div>
                  <div class="verifyText">
                    <div class="verifyText1">胫骨内外翻</div>
                    <div><b class="verifyText2">2.0°</b></div>
                    <div class="verifyText3">胫骨内外翻</div>
                    <div><b class="verifyText4">2.0°</b></div>
                  </div>
                </div>

              </div>
              <div style="flex: 1;display: flex; justify-content: center;align-items: center;">
                <p class="cutTexts" >·是否已打入第一颗限位钉？<br>·切割值是否可接受？</p>
                <button id="jingguBtn_4" class="bottons guguBtn" onclick="Page7ChangePage(this)">确认</button>
              </div>
            </div>

            <div id="cut_jinggu_pages_5" class="cutPages">
              <div style="width: 1100px;">
                <img src="static/asset/cut_img/bone2.png" style="height: 100%;width: 100%;">
                <div class="verify" style="top:150px;left: 20px;">
                  <div class="verifyCheckImg"></div>
                  <div class="verifyText">
                    <div class="verifyText1">切除</div>
                    <div><b class="verifyText2">7.5mm</b></div>
                    <div class="verifyText3">切除</div>
                    <div><b class="verifyText4">7.5mm</b></div>
                  </div>
                </div>

                <div class="verify" style="top:150px;left: 350px;">
                  <div class="verifyCheckImg"></div>
                  <div class="verifyText">
                    <div class="verifyText1">切除</div>
                    <div><b class="verifyText2">2.0mm</b></div>
                    <div class="verifyText3">切除</div>
                    <div><b class="verifyText4">7.5mm</b></div>
                  </div>
                </div>

                <div class="verify" style="top:200px;left: 700px;">
                  <div class="verifyCheckImg"></div>
                  <div class="verifyText">
                    <div class="verifyText1">后倾角</div>
                    <div><b class="verifyText2">2.0°</b></div>
                    <div class="verifyText3">后倾角</div>
                    <div><b class="verifyText4">2.0°</b></div>
                  </div>
                </div>

                <div class="verify" style="top:350px;left: 170px;">
                  <div class="verifyCheckImg"></div>
                  <div class="verifyText">
                    <div class="verifyText1">胫骨内外翻</div>
                    <div><b class="verifyText2">2.0°</b></div>
                    <div class="verifyText3">胫骨内外翻</div>
                    <div><b class="verifyText4">2.0°</b></div>
                  </div>
                </div>

              </div>

              <div style="flex: 1;display: flex; justify-content: center;align-items: center;">
                <p class="cutTexts" >·是否已打入第二颗限位钉？<br>·是否已完成切割？<br>·是否已移除限位钉？</p>
                <button id="jingguBtn_5" class="bottons guguBtn" onclick="Page7ChangePage(this)">针已移除</button>
              </div>
            </div>

            <div id="cut_jinggu_pages_6" class="cutPages">
              <div style="width: 1100px;"><img src="static/asset/cut_img/bone2move2.png" style="height: 100%;width: 100%;"></div>
              <div style="flex: 1;display: flex; justify-content: center;align-items: center;">
                <p class="cutTexts" >移出刀槽<br>踩下踏板使机械臂返回</p>
                <button id="jingguBtn_6" class="bottons guguBtn" onclick="Page7ChangePage(this)">确认</button>
              </div>
            </div>

            <div id="cut_jinggu_pages_7" class="cutPages">
              <div style="width: 1100px;">
                <img src="static/asset/cut_img/bone3.png" style="height: 100%;width: 100%;">

                <div class="verify" style="top:400px;left: 20px;">
                  <div class="verifyCheckImg"></div>
                  <div class="verifyText">
                    <div class="verifyText1">切除</div>
                    <div><b class="verifyText2">7.5mm</b></div>
                    <div class="verifyText3">切除</div>
                    <div><b class="verifyText4">7.5mm</b></div>
                  </div>
                </div>

                <div class="verify" style="top:400px;left: 300px;">
                  <div class="verifyCheckImg"></div>
                  <div class="verifyText">
                    <div class="verifyText1">切除</div>
                    <div><b class="verifyText2">2.0mm</b></div>
                    <div class="verifyText3">切除</div>
                    <div><b class="verifyText4">7.5mm</b></div>
                  </div>
                </div>

                <div class="verify" style="top:400px;left: 650px;">
                  <div class="verifyCheckImg"></div>
                  <div class="verifyText">
                    <div class="verifyText1">后倾角</div>
                    <div><b class="verifyText2">2.0°</b></div>
                    <div class="verifyText3">后倾角</div>
                    <div><b class="verifyText4">2.0°</b></div>
                  </div>
                </div>

                <div class="verify" style="top:580px;left: 200px;">
                  <div class="verifyCheckImg"></div>
                  <div class="verifyText">
                    <div class="verifyText1">胫骨内外翻</div>
                    <div><b class="verifyText2">2.0°</b></div>
                    <div class="verifyText3">胫骨内外翻</div>
                    <div><b class="verifyText4">2.0°</b></div>
                  </div>
                </div>

              </div>
              <div style="flex: 1;display: flex; justify-content: center;align-items: center;">
                <p class="cutTexts" >将验证工具安装至截骨平面<br>验证胫骨近端切除术</p>
                <button id="jingguBtn_7" class="bottons guguBtn" onclick="Page7ChangePage(this)">确认</button>
              </div>
            </div>
          </div>

          <div id="shenzhiyanzheng" style="display: none;">
            <div id="shenzhiyanzheng_1" class="cutPages"  style="display: flex;">
              <div style="width: 1100px;"><img src="static/asset/cut_img/checked.png" style="height: 100%;width: 100%;"></div>
              <div style="flex: 1;display: flex; justify-content: center;align-items: center;">
                <p class="cutTexts" >伸直验证</p>
                <button id="yanzhengBtn_1" class="bottons guguBtn" onclick="Page7ChangePage(this)">确认</button>
                <button id="yanzhengBtn_1" class="bottons guguBtn" style="bottom: 150px;" onclick="Page7ChangePage(this)">确认</button>
              </div>
            </div>

            <div id="shenzhiyanzheng_2" class="cutPages">
              <div style="width: 1100px;margin-right: -200px;">
                <p><b id="shenzhi_cut_text" style="position: absolute;left: 440px;top:40px;">伸直</b></p>
                <p><b id="shenzhi_cut_angle" class="jianxi-text" style="left: 520px;top:30px;">0°</b></p>
                <div id="shenzhi-gugu-cut"></div>
                <div id="shenzhi-jinggu-cut"></div>
                <p><b id="shenzhi_cut_waice" class="jianxi-text" style="left: 355px;top: 320px;">0.0mm</b></p>
                <p><b id="shenzhi_cut_neice" class="jianxi-text" style="left: 520px;top: 320px;">0.0mm</b></p>
                <p class="LM-text" style="left: 370px;top: 390px;"><b>L</b></p>
                <p class="LM-text" style="left: 600px;top: 390px;"><b>M</b></p>

                <div id="shenzhihoudu" style="width: 300px;height: 150px; position: absolute;top:530px;left:350px;">
                  <div class="row" style="height: 35%;">
                      <p style="text-align: center;font-size: 25px;"><b>伸直厚度</b></p>
                  </div>
                  <div class="row" style="height: 60%;">
                      <div class="prosthesisborder">
                          <button class="decreasebtn-left decreasebtn" onclick="shenZhiHouDuChange('left')"><i class="bi bi-arrow-left-circle"></i></button>
                          <p><b id="shenzhiCutSize" clss="sizetext">10</b></p>
                          <button class="decreasebtn-right decreasebtn" onclick="shenZhiHouDuChange('right')"><i class="bi bi-arrow-right-circle"></i></button>
                      </div>
                  </div>
                </div>
              </div>

              <div style="flex: 1;display: flex;">
                <div style="flex: 1;"></div>
                <div style="width: 1000px;display: flex;flex-direction: column;">
                  <div style="height: 300px;display: flex;justify-content: center;align-items: center;">
                    <p class="cutTexts" >1.插入垫片<br>2.评估伸直间隙</p>
                  </div>
                  <div id="Cut" style="height: 280px;position: relative;">
                    <p style="position: absolute;top:40px;left: 400px;font-size: 25px;">外翻</p>
                    <p style="position: absolute;top:40px;right: 400px;font-size: 25px;">内翻</p>
                    <div id="Cut-ui1" style="width: 600px;height: 200px;position: absolute;left: 200px;top:100px">
                    </div>
                    <!-- <div style="top: 280px;left: 100px; position: absolute; z-index: 2;width: 800px;height: 185px;background-color: #2e4c70;"></div> -->
                    <p class="Valgus-ui-y-text2" style="top:185px;left: 210px;opacity: 1;">0°</p>
                    <button class="clearmark" style="top:220px;left: 750px;" onclick="clearMark0(22)"><i class="bi bi-shield-x"></i></button>
                    <div id="shu-handle2"></div>
                    <div id="mark22" class="mark" style="top:220px;left: 490px;"></div>
                  </div>
                  <div style="display: flex;position: relative;background-color: #2e4c70;">
                    <div style="top: 0px;left: 100px; position: absolute;width: 800px;height: 200px;background-color: #2e4c70;"></div>
                    <button id="yanzhengCancel_2" class="bottons guguBtn" style="top:65px; right: 490px;" onclick="Page7YanzhengBack(this)">取消</button>
                    <button id="yanzhengBack_2" class="bottons guguBtn" style="top:65px;right: 260px;" onclick="Page7YanzhengBack(this)">返回</button>
                    <button id="yanzhengBtn_2" class="bottons guguBtn" style="top:65px;" onclick="Page7ChangePage(this)">下一步</button>
                  </div>
                </div>
              </div>
            </div>

            <div id="shenzhiyanzheng_3" class="cutPages">
              <div id="legRotate2">
                <div id="legbackground2"></div>
                <div id="legrectangle2"></div>
              </div>
              <div style="width: 700px;position: relative;">
                <div id="verifyGugu"></div>
                <div id="verifyJinggu"></div>
                <p><b id="verify_waice_jianxi" class="jianxi-text" style="left: 210px;top: 450px;z-index: 3;font-size: 50px;">0.0mm</b></p>
                <p><b id="verify_neice_jianxi" class="jianxi-text" style="left: 480px;top: 450px;z-index: 3;font-size: 50px;">0.0mm</b></p>
                <p class="LM-text" style="left: 260px;top: 520px;"><b>L</b></p>
                <p id="123" class="LM-text" style="left: 500px;top: 520px;"><b>M</b></p>
                <div id="verifySpace"></div>
    
              </div>
              <div style="flex: 1;display: flex; justify-content: center;align-items: center;">
                <p class="cutTexts" >评估股骨旋转</p>
                <button id="yanzhengCancel_3" class="bottons guguBtn" style="right: 490px;" onclick="Page7YanzhengBack(this)">取消</button>
                <button id="yanzhengBack_3" class="bottons guguBtn" onclick="Page7YanzhengBack(this)">返回</button>
                <button id="yanzhengBtn_3" class="bottons guguBtn" style="bottom: 150px;" onclick="Page7ChangePage(this)">确认</button>
              </div>
            </div>

            <div id="shenzhiyanzheng_4" class="cutPages">
              <div style="width: 900px;">
                <img src="static/asset/cut_img/okokok.png" style="height: 100%;width: 100%;">
              </div>
              <div style="flex: 1;display: flex;">
                <div style="flex: 1;"></div>
                <div style="width: 1000px;display: flex;flex-direction: column;">
                  <div style="height: 220px;"></div>
                  <div style="height: 80px;">
                    <p class="cutTexts" >植入物旋转以平衡屈曲间隙:</p>
                  </div>
                  <div style="height: 300px;display: flex;justify-content: center;align-items: center;">
                    <div style="flex: 1;text-align: center;">
                      <div style="height: 20px;"><p class="cutTexts" style="font-size: 20px;">EXTERNAL°</p></div>
                      <div style="height: 30px;"><p><b id="EXTERNAL_L" class="shenzhiyanzhengText">1.5</b></p></div>
                      <div style="height: 50px;"><p class="cutTexts" >From TEA</p></div>
                    </div>
                    <div style="flex: 1;text-align: center;">
                      <div style="height: 20px;"><p class="cutTexts" style="font-size: 20px;">EXTERNAL°</p></div>
                      <div style="height: 30px;"><p><b id="EXTERNAL_R" class="shenzhiyanzhengText">4.5</b></p></div>
                      <div style="height: 50px;"><p class="cutTexts" >From PCA</p></div>
                    </div>
                  </div>
                  <button id="yanzhengNoApply" class="bottons guguBtn" style="right: 490px;" onclick="Page7ChangePage(this)">不应用</button>
                  <button id="yanzhengRedo" class="bottons guguBtn" style="right: 260px;" onclick="Page7ChangePage(this)">重做</button>
                  <button id="yanzhengBtn_4" class="bottons guguBtn" onclick="Page7ChangePage(this)">应用</button>
                </div>
              </div>
            </div>

            <div id="shenzhiyanzheng_5" class="cutPages">
              <div style="width: 900px;">
                <img src="static/asset/cut_img/okokok.png" style="height: 100%;width: 100%;">
              </div>
              <div style="flex: 1;display: flex;">
                <div style="flex: 1;"></div>
                <div style="width: 1000px;display: flex;flex-direction: column;">
                  <div style="height: 600px;">
                    <p class="cutTexts" >内外侧位置确认？</p>
                    <p class="cutTexts" >第一针已安装？</p>
                    <p class="cutTexts" >切割值是否可接受？</p>
                  </div>
                  <button id="yanzhengCancel_5" class="bottons guguBtn" style="right: 490px;" >取消</button>
                  <button id="yanzhengBtn_5" class="bottons guguBtn" onclick="Page7ChangePage(this)">确认</button>
                </div>
              </div>

            </div>

          </div>

        </div>

    </main>
  
    <!-- <div class="footer">

    </div> -->

  </div>
  
    <div id="welcome" style="display: flex;width: auto;height: 100%; min-height: 1000px;">
      <div id="welcome-left" style="display: flex;flex-direction: column;width: 600px;">
        <div style="height: 400px;text-align: center;padding-top: 30px;">
          <img class="welcome-img" src="static/asset/img/SplashScreen.png" alt="图">
          <p id="CompanyName">成就医学科技</p>
          <div style="display: flex;margin-left: 70px;">
            <p class="userName" style="text-align: right;">欢迎用户:</p>
            <p class="userName" style="text-align: left;">123</p>
          </div>
        </div>
  
        <div style="flex: 1;">
        </div>
  
        <div style="height: 400px;display: flex;flex-direction: column;padding-bottom: 30px;">
          <div class="input-form">
            <label for="validationDefault03" class="form-label">患者姓名:</label>
            <input type="text" class="form-control" id="PName" onblur="patientInformation(this)" placeholder="请输入患者姓名" value="" required>
          </div>
          <div class="input-form">
            <label for="validationDefault03" class="form-label">案 例 I D:</label>
            <input type="text" class="form-control" id="PID" onblur="patientInformation(this)" placeholder="请输案例ID" value="" required>
          </div>
          <div class="input-form">
              <label for="validationDefault03" class="form-label">患者性别:</label>
              <div class="form-check">
                <input class="form-PSex" type="radio" name="SexCheck" id="male" onclick="checkSex(this)">
                <label class="form-PSex-label" for="male">男</label>
              </div>
              <div class="form-check">
                <input class="form-PSex" type="radio" name="SexCheck" id="female" checked onclick="checkSex(this)">
                <label class="form-PSex-label" for="female">女</label>
              </div>
          </div>
          <div class="input-form">
            <label for="validationDefault03" class="form-label">出生日期:</label>
            <input type="text" class="form-control" id="PDateBirth" onblur="patientInformation(this)" placeholder="请输入患者出生日期" value="" required>
          </div>
          <div class="input-form">
            <label for="validationDefault03" class="form-label">创建时间:</label>
            <input type="text" class="form-control" id="PCreatDate" onblur="patientInformation(this)" placeholder="请输入创建时间" value="" required>
          </div>
  
        </div>
  
      </div>

      <div id="welcome-right" style="display: flex;flex-direction: column; flex: 2;">
        <div style="height: 350px;">
          <div style="display: flex;height: 50px;justify-content: center;align-items: center;padding-right: 20px;">
            <label class="welcome-text" style="width: 60px;">术式</label>
            <hr color="#fff" size="5" width="80%" style="flex: 1;">
          </div>
          <div style="height: 300px;;display: flex;">
            <button id="surgeryKneeJoint" class="btn-img Surgery" onclick="checkSurgery(this)"><img class="welcome-img" src="static/asset/img/UKA.png" alt="图"></button>
            <button id="surgeryHipJoint" class="btn-img Surgery active" onclick="checkSurgery(this)"><img class="welcome-img" src="static/asset/img/TKA.png" alt="图"></button>
          </div>
        </div>
  
        <div style="height: 100px;">
          <div style="display: flex;height: 50px;justify-content: center;align-items: center;padding-right: 20px;">
            <label class="welcome-text" style="width: 120px;">手术部位</label>
            <hr color="#fff" size="5" width="80%" style="flex: 1;">
          </div>
          <div style="display: flex;height: 50px;padding-left: 50px; ">
            <div class="form-check">
              <input class="form-PSex" type="radio" name="SurgicalSite" id="SurgicalSite1" checked>
              <label class="form-PSex-label" for="SurgicalSite1">全膝关节置换</label>
            </div>
            <div class="form-check">
              <input class="form-PSex" type="radio" name="SurgicalSite" id="SurgicalSite2">
              <label class="form-PSex-label" for="SurgicalSite2">单髁关节置换</label>
            </div>
            <div class="form-check">
              <input class="form-PSex" type="radio" name="SurgicalSite" id="SurgicalSite3">
              <label class="form-PSex-label" for="SurgicalSite3">髌骨关节置换</label>
            </div>
  
          </div>
          
        </div>
        <div style="display: flex; flex: 1;">
          <div style="flex: 1;position: relative;">
            <div style="display: flex;height: 50px;justify-content: center;align-items: center;padding-right: 10px;">
              <label class="welcome-text" style="width: 60px;">假体</label>
              <hr color="#fff" size="5" width="80%" style="flex: 1;">
            </div>
            <div style="display: flex;height: 50px;">
              <label class="welcome-text" style="width: 120px;">公司名称:</label>
              <select class="welcome-combobox" id="company" style="flex: 1;">
                <option >公司1</option>
                <option >公司2</option>
                <option >公司3</option>
                <option >公司4</option>
              </select>
              <select class="welcome-combobox" id="prosthesis"style="flex: 1;">
                <option >PFC</option>
                <option >Reach</option>
                <option >Attune</option>
              </select>
              <button class="startBtn" onclick="startRosa()">开始</button>
            </div>
          </div>
          <div style="display: flex;flex-direction: column; flex: 1;">
            <div style="display: flex;height: 50px;justify-content: center;align-items: center;padding-right: 10px;">
              <label class="welcome-text" style="width: 60px;">患侧</label>
              <hr color="#fff" size="5" width="80%" style="flex: 1;">
            </div>
  
            <div style="display: flex;flex: 1;padding: 50px;">
              <button id="affectedSideRight" class="btn-img affectedSide" style="flex: 1;" onclick="checkAffectedSide(this)"><img class="welcome-img" src="static/asset/img/TKA1.png" alt="图"></button>
              <button id="affectedSideLeft" class="btn-img affectedSide active" style="flex: 1;" onclick="checkAffectedSide(this)"><img class="welcome-img" src="static/asset/img/TKA2.png" alt="图"></button>
            </div>
  
          </div>
  
        </div>
  
      </div>
    </div>
  
</body>

</html>